{"version":3,"sources":["../../src/app.js"],"names":["bot","types","Actions","SERVER_URL","process","env","get","PARSE_APP_ID","PARSE_SERVER_URL","PARSE_CLIENT_KEY","FACEBOOK_APP_ID","REDIRECT_URI","GOOGLE_MAPS_URL","GOOGLE_MAPS_KEY","BUSINESS","rules","set","sendMenu","sendAddressesWithTitle","sendCart","sendOrders","sendAddresses","newAddress","sendAccount","sendCreditCards","registerCreditCard","sendHelp","sendYouAreWelcome","payloadRules","setAddressComplement","confirmAddress","setAddress","editAddress","removeAddress","sendCategories","sendProducts","addProduct","addModifier","removeProduct","increaseOneProduct","decreaseOneProduct","sendProductDescription","sendContinueOrder","searchProducts","sendCartDetails","editCart","clearCart","clearAndSendCart","sendPurchaseOptions","checkout","checkPayment","checkAddress","checkOrder","registerCreditCardAndPay","sendRegisteredCreditCards","cancelRegisterCreditCard","payWithCreditCard","sendOrder","newOrder","cancelOrder","removeCreditCard","setScore","defaultSearch","initialState","userData","paymentTypes","sendCash","creditCardImages","reducer","state","action","console","log","data","hasOwnProperty","recipientId","type","APP_LOADED","app","CUSTOMER_LOADED","customer","CONSUMER_LOADED","consumer","USER_LOADED","user","CONSUMER_ADDRESSES_LOADED","addresses","map","a","SET_CURRENT_ADDRESS","address","PAYMENT_METHODS_LOADED","paymentMethods","p","SET_PAYMENT_METHOD","paymentMethod","SET_ORDERS","ongoing","orders","delivered","CONSUMER_UPDATED","CONSUMER_NOT_FOUND","CONSUMER_ORDERS_LOADED","USER_CREDITCARDS_LOADED","creditCards","SET_CUSTOMER_POINT_SALE","pointSale","SET_ORDER","order","SET_USER","SET_CONSUMER","SET_CUSTOMER","SET_ORDER_STATE","orderState","req","res","sendFile","join","__dirname","post","body","signUp","psid","uid","accessToken","then","status","end","consumerID","Parse","Query","id","username","User","logIn","success","addCreditCard","getSessionToken","error","object","userBuffer","buffer","creditCardPayload","store","dispatch","setOrderState","sendOrderState","fail","message","json","result","facebookId","conversationToken","createUser","userObject","rawParseObject","createConsumer","resolve","reject","login","password","authentication","senderId","getCustomer","getUser","PAGE_ACCESS_TOKEN","getConsumer","loadInStore","BUSINESS_ID","userObj","consumerObj","sendSignUp","image_url","sendTypingOn","sendTypingOff","sendGenericMessage","image","url","first_name","name","sendTextMessage","elements","push","length","limit","description","city","location","lat","lng","objectId","getState","creditCardsImages","creditCardImage","creditCard","lastFour","cardHolderName","setDataBuffer","writeAddress","setListener","addressCheck","setLocationCheck","sendQuickReplyMessage","sendNullMapMessage","sendMap","sendImageMessage","sendMapConfirmation","geocode","setAddressComponetsInBuffer","results","formatted_address","geometry","address_components","component","includes","route","long_name","street_number","short_name","locality","administrative_area","country","country_code","postal_code","addressPayload","saveAddress","startsWith","split","GeoPoint","latitude","parseFloat","longitude","consumerAddress","complement","save","undefined","address_name","__type","className","setEmail","setEmailCheck","email","saveInStore","setTelephone","setTelephoneCheck","setPhone","telephone","reverseGeocode","Cloud","run","businessId","setCustomerPointSale","code","destroy","index","pointSaleIsOpen","parseInt","sendCategoriesDetail","categories","sendScheduleRestriction","pointSaleSchedules","splitCategories","idx","forEach","item","title","buttons","payload","Object","keys","catIni","catFin","subtitle","categoryId","proIdx","category","getProducts","products","sendProductsDetail","splitProducts","product","createCart","assign","items","Map","cart","productId","productObject","promises","quantity","price","priceDefault","modifiers","obj","array","modifier","Promise","when","undefinedModifiers","checkModifiers","modifierItem","modifierItems","sendModifierMenu","saveCart","sendAddProductNenu","quick_replies","modifierId","itemId","orderItemModifier","exist","itemModifier","checkModifiersComplete","orderItem","delete","itemsPointers","key","value","size","consumerCart","properties","saveAll","method","saveOrder","getOrderState","total","deliveryCost","phone","setOrder","sendEmptyCartOptions","customer_image_url","element","orderLimit","ind","sendCartReceipt","alert","cartId","payment_method","addressData","street_1","street_2","postalCode","countryCode","sendReceiptMessage","template_type","recipient_name","last_name","order_number","currency","timestamp","Math","trunc","Date","now","toString","summary","subtotal","shipping_cost","total_cost","sendEditCartOptions","minOrderPrice","sendMinOrderPriceRestriction","loadPaymentMethods","i","substring","setPaymentMethod","paymentFunction","days","text","pointSaleSchedule","daysActive","allDay","dayID","orderConfirmation","card","creditCardId","messagePush","orderSent","sendserviceRating","deliveryTime","score","orderId","Number","comment","thank","query","q","renderSearchEmpty","renderSearchInitial","splitSearchResult","productObjects","renderHelp","sendContactUs","consumerId","setOrders","renderOrders","datetime","dateString","createdAt","orderNumber","currentOrder","amount","renderOrder","renderCancelOrder","renderAccount","token","expiration","replace","uri","headers","catch","response","JSON","stringify","orderStateNumber","equalTo","find","module","exports","getData"],"mappings":"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","file":"app.js","sourcesContent":["import * as bot from './bot';\nimport * as types from './constants/actionTypes';\nimport * as Actions from './actions/index';\nimport { extractParseAttributes } from './parseUtils';\nimport {createLocalStore, getData} from './localStore'\nimport {Customer, User, Consumer, ConsumerAddress, Category, Product, Cart, Order, OrderItem, OrderState, Modifier, ModifierItem, OrderItemModifier, PaymentMethod, CreditCard} from './models/ParseModels';\n\nimport config from 'config';\nimport rp from 'request-promise';\nimport Promise from 'promise';\nimport objectAssign from 'object-assign';\nimport geocoder from 'geocoder';\nimport path from 'path';\nimport DateTime from 'datetime-converter-nodejs';\nimport dateFormat from 'dateformat'\n\nconst SERVER_URL = (process.env.SERVER_URL) ? (process.env.SERVER_URL) : config.get('SERVER_URL');\n\nconst PARSE_APP_ID = (process.env.PARSE_APP_ID) ? (process.env.PARSE_APP_ID) : config.get('PARSE_APP_ID');\n\nconst PARSE_SERVER_URL = (process.env.PARSE_SERVER_URL) ? (process.env.PARSE_SERVER_URL) : config.get('PARSE_SERVER_URL');\n\nconst PARSE_CLIENT_KEY = (process.env.PARSE_CLIENT_KEY) ? (process.env.PARSE_CLIENT_KEY) : config.get('PARSE_CLIENT_KEY');\n\nconst FACEBOOK_APP_ID = (process.env.FACEBOOK_APP_ID) ? (process.env.FACEBOOK_APP_ID) : config.get('FACEBOOK_APP_ID');\n\nconst REDIRECT_URI = (process.env.REDIRECT_URI) ? (process.env.REDIRECT_URI) : config.get('REDIRECT_URI');\n\nconst GOOGLE_MAPS_URL = (process.env.GOOGLE_MAPS_URL) ? (process.env.GOOGLE_MAPS_URL) : config.get('GOOGLE_MAPS_URL');\n\nconst GOOGLE_MAPS_KEY = (process.env.GOOGLE_MAPS_KEY) ? (process.env.GOOGLE_MAPS_KEY) : config.get('GOOGLE_MAPS_KEY');\n\nconst BUSINESS = config.get('BUSINESS');\n\nbot.rules.set('hola', sendMenu);\nbot.rules.set('iniciar', sendMenu);\nbot.rules.set('empezar', sendMenu);\nbot.rules.set('comenzar', sendMenu);\nbot.rules.set('buenos dias', sendMenu);\nbot.rules.set('buenas tardes', sendMenu);\nbot.rules.set('menú', sendMenu);\nbot.rules.set('pedir domicilio', sendAddressesWithTitle);\nbot.rules.set('carrito', sendCart);\nbot.rules.set('cuenta', sendCart);\nbot.rules.set('mi orden', sendOrders);\nbot.rules.set('mis órdenes', sendOrders);\nbot.rules.set('mi dirección', sendAddresses);\nbot.rules.set('mis direcciones', sendAddresses);\nbot.rules.set('nueva dirección', newAddress);\nbot.rules.set('agregar dirección', newAddress);\nbot.rules.set('mi cuenta', sendAccount);\nbot.rules.set('mi tarjeta', sendCreditCards);\nbot.rules.set('mis tarjetas', sendCreditCards);\nbot.rules.set('nueva tarjeta', registerCreditCard);\nbot.rules.set('agregar tarjeta', registerCreditCard);\n\nbot.rules.set('ayuda', sendHelp);\nbot.rules.set('help', sendHelp);\nbot.rules.set('gracias', sendYouAreWelcome);\n\nbot.payloadRules.set('Greeting', sendMenu);\n\nbot.payloadRules.set('SendAddressesWithTitle', sendAddressesWithTitle);\nbot.payloadRules.set('SendAddresses', sendAddresses);\nbot.payloadRules.set('NewAddress', newAddress);\nbot.payloadRules.set('SetAddressComplement', setAddressComplement);\nbot.payloadRules.set('ConfirmAddress', confirmAddress);\nbot.payloadRules.set('SetAddress', setAddress);\nbot.payloadRules.set('EditAddress', editAddress);\nbot.payloadRules.set('RemoveAddress', removeAddress);\n\nbot.payloadRules.set('SendCategories', sendCategories);\nbot.payloadRules.set('SendProducts', sendProducts);\nbot.payloadRules.set('AddProduct', addProduct);\nbot.payloadRules.set('AddModifier', addModifier);\nbot.payloadRules.set('RemoveProduct', removeProduct);\nbot.payloadRules.set('IncreaseOneProduct', increaseOneProduct);\nbot.payloadRules.set('DecreaseOneProduct', decreaseOneProduct);\nbot.payloadRules.set('SendProductDescription', sendProductDescription);\nbot.payloadRules.set('SendContinueOrder', sendContinueOrder);\n\nbot.payloadRules.set('Search', searchProducts);\nbot.payloadRules.set('SendCart', sendCart);\nbot.payloadRules.set('SendCartDetails', sendCartDetails);\nbot.payloadRules.set('EditCart', editCart);\nbot.payloadRules.set('ClearCart', clearCart);\nbot.payloadRules.set('ClearAndSendCart', clearAndSendCart);\nbot.payloadRules.set('SendPurchaseOptions', sendPurchaseOptions);\n\nbot.payloadRules.set('Checkout', checkout);\nbot.payloadRules.set('CheckPayment', checkPayment);\nbot.payloadRules.set('CheckAddress', checkAddress);\nbot.payloadRules.set('CheckOrder', checkOrder);\nbot.payloadRules.set('RegisterCreditCard', registerCreditCard);\nbot.payloadRules.set('RegisterCreditCardAndPay', registerCreditCardAndPay);\n\nbot.payloadRules.set('SendRegisteredCreditCards', sendRegisteredCreditCards);\nbot.payloadRules.set('CancelRegisterCreditCard', cancelRegisterCreditCard);\nbot.payloadRules.set('PayWithCreditCard', payWithCreditCard);\nbot.payloadRules.set('SendOrders', sendOrders);\nbot.payloadRules.set('SendOrder', sendOrder);\nbot.payloadRules.set('NewOrder', newOrder);\nbot.payloadRules.set('CancelOrder', cancelOrder);\nbot.payloadRules.set('SendCreditCards', sendCreditCards);\nbot.payloadRules.set('RemoveCreditCard', removeCreditCard);\nbot.payloadRules.set('SetScore', setScore);\nbot.payloadRules.set('SendAccount', sendAccount);\nbot.payloadRules.set('SendHelp', sendHelp);\nbot.payloadRules.set('CustomerService', sendHelp);\n\nbot.defaultSearch = searchProducts;\n\nconst initialState = {\n    userData: {},\n    paymentTypes: {\n        'Nn0joKC5VK': sendCash,\n        'UdK0Ifc4IF': sendCash,\n        'CHzoYrEtiY': sendRegisteredCreditCards\n    },\n    creditCardImages: {\n        'VISA': 'assets/images/visaCard.jpg',\n        'MASTERCARD': 'assets/images/masterCard.jpg',\n        'AMERICAN': 'assets/images/americanCard.jpg',\n        'DEFAULT': 'assets/images/creditCards.jpg'\n    }\n};\n\nconst reducer = (state = initialState, action) => {\n    console.log('ACTION');\n    console.log(action);\n    let data = action.data;\n\n    if(data && data.hasOwnProperty('recipientId')){\n        if(typeof state.userData[data.recipientId] == 'undefined'){\n            state.userData[data.recipientId] = {};\n        }\n    }\n\n    switch (action.type) {\n        case types.APP_LOADED: {\n            console.log('Application is running on port', bot.app.get('port'));\n            return {...state};\n        }\n        case types.CUSTOMER_LOADED: {\n            let customer = extractParseAttributes(data.customer);\n            objectAssign(state.userData[data.recipientId], {customer});\n            return {...state};\n        }\n        case types.CONSUMER_LOADED: {\n            let consumer = extractParseAttributes(data.consumer);\n            objectAssign(state.userData[data.recipientId], {consumer});\n            return {...state};\n        }\n        case types.USER_LOADED: {\n            let user = extractParseAttributes(data.user);\n            objectAssign(state.userData[data.recipientId], {user});\n            return {...state};\n        }\n        case types.CONSUMER_ADDRESSES_LOADED: {\n            let addresses = data.addresses.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {addresses});\n            return {...state};\n        }\n        case types.SET_CURRENT_ADDRESS: {\n            let address = extractParseAttributes(data.address);\n            objectAssign(state.userData[data.recipientId], {address});\n            return {...state};\n        }\n        case types.PAYMENT_METHODS_LOADED: {\n            let paymentMethods = data.paymentMethods.map(p => extractParseAttributes(p))\n            objectAssign(state.userData[data.recipientId], {paymentMethods})\n            return {...state};\n        }\n        case types.SET_PAYMENT_METHOD: {\n            let paymentMethod = extractParseAttributes(data.paymentMethod);\n            objectAssign(state.userData[data.recipientId], {paymentMethod});\n            return {...state};\n        }\n        case types.SET_ORDERS: {\n            let ongoing = data.orders.ongoing.map(a => extractParseAttributes(a));\n            let delivered = data.orders.delivered.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {orders: {ongoing: ongoing, delivered: delivered}});\n            return {...state};\n        }\n        case types.CONSUMER_UPDATED: {\n            return {...state};\n        }\n        case types.CONSUMER_NOT_FOUND: {\n            return {...state};\n        }\n        case types.CONSUMER_ORDERS_LOADED: {\n            let orders = data.orders.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {orders});\n            return {...state};\n        }\n        case types.USER_CREDITCARDS_LOADED: {\n            let creditCards = data.creditCards.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {creditCards});\n            return {...state};\n        }\n        case types.SET_CUSTOMER_POINT_SALE: {\n            let pointSale = extractParseAttributes(data.pointSale);\n            objectAssign(state.userData[data.recipientId], {pointSale});\n            return {...state};\n        }\n        case types.SET_ORDER: {\n            let order = extractParseAttributes(data.order);\n            objectAssign(state.userData[data.recipientId], {order});\n            return {...state};\n        }\n        case types.SET_USER: {\n            let user = extractParseAttributes(data.user);\n            objectAssign(state.userData[data.recipientId], {user});\n            return {...state};\n        }\n        case types.SET_CONSUMER: {\n            let consumer = extractParseAttributes(data.consumer);\n            objectAssign(state.userData[data.recipientId], {consumer});\n            return {...state};\n        }\n        case types.SET_CUSTOMER:{\n            let customer = extractParseAttributes(data.customer);\n            objectAssign(state.userData[data.recipientId], {customer});\n            return {...state};\n        }\n        case types.SET_ORDER_STATE: {\n            let orderState = extractParseAttributes(data.orderState);\n            objectAssign(state.userData[data.recipientId], {orderState});\n            return {...state};\n        }\n        default:\n            return state;\n    }\n}\n\ncreateLocalStore(reducer);\n\nbot.app.get('/login', function(req, res) {\n    res.sendFile(path.join(__dirname+'/views/login.html'));\n});\n\nbot.app.post('/registerUser', function (req, res) {\n    let data = req.body;\n\n    signUp(data.psid, data.uid, data.accessToken).then(user =>{\n        sendMenu(data.psid);\n    });\n\n    res.status(200).end();\n});\n\nbot.app.get('/creditCard', function(req, res) {\n    res.sendFile(path.join(__dirname+'/views/cardForm.html'));\n});\n\nbot.app.post('/registerCreditCard', function (req, res) {\n    let data = req.body;\n    let consumerID = data['consumerID'];\n\n    new Parse.Query(Consumer).get(consumerID).then(consumer => {\n            if(consumer){\n                new Parse.Query(User).get(consumer.get('user').id).then(user => {\n                    let username = user.get('username');\n                    let recipientId = consumer.get('conversationId');\n\n                    Parse.User.logIn(username, username, {\n                        success: function(userData) {\n                            addCreditCard(recipientId, userData.getSessionToken(), data)\n                        },\n                        error: function(user, error) {\n                            console.log('error');\n                            console.log(error);\n                        }\n                    });\n                });\n\n                res.sendFile(path.join(__dirname+'/views/cardRegistered.html'));\n            }\n        },\n        (object, error) => {\n            console.log(error);\n        });\n});\n\nbot.app.post('/creditCardRegistered', function (req, res) {\n    console.log('creditCardRegistered');\n    let data = req.body;\n    let userBuffer = bot.buffer[data.recipientId];\n\n    if (typeof userBuffer != 'undefined') {\n        if (userBuffer.creditCardPayload == 'SendCreditCards') {\n            sendRegisteredCreditCards(data.recipientId, 1329140110447050);\n            delete userBuffer.creditCardPayload\n        }\n        else {\n            sendCreditCards(data.recipientId, 1329140110447050)\n        }\n    }\n    else {\n        sendCreditCards(data.recipientId, 1329140110447050)\n    }\n})\n\nbot.app.post('/changeOrderState', function (req, res) {\n    let data = req.body;\n\n    new Parse.Query(Consumer).get(data['consumerID']).then(consumer => {\n            if(consumer){\n                new Parse.Query(User).get(consumer.get('user').id).then(user => {\n                    let username = user.get('username');\n                    let recipientId = consumer.get('conversationId');\n\n                    new Parse.Query(OrderState).get(data['stateID']).then(orderState => {\n\n                        store.dispatch(Actions.setOrderState(recipientId, orderState)).then(() => {\n                            sendOrderState(recipientId);\n                        })\n                    })\n                    .fail(error => {\n                        console.log('Error code: ' + error.message);\n                    });\n                });\n            }\n        },\n        (object, error) => {\n            console.log(error);\n        });\n\n    res.json({result: 'OK'});\n});\n\nfunction signUp(recipientId, facebookId, conversationToken){\n    return User.createUser(store, recipientId, facebookId, conversationToken).then(()=>{\n        let userObject = getData(recipientId, 'user');\n        let user = userObject.rawParseObject;\n\n        return user.createConsumer(store, recipientId, conversationToken).then(consumer => {\n            return new Promise((resolve, reject) => {\n                resolve(userObject)\n            });\n        });\n    });\n}\n\nfunction login(username, password){\n    return Parse.User.logIn(username, password, {\n        success : user => {\n            //let val = JSON.stringify({sessionToken: user.getSessionToken()});\n            //console.log(val);\n            return user;\n        },\n        error: function(user, error) {\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }});\n}\n\n\nfunction authentication(recipientId, senderId){\n    return getCustomer(recipientId, senderId).then(customer => {\n        return getUser(recipientId).then(user => {\n            if(typeof user == 'undefined'){\n                //sendSignUp(recipientId)\n                return User.createUser(store, recipientId, recipientId, BUSINESS[senderId].PAGE_ACCESS_TOKEN).then(()=>{\n                    let userObject = getData(recipientId, 'user');\n                    let user = userObject.rawParseObject;\n\n                    return user.createConsumer(store, recipientId, BUSINESS[senderId].PAGE_ACCESS_TOKEN).then(consumer => {\n                        return new Promise((resolve, reject) => {\n                            resolve(userObject)\n                        });\n                    });\n                })\n            }\n            else{\n                return getConsumer(recipientId, user.rawParseObject).then(consumer => {\n                    return new Promise((resolve, reject) => {\n                        resolve(user)\n                    });\n\n                    /*Parse.Promise.as().then(() => {\n                        return user;\n                    });*/\n                });\n            }\n            //return login(user.username, user.username).then(()=>{\n\n            //});\n        });\n    });\n}\n\nfunction getCustomer(recipientId, senderId){\n    let customer = getData(recipientId, 'customer');\n    if(typeof customer == 'undefined'){\n        return Customer.loadInStore(store, recipientId, BUSINESS[senderId].BUSINESS_ID).then(()=>{\n            return getData(recipientId, 'customer');\n        });\n    }\n    else{\n        return new Promise((resolve, reject) => {\n            resolve(customer)\n        });\n    }\n}\n\nfunction getUser(recipientId){\n    let userObj = getData(recipientId, 'user');\n    if(typeof userObj == 'undefined'){\n        return User.loadInStore(store, recipientId).then(()=>{\n            return getData(recipientId, 'user');\n        });\n    }\n    else{\n        return new Promise((resolve, reject) => {\n            resolve(userObj)\n        });\n    }\n}\n\nfunction getConsumer(recipientId, user){\n    let consumerObj = getData(recipientId, 'consumer');\n\n    if(typeof consumerObj == 'undefined'){\n        return Consumer.loadInStore(store, recipientId, user).then(()=>{\n            consumerObj = getData(recipientId, 'consumer');\n\n            if(typeof consumerObj != 'undefined'){\n                return new Promise((resolve, reject) => {\n                    resolve(consumerObj)\n                });\n            }else{\n                console.log('create consumer');\n                /*return createConsumer(recipientId, user).then( () => {\n                    return getData(recipientId, 'consumer');\n                });*/\n            }\n        });\n    }\n    else{\n        return new Promise((resolve, reject) => {\n            resolve(consumerObj)\n        });\n    }\n}\n\nfunction sendSignUp(recipientId, senderId) {\n    let image_url = SERVER_URL+\"assets/images/love.jpg\";\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        return bot.sendTypingOff(recipientId, senderId).then(() => {\n            return bot.sendGenericMessage(recipientId, senderId, [{\n                \"title\": \"Hola, soy un Bot\",\n                \"subtitle\": \"Soy tu asistente virtual. Quieres registrarte en nuestro sistema?\",\n                \"image_url\": image_url,\n                \"buttons\": [\n                    {\n                        \"type\": \"web_url\",\n                        \"url\": SERVER_URL + \"login?psid=\" + recipientId,\n                        \"title\": \"Registrarme\",\n                        \"webview_height_ratio\": \"full\",\n                        \"messenger_extensions\": true\n                    }\n                ]\n            }]);\n        });\n    });\n};\n\nfunction sendMenu(recipientId, senderId) {\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then(() =>{\n            let customer = getData(recipientId, 'customer');\n            let user = getData(recipientId, 'user');\n            let image_url = customer.image.url;\n            return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                return bot.sendGenericMessage(recipientId, senderId, [{\n                    \"title\":     \"Hola \"+user.first_name+\", Bienvenido a \"+customer.name,\n                    \"subtitle\":  \"Aquí puedes pedir un domicilio, escribe o selecciona alguna de las opciones:\",\n                    \"image_url\": image_url,\n                    \"buttons\":[\n                        {\n                            \"type\":\"postback\",\n                            \"title\":\"Pedir domicilio\",\n                            \"payload\": \"SendAddressesWithTitle\"\n                        },\n                        {\n                            \"type\":\"postback\",\n                            \"title\":\"Servicio al cliente\",\n                            \"payload\": \"CustomerService\"\n                        }\n                    ]\n                }]);\n            });\n        });\n    });\n}\n\nfunction sendAddressesWithTitle(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"A cual dirección vas hacer tu pedido?\\n\\nPuedes escoger entre agregar una nueva dirección o seleccionar una de tus direcciones guardadas\").then(() => {\n                sendAddresses(recipientId, senderId);\n            });\n        });\n    });\n}\n\nfunction sendAddresses(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        authentication(recipientId, senderId).then(() => {\n            let consumer = getData(recipientId, 'consumer');\n\n            ConsumerAddress.loadInStore(store, recipientId, consumer).then(() => {\n                let addresses = getData(recipientId, 'addresses');\n                let elements = [];\n\n                elements.push({\n                    \"title\": \"Nueva dirección\",\n                    \"subtitle\": \"Puedes agregar una nueva dirección\",\n                    \"image_url\": SERVER_URL+\"assets/images/addAddress.jpg\",\n                    \"buttons\": [\n                        {\n                            \"type\": \"postback\",\n                            \"title\": \"Nueva dirección\",\n                            \"payload\": \"NewAddress\"\n                        }\n                    ]\n                });\n\n                for(let address of addresses) {\n                    if (elements.length < bot.limit){\n                        elements.push({\n                            \"title\": address.name,\n                            \"subtitle\": address.address +\", \"+address.description+\", \"+address.city+\", \"+address.state,\n                            \"image_url\": GOOGLE_MAPS_URL+ \"?center=\"+address.location.lat+\",\"+address.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+address.location.lat+\",\"+address.location.lng+\"&key=\"+GOOGLE_MAPS_KEY,\n                            \"buttons\": [\n                                {\n                                    \"type\": \"postback\",\n                                    \"title\": \"Seleccionar\",\n                                    \"payload\": \"SetAddress-\"+address.objectId\n                                },\n                                {\n                                    \"type\": \"postback\",\n                                    \"title\": \"Modificar\",\n                                    \"payload\": \"EditAddress-\"+address.objectId\n                                },\n                                {\n                                    \"type\": \"postback\",\n                                    \"title\": \"Quitar\",\n                                    \"payload\": \"RemoveAddress-\"+address.objectId\n                                }\n                            ]\n                        });\n                    }\n                }\n\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendGenericMessage(recipientId, senderId, elements);\n                });\n            });\n        });\n    });\n}\n\nfunction sendCreditCards(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then(() =>{\n            let state = store.getState();\n            let user = getData(recipientId, 'user');\n            let creditCardsImages = state['creditCardImages'];\n\n            CreditCard.loadInStore(store, recipientId, user).then(() => {\n                let creditCards = getData(recipientId, 'creditCards');\n                let userBuffer = bot.buffer[recipientId];\n                let creditCardImage;\n                let elements = [];\n\n                if(typeof userBuffer != 'undefined' && userBuffer.hasOwnProperty('creditCardPayload')){\n                    delete userBuffer.creditCardPayload;\n                }\n\n                elements.push({\n                    \"title\": \"Registro de tarjeta\",\n                    \"subtitle\": \"Puedes agregar una tarjeta\",\n                    \"image_url\": SERVER_URL+\"assets/images/creditCards.jpg\",\n                    \"buttons\": [\n                        {\n                            \"type\": \"postback\",\n                            \"title\": \"Nueva tarjeta\",\n                            \"payload\": \"RegisterCreditCard\"\n                        }\n                    ]\n                });\n\n                for(let creditCard of creditCards) {\n                    if (elements.length < bot.limit){\n\n                        creditCardImage = creditCardsImages.hasOwnProperty(creditCard.type) ? creditCardsImages[creditCard.type] : creditCardsImages['DEFAULT']\n                        elements.push({\n                            \"title\": creditCard.type+' '+creditCard.lastFour,\n                            \"subtitle\": creditCard.cardHolderName,\n                            \"image_url\": SERVER_URL+creditCardImage,\n                            \"buttons\": [\n                                {\n                                    \"type\": \"postback\",\n                                    \"title\": \"Quitar\",\n                                    \"payload\": \"RemoveCreditCard-\"+creditCard.objectId\n                                }\n                            ]\n                        });\n                    }\n                }\n\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendGenericMessage(recipientId, senderId, elements);\n                });\n            });\n        });\n    });\n}\n\nfunction newAddress(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        return bot.sendTypingOff(recipientId, senderId).then(() => {\n            bot.setDataBuffer(recipientId, 'addressPayload', 'NewAddress');\n            writeAddress(recipientId, senderId);\n        });\n    });\n}\n\nfunction writeAddress(recipientId, senderId){\n    bot.setListener(recipientId, 'address', 'text', addressCheck);\n    bot.setListener(recipientId, 'location', 'attachment', setLocationCheck);\n\n    return bot.sendQuickReplyMessage(\n        recipientId,\n        senderId,\n        \"Puedes escribir o compartir tu ubicación actual?\\n\\nEjemplo: Calle 67 #52-20, Medellín.\\n\\nNo olvides escribir la ciudad al final de la dirección.\",\n        [{\n            \"content_type\": \"location\",\n            \"title\": \"Enviar ubicación\"\n        }]\n    );\n}\n\nfunction sendNullMapMessage(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        return bot.sendTypingOff(recipientId, senderId).then(() => {\n            return bot.sendTextMessage(recipientId, senderId, \"La dirección no ha sido encontrada en Google Maps, por favor intenta de nuevo\")\n        });\n    });\n}\n\nfunction sendMap(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let userBuffer = bot.buffer[recipientId];\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendImageMessage(recipientId, senderId, GOOGLE_MAPS_URL+\"?center=\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&key=\"+GOOGLE_MAPS_KEY).then(()=>{\n                sendMapConfirmation(recipientId, senderId);\n            });\n        });\n    });\n}\n\nfunction sendMapConfirmation(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendQuickReplyMessage(recipientId, senderId, \"Es correcta?\", [\n            {\n                \"content_type\": \"text\",\n                \"title\": \"Si\",\n                \"payload\": \"SetAddressComplement\"\n            },\n            {\n                \"content_type\": \"text\",\n                \"title\": \"No\",\n                \"payload\": \"NewAddress\"\n            }\n        ]);\n    });\n}\n\nfunction addressCheck(recipientId, senderId){\n    let userBuffer = bot.buffer[recipientId];\n\n    geocoder.geocode(userBuffer.address, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            setAddressComponetsInBuffer(recipientId, senderId, data.results[0]);\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n            sendNullMapMessage(recipientId, senderId).then(()=>{\n                newAddress(recipientId, senderId)\n            });\n        }\n    });\n}\n\nfunction setAddressComponetsInBuffer(recipientId, senderId, data){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        let userBuffer = bot.buffer[recipientId];\n        userBuffer.address = data.formatted_address;\n        userBuffer.location = data.geometry.location;\n\n        for (let component of data.address_components) {\n            if (component.types.includes('route')) {\n                userBuffer.route = component.long_name;\n            }\n            else if (component.types.includes('street_number')) {\n                userBuffer.street_number = component.short_name;\n            }\n            else if (component.types.includes('locality')) {\n                userBuffer.locality = component.short_name;\n            }\n            else if (component.types.includes('administrative_area_level_1')) {\n                userBuffer.state = component.short_name;\n            }\n            else if (component.types.includes('administrative_area_level_2')) {\n                userBuffer.administrative_area = component.short_name;\n            }\n            else if (component.types.includes('country')) {\n                userBuffer.country = component.long_name;\n                userBuffer.country_code = component.short_name\n            }\n            else if (component.types.includes('postal_code')) {\n                userBuffer.postal_code = component.short_name;\n            }\n        }\n\n        return bot.sendTypingOff(recipientId, senderId).then(() => {\n            return bot.sendTextMessage(recipientId, senderId, \"Encontré esta dirección en Google Maps:\\n\\n\" + userBuffer.address).then(() => {\n                sendMap(recipientId, senderId);\n            });\n        });\n    });\n}\n\nfunction setAddressComplement(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        bot.setListener(recipientId, 'complement', 'text', confirmAddress);\n\n        return bot.sendTypingOff(recipientId, senderId).then(() => {\n            return bot.sendTextMessage(recipientId, senderId, \"Por favor escribe el complemento de tu dirección actual.\\n\\nEjemplo: Apto 303, edificio el palmar.\\n\\nNo olvides colocar el nombre del edificio o del barrio\");\n        });\n    });\n}\n\nfunction confirmAddress(recipientId, senderId){\n    let userBuffer = bot.buffer[recipientId];\n    let addressPayload = userBuffer['addressPayload'];\n\n    if(addressPayload == 'NewAddress'){\n        return bot.sendTypingOn(recipientId, senderId).then(()=>{\n            bot.setListener(recipientId, 'address_name', 'text', saveAddress);\n            return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                return bot.sendTextMessage(recipientId, senderId, \"Por favor coloca un nombre a esta dirección para guardarla. \\n\\nEjemplo: casa, apartamento o oficina\");\n            });\n        });\n    }\n    else if(addressPayload.startsWith('EditAddress')){\n        return bot.sendTypingOn(recipientId, senderId).then(()=>{\n            let data = addressPayload.split('-');\n            let location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n            new Parse.Query(ConsumerAddress).get(data[1]).then((consumerAddress) => {\n\n                consumerAddress.set('address', userBuffer.route+\" # \"+userBuffer.street_number);\n                consumerAddress.set('location', location);\n                consumerAddress.set('country', userBuffer.country);\n                consumerAddress.set('countryCode', userBuffer.country_code);\n                consumerAddress.set('postalCode', userBuffer.postal_code);\n                consumerAddress.set('state', userBuffer.state);\n                consumerAddress.set('description', userBuffer.complement);\n\n                consumerAddress.save(undefined, {\n                    success: function(address) {\n                        delete userBuffer.address;\n                        delete userBuffer.location;\n                        delete userBuffer.complement;\n\n                        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            return bot.sendTextMessage(recipientId, senderId, \"La dirección ha sido actualizada.\").then(()=>{\n                                setAddress(recipientId, senderId, address.id);\n                            })\n                        });\n                    },\n                    error: function(user, error) {\n                       console.log('Failed to create new object, with error code: ' + error.message);\n                    }\n                });\n            });\n        });\n    }\n}\n\nfunction saveAddress(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let consumer = getData(recipientId, 'consumer');\n        let userBuffer = bot.buffer[recipientId];\n        let location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n        let consumerAddress = new ConsumerAddress();\n        consumerAddress.set('name', userBuffer.address_name);\n        consumerAddress.set('address', userBuffer.route+\" # \"+userBuffer.street_number);\n        consumerAddress.set('consumer', {\n            __type: \"Pointer\",\n            className: \"Consumer\",\n            objectId: consumer.objectId\n        });\n        consumerAddress.set('location', location);\n        consumerAddress.set('city', userBuffer.locality);\n        consumerAddress.set('country', userBuffer.country);\n        consumerAddress.set('countryCode', userBuffer.country_code);\n        consumerAddress.set('postalCode', userBuffer.postal_code);\n        consumerAddress.set('state', userBuffer.state);\n        consumerAddress.set('description', userBuffer.complement);\n\n        consumerAddress.save(undefined, {\n            success: function(result) {\n\n                delete userBuffer.address;\n                delete userBuffer.location;\n                delete userBuffer.complement;\n                delete userBuffer['address_name'];\n\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendTextMessage(recipientId, senderId, \"La dirección ha sido almacenada.\").then(()=>{\n                        setAddress(recipientId, senderId, result.id)\n                    })\n                });\n            },\n            error: function(user, error) {\n                console.log('Failed to create new object, with error code: ' + error.message);\n            }\n        });\n    });\n}\n\nfunction setEmail(recipientId, senderId){\n    bot.setListener(recipientId, 'email', 'text', setEmailCheck);\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"Por favor escribe tu email:\")\n    });\n}\n\nfunction setEmailCheck(recipientId, senderId){\n    let userBuffer = bot.buffer[recipientId];\n    let consumer = getData(recipientId, 'consumer').rawParseObject;\n\n    consumer.setEmail(userBuffer.email);\n    consumer.saveInStore(store, recipientId).then(()=>{\n        delete userBuffer.email;\n        checkOrder(recipientId, senderId)\n    });\n}\n\nfunction setTelephone(recipientId, senderId){\n    bot.setListener(recipientId, 'telephone', 'text', setTelephoneCheck);\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"Por favor escribe tu número telefónico:\")\n    });\n}\n\nfunction setTelephoneCheck(recipientId, senderId){\n    let userBuffer = bot.buffer[recipientId];\n    let consumer = getData(recipientId, 'consumer').rawParseObject;\n\n    consumer.setPhone(userBuffer.telephone);\n    consumer.saveInStore(store, recipientId).then(()=>{\n        delete userBuffer.telephone;\n        checkOrder(recipientId, senderId)\n    });\n}\n\nfunction setLocationCheck(recipientId, senderId){\n    let userBuffer = bot.buffer[recipientId];\n\n    geocoder.reverseGeocode( userBuffer.location.lat, userBuffer.location.lng, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            setAddressComponetsInBuffer(recipientId, senderId, data.results[0])\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n            sendNullMapMessage(recipientId, senderId).then(()=>{\n                newAddress(recipientId, senderId)\n            });\n        }\n    });\n}\n\nfunction setAddress(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        store.dispatch(Actions.setAddress(recipientId, id)).then(() => {\n            let address = getData(recipientId, 'address');\n\n            Parse.Cloud.run('getProducts', { businessId: BUSINESS[senderId].BUSINESS_ID, lat: address.location.lat, lng: address.location.lng}).then(\n                function(result){\n                    let pointSale = result.pointSale;\n\n                    store.dispatch(Actions.setCustomerPointSale(recipientId, pointSale.id)).then(() => {\n                        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            return bot.sendTextMessage(recipientId, senderId, \"Perfecto, ya seleccioné tu dirección para este pedido\").then(()=>{\n                                sendCategories(recipientId, senderId, 0);\n                            })\n                        });\n                    });\n                },\n                function(error) {\n                    if(error.code == '141'){\n                        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            return bot.sendTextMessage(recipientId, senderId, \"La dirección seleccionada no está dentro de la cobertura de nuestras sedes, por favor intenta con otra dirección\").then(()=>{\n                                sendAddressesWithTitle(recipientId, senderId)\n                            });\n                        });\n                    }\n                    else{\n                        console.log('error');\n                        console.log(error);\n                    }\n                });\n            }\n        );\n    });\n}\n\nfunction editAddress(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            bot.setDataBuffer(recipientId, 'addressPayload', 'EditAddress-'+id);\n            writeAddress(recipientId, senderId);\n        });\n    });\n}\n\nfunction removeAddress(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        new Parse.Query(ConsumerAddress).get(id).then((consumerAddress) => {\n            consumerAddress.destroy().then(()=>{\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendTextMessage(recipientId, senderId, \"La dirección ha sido eliminada.\").then(()=>{\n                        sendAddresses(recipientId, senderId);\n                    })\n                });\n            });\n        });\n    });\n}\n\nfunction removeCreditCard(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=> {\n        new Parse.Query(CreditCard).get(id).then((creditCard) => {\n            creditCard.destroy().then(() => {\n                return bot.sendTypingOff(recipientId, senderId).then(() => {\n                    return bot.sendTextMessage(recipientId, senderId, \"La tarjeta de credito ha sido eliminada.\").then(() => {\n                        sendCreditCards(recipientId, senderId);\n                    });\n                });\n            });\n        });\n    });\n}\n\nfunction sendCategories(recipientId, senderId, index){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then(()=>{\n            Parse.Cloud.run('getProducts', { businessId: BUSINESS[senderId].BUSINESS_ID }).then(function(result){\n                if(result.pointSaleIsOpen) {\n                    if(typeof index == 'undefined')\n                        index = 0;\n                    else if( typeof index == 'string')\n                        index = parseInt(index);\n\n                    if(index == 0){\n                        bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            bot.sendTextMessage(recipientId, senderId, \"A continuación te presentamos las categorías de productos disponibles.\").then(()=>{\n                                sendCategoriesDetail(recipientId, senderId, result.categories, index);\n                            })\n                        });\n                    }else{\n                        bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            sendCategoriesDetail(recipientId, senderId, result.categories, index);\n                        });\n                    }\n                }else{\n                    sendScheduleRestriction(recipientId, result.pointSaleSchedules);\n                }\n            },\n            function(error) {\n                console.log('error');\n                console.log(error);\n            });\n        });\n    });\n}\n\nfunction splitCategories(recipientId, categories, index){\n    let customer = getData(recipientId, 'customer');\n    let image_url;\n\n    let idx = 0;\n    let elements = [];\n\n    categories.forEach(function(item){\n        if(item && item.get('name')){\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                let image = item.get('image');\n                image_url = (typeof image != 'undefined') ? image.url() : customer.image.url;\n                elements.push({\n                    title: item.get('name'),\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: 'Ver categoría',\n                        payload: \"SendProducts-\"+item.id+\"-0\",\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction sendCategoriesDetail(recipientId, senderId, categories, index){\n    let elements = splitCategories(recipientId, categories, index);\n    let idx = Object.keys(categories).length;\n    let buttons = [];\n    let catIni = (index + 1) * bot.limit;\n    let catFin = (idx > catIni + bot.limit) ? catIni + bot.limit : idx;\n\n    if (idx > (index + 1) * bot.limit) {\n        buttons.push({\n            type: \"postback\",\n            title: \"Categorías \" + (catIni + 1) + \"-\" + catFin,\n            payload: \"SendCategories-\" + (index + 1),\n        });\n\n        elements.push({\n            title: \"Ver más categorias \",\n            subtitle: \"Categorías disponibles\",\n            buttons: buttons\n        });\n    }\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendGenericMessage(recipientId, senderId, elements)\n    });\n}\n\nfunction sendProducts(recipientId, senderId, categoryId, proIdx){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        proIdx = parseInt(proIdx);\n        if(proIdx == 0){\n            new Parse.Query(Category).get(categoryId).then(category => {\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendTextMessage(recipientId, senderId, \"Selecciona \"+category.get('name')+\":\").then(()=>{\n                        getProducts(recipientId, senderId, categoryId, proIdx);\n                    })\n                });\n            },\n            (object, error) => {\n                console.log(error);\n            });\n        }\n        else{\n            getProducts(recipientId, senderId, categoryId, proIdx)\n        }\n    });\n}\n\nfunction getProducts(recipientId, senderId, categoryId, proIdx){\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS[senderId].BUSINESS_ID, category: categoryId }).then(result => {\n        if(result.hasOwnProperty('categories')){\n            sendCategoriesDetail(recipientId, senderId, result.categories, 0);\n        }else{\n            if(result.products.length == 0){\n                bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    bot.sendQuickReplyMessage(recipientId, senderId,\n                        \"No existen productos en esta categoría\",\n                        [{\n                            \"content_type\": \"text\",\n                            \"title\": \"Seguir pidiendo\",\n                            \"payload\": \"SendContinueOrder\"\n                        },\n                            {\n                                \"content_type\": \"text\",\n                                \"title\": \"Ver carrito\",\n                                \"payload\": \"SendCart\"\n                            }]);\n                });\n            }\n            else{\n                sendProductsDetail(recipientId, senderId, categoryId, result.products, proIdx);\n            }\n        }\n    },\n    function(error) {\n        console.log('error');\n        console.log(error);\n    })\n}\n\nfunction splitProducts(recipientId, products, proIdx){\n    let customer = getData(recipientId, 'customer');\n    let image_url;\n\n    let idx = 0;\n    let elements = [];\n\n    products.forEach(function(product){\n        if(product && product.get('name')){\n            if(idx >= (proIdx)*bot.limit && idx < (proIdx+1)*bot.limit){\n                let image = product.get('image');\n                image_url = (typeof image != 'undefined') ? image.url() : customer.image.url;\n\n                elements.push({\n                    title: product.get('name') +\": $\"+ product.get('priceDefault'),\n                    subtitle: product.get('description'),\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: \"Agregar\",\n                        payload: \"AddProduct-\"+product.id,\n                    },\n                    {\n                        type: \"postback\",\n                        title: 'Ver descripción',\n                        payload: \"SendProductDescription-\"+product.id,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction sendProductsDetail(recipientId, senderId, categoryId, products, index){\n    let elements = splitProducts(recipientId, products, index);\n    let idx = Object.keys(products).length;\n    let buttons = [];\n    let catIni = (index+1)*bot.limit;\n    let catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n\n    if(idx > (index+1)*bot.limit){\n        buttons.push({\n            type: \"postback\",\n            title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n            payload: \"SendProducts-\"+categoryId+\"-\"+(index+1),\n        });\n\n        elements.push({\n            title: \"Ver más productos \",\n            subtitle: \"Productos disponibles\",\n            buttons: buttons\n        });\n    }\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendGenericMessage(recipientId, senderId, elements)\n    });\n}\n\nfunction createCart(recipientId){\n    let userData = getData(recipientId);\n    Object.assign(userData, {'cart': {items: new Map()}});\n    return userData.cart;\n}\n\nfunction addProduct(recipientId, senderId, productId){\n    let cart = getData(recipientId, 'cart');\n\n    if(typeof cart == 'undefined'){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n\n    new Parse.Query(Product).get(productId).then(product => {\n        let productObject = extractParseAttributes(product);\n        let item = items.get(productId);\n        let promises = [];\n\n        if(typeof item == 'undefined'){\n            items.set(productId, {quantity: 1, price: productObject.priceDefault});\n            item = items.get(productId);\n        }\n        else{\n            item.quantity += 1;\n        }\n\n        if(typeof item.modifiers == 'undefined'){\n            item.modifiers = [];\n        }\n\n        if(typeof productObject.modifiers != 'undefined'){\n            productObject.modifiers.forEach(function(obj, index, array){\n                promises.push(new Parse.Query(Modifier).get(obj.objectId).then(modifier => {\n                    return extractParseAttributes(modifier);\n                }));\n            });\n        }\n\n        Parse.Promise.when(promises).then(function(modifiers) {\n\n            let undefinedModifiers = checkModifiers(recipientId, productId, modifiers);\n\n            //checkModifiersComplete(recipientId, productId, modifiers).then(result =>{\n            //    console.log('result: '+result);\n            //});\n            if(undefinedModifiers.length > 0){\n                //Show multiples modifiers\n                promises = [];\n\n                undefinedModifiers[0].items.forEach(function (modifierItem) {\n                    promises.push(new Parse.Query(ModifierItem).get(modifierItem.objectId).then(modifierItem => {\n                        return extractParseAttributes(modifierItem);\n                    }));\n                });\n\n                Parse.Promise.when(promises).then(function (modifierItems) {\n                    sendModifierMenu(recipientId, senderId, productId, undefinedModifiers[0], modifierItems);\n                })\n            }\n            else{\n                saveCart(recipientId);\n                sendAddProductNenu(recipientId, senderId, productId);\n            }\n        });\n    },\n    (object, error) => {\n        console.log(error);\n    });\n}\n\nfunction sendAddProductNenu(recipientId, senderId, productId){\n    return new Parse.Query(Product).get(productId).then(product => {\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendQuickReplyMessage(recipientId, senderId, \"El producto \" + product.get('name') + \" ha sido agregado.\\n\\nDeseas seguir pidiendo o ver tu carrito?\", [\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Seguir pidiendo\",\n                    \"payload\": \"SendContinueOrder\"\n                },\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Ver carrito\",\n                    \"payload\": \"SendCart\"\n                }\n            ])\n        });\n    },\n    (object, error) => {\n        console.log(error);\n    })\n}\n\nfunction sendContinueOrder(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        bot.sendTextMessage(recipientId, senderId, \"Puedes escribir el nombre de un producto, ej: Ensalada mediterranea, o seleccionarlo en el siguiente menú:\").then(()=>{\n            sendCategories(recipientId, senderId, 0);\n        })\n    });\n}\n\nfunction sendModifierMenu(recipientId, senderId, productId, modifier, items){\n    let quick_replies = [];\n\n    items.forEach(function (item){\n        if(quick_replies.length <= bot.limit){\n            quick_replies.push({\n                \"content_type\": \"text\",\n                \"title\": item.name,\n                \"payload\": \"AddModifier-\"+productId+\"-\"+modifier.objectId+\"-\"+item.objectId\n            });\n        }\n    });\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendQuickReplyMessage(recipientId, senderId, \"Escoge \" + modifier.name + \":\", quick_replies)\n    })\n}\n\nfunction addModifier(recipientId, senderId, productId, modifierId, itemId){\n    let cart = getData(recipientId, 'cart');\n    let items = cart.items;\n    let item = items.get(productId);\n    let orderItemModifier = new OrderItemModifier();\n\n    orderItemModifier.set('modifier', {\n        __type: \"Pointer\",\n        className: \"Modifier\",\n        objectId: modifierId\n    });\n\n    orderItemModifier.set('modifierItem', {\n        __type: \"Pointer\",\n        className: \"ModifierItem\",\n        objectId: itemId\n    });\n\n    //orderItemModifier.set('price', itemId.price)\n\n    orderItemModifier.save(undefined, {\n        success: function(result) {\n            item.modifiers.push({\n                __type: \"Pointer\",\n                className: \"OrderItemModifier\",\n                objectId: result.id\n            });\n\n            saveCart(recipientId);\n            sendAddProductNenu(recipientId, productId)\n        },\n        error: function(user, error) {\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n\n}\n\nfunction checkModifiers(recipientId, productId, modifiers){\n    let cart = getData(recipientId, 'cart');\n    let items = cart.items;\n    let item = items.get(productId);\n    let exist = false;\n    let result = [];\n\n    modifiers.forEach(function (modifier) {\n        exist = false;\n\n        item.modifiers.forEach(function (itemModifier){\n            console.log(itemModifier.objectId)\n            //exist true\n        });\n\n        if(!exist){\n            result.push(modifier);\n        }\n    });\n\n    return result;\n}\n\nfunction checkModifiersComplete(recipientId, senderId, productId, modifiers){\n    let cart = getData(recipientId, 'cart');\n    let items = cart.items;\n    let item = items.get(productId);\n    let promises = [];\n\n    console.log(modifiers);\n    console.log(modifiers.length)\n    console.log(cart.items);\n    console.log(item);\n    console.log(item.modifiers.length);\n\n    if(modifiers.length != item.modifiers.length){\n        promises = [];\n        modifiers.forEach(function (modifier) {\n            modifier.items.forEach(function (modifierItem) {\n                promises.push(new Parse.Query(ModifierItem).get(modifierItem.objectId).then(modifierItem => {\n                    return extractParseAttributes(modifierItem);\n                }));\n            });\n\n            return Parse.Promise.when(promises).then(function (elements) {\n                sendModifierMenu(recipientId, productId, modifier, elements);\n                return true;\n            });\n        });\n    }\n\n}\n\nfunction removeProduct(recipientId, senderId, productId){\n    let cart = getData(recipientId, 'cart');\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    new Parse.Query(OrderItem).get(item.id, {\n        success: (orderItem) => {\n            orderItem.destroy({});\n            items.delete(productId);\n            let itemsPointers = [];\n\n            for(let [key, value] of items) {\n                itemsPointers.push({\"__type\": \"Pointer\", \"className\": \"OrderItem\", \"objectId\": value.id})\n            }\n\n            cart.itemsPointers = itemsPointers;\n            if(items.size == 0){\n                sendCart(recipientId, senderId);\n            }\n            else{\n                sendCartDetails(recipientId, senderId)\n            }\n        },\n        error: (orderItem, error) => {\n            console.log('error');\n            console.log(error);\n        }\n    });\n}\n\nfunction increaseOneProduct(recipientId, senderId, productId){\n    let cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    item.quantity++;\n\n    new Parse.Query(OrderItem).get(item.id, {\n        success: (orderItem) => {\n            orderItem.set('amount', item.quantity);\n            orderItem.save();\n            sendCartDetails(recipientId, senderId)\n        },\n        error: (orderItem, error) => {\n            console.log('error');\n            console.log(error);\n        }\n    });\n}\n\nfunction decreaseOneProduct(recipientId, senderId, productId){\n    let cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    item.quantity--;\n\n    if(item.quantity > 0){\n        new Parse.Query(OrderItem).get(item.id, {\n            success: (orderItem) => {\n                orderItem.set('amount', item.quantity);\n                orderItem.save();\n                sendCartDetails(recipientId, senderId)\n            },\n            error: (orderItem, error) => {\n                console.log('error');\n                console.log(error);\n            }\n        });\n    }\n    else{\n        removeProduct(recipientId, productId)\n    }\n}\n\nfunction sendProductDescription(recipientId, senderId, productId){\n    let product = new Product();\n\n    new Parse.Query(product).get(productId).then(\n        product => {\n            return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                return bot.sendQuickReplyMessage(recipientId, senderId, product.get('name')+\": \"+product.get('description'), [\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Agregar\",\n                        \"payload\":\"AddProduct-\"+productId\n                    },\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Seguir pidiendo\",\n                        \"payload\":\"SendContinueOrder\"\n                    },\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Ver carrito\",\n                        \"payload\":\"SendCart\"\n                    }\n                ])\n            });\n        },\n        (object, error) => {\n            console.log(error);\n        }\n    );\n}\n\nfunction saveCart(recipientId, senderId){\n    let consumerCart = new Cart();\n    let consumer = getData(recipientId, 'consumer');\n    let address = getData(recipientId, 'address');\n    let cart = getData(recipientId, 'cart');\n    let paymentMethod = getData(recipientId, 'paymentMethod');\n    let items = [];\n    let item;\n\n    for(let [id, properties] of cart.items){\n\n        item = new OrderItem();\n\n        if(properties.hasOwnProperty('id')){\n            item.set('id', properties.id);\n        }\n\n        item.set('product', {\n            __type: \"Pointer\",\n            className: \"Product\",\n            objectId: id\n        });\n        item.set('price', properties.price);\n        item.set('amount', properties.quantity);\n        item.set('modifiers', properties.modifiers);\n        item.set('modifiersGroups', []);\n        items.push(item);\n    }\n\n    Parse.Object.saveAll(items, {\n        success: function(result) {\n            let itemsPointers = [];\n            for(let item of result){\n                let itemId = item.get('product').objectId;\n                cart.items.get(itemId).id = item.id;\n\n                itemsPointers.push({\"__type\":\"Pointer\", \"className\": \"OrderItem\", \"objectId\": item.id})\n            }\n\n            if(cart.hasOwnProperty('id')){\n                consumerCart.set('id', cart.id);\n            }\n\n            if(typeof paymentMethod != 'undefined'){\n                consumerCart.set('paymentMethod', paymentMethod.method)\n            }\n\n            consumerCart.set('consumerAddress', {\n                __type: \"Pointer\",\n                className: \"ConsumerAddress\",\n                objectId: address.objectId\n            });\n            consumerCart.set('consumer', {\n                __type: \"Pointer\",\n                className: \"Consumer\",\n                objectId: consumer.objectId\n            });\n            consumerCart.set('items', itemsPointers);\n\n            consumerCart.save(undefined, {\n                success: function(result) {\n                    cart['id'] = result.id;\n                    cart['rawParseObject'] = result;\n                    cart['itemsPointers'] = itemsPointers;\n                },\n                error: function(user, error) {\n                    console.log('Failed to create new object, with error code: ' + error.message);\n                }\n            });\n        },\n        error: function(user, error) {\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n}\n\nfunction saveOrder(recipientId, senderId){\n    getOrderState(0).then(state=>{\n        let order = new Order();\n        let consumer = getData(recipientId, 'consumer');\n        let customer = getData(recipientId, 'customer');\n        let cart = getData(recipientId, 'cart');\n        let address = getData(recipientId, 'address');\n        let paymentMethod = getData(recipientId, 'paymentMethod');\n        let pointSale = getData(recipientId, 'pointSale');\n        let total = 0 ;\n\n        cart.items.forEach(function(value, key){\n            total += value.quantity * value.price;\n        });\n\n        order.set('consumer', { __type: 'Pointer', className: 'Consumer', objectId: consumer.objectId });\n        order.set('consumerAddress', { __type: 'Pointer', className: 'ConsumerAddress', objectId: address.objectId });\n        order.set('pointSale', { __type: 'Pointer', className: 'CustomerPointSale', objectId: pointSale.objectId });\n        order.set('state', { __type: 'Pointer', className: 'OrderState', objectId: state.objectId });\n        order.set('items', cart.itemsPointers);\n        order.set('deliveryCost', pointSale.deliveryCost);\n        order.set('total', total);\n        order.set('paymentMethod', paymentMethod.method);\n        order.set('name', consumer.name);\n        order.set('email', consumer.email);\n        order.set('phone', consumer.phone);\n        order.set('platform', 'Bot');\n\n        order.save(undefined, {\n            success: function(order) {\n\n                store.dispatch(Actions.setOrder(recipientId, order)).then(() => {\n                    clearCart(recipientId);\n                });\n            },\n            error: function(user, error) {\n                console.log('Failed to create new object, with error code: ' + error.message);\n                console.log(error);\n            }\n        });\n    });\n}\n\nfunction sendPurchaseOptions(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendQuickReplyMessage(recipientId, senderId, \"Tenemos las siguientes opciones disponibles:\", [\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver categorias\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver carrito\",\n                    \"payload\":\"SendCart\"\n                }\n            ])\n        });\n    });\n}\n\nfunction sendEmptyCartOptions(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendQuickReplyMessage(recipientId, senderId, \"Tenemos las siguientes opciones disponibles:\", [\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver categorias\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Mis órdenes\",\n                    \"payload\":\"SendOrders\"\n                }\n            ])\n        });\n    });\n}\n\nfunction sendCart(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then( () =>{\n            let user = getData(recipientId, 'user');\n            let customer = getData(recipientId, 'customer');\n            let cart = getData(recipientId, 'cart');\n            let customer_image_url;\n\n            if(typeof customer != 'undefined'){\n                customer_image_url = customer.image.url;\n            }\n\n            if(cart == undefined){\n                cart = createCart(recipientId);\n            }\n\n            let items = cart.items;\n            let elements = [];\n            let element = {};\n            let total = 0;\n            let orderLimit = items.size;\n            let ind = 0;\n            let image;\n            let image_url;\n\n            if(orderLimit == 0){\n                bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendTextMessage(recipientId, senderId, \"Tu carrito de compras está vacío.\").then(()=>{\n                        sendEmptyCartOptions(recipientId, senderId);\n                    })\n                });\n            }\n            else{\n                items.forEach(function(value, key){\n                    let product = new Parse.Query(Product);\n\n                    product.get(key, {\n                        success: function (item) {\n                            image = item.get('image');\n                            image_url = customer_image_url\n                            if(image){\n                                image_url = image.url();\n                            }\n\n                            element = {};\n                            element['title'] = item.get('name');\n                            element['subtitle'] = item.get('description');\n                            element['quantity'] = value.quantity;\n                            element['price'] = parseInt(item.get('priceDefault'));\n                            element['currency'] = \"COP\";\n                            element['image_url'] = image_url;\n\n                            elements.push(element);\n                            total += element['quantity']*element['price'];\n\n                            ind++;\n\n                            if(ind == orderLimit){\n                                sendCartReceipt(recipientId, senderId, cart.id, elements, total)\n                            }\n                        },\n                        error: function (error) {\n                            alert(\"Error: \" + error.code + \" \" + error.message);\n                        }\n                    })\n                });\n            }\n        });\n    });\n}\n\nfunction sendCartReceipt(recipientId, senderId, cartId, elements, total){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let address = getData(recipientId, 'address');\n    let pointSale = getData(recipientId, 'pointSale');\n    let payment_method = getData(recipientId, 'payment_method');\n    let addressData = undefined;\n\n    if(typeof pointSale == 'undefined'){\n        bot.sendTextMessage(recipientId, senderId, \"No has registrado una dirección correcta, por favor registrala para visualizar el carrito\").then(()=>{\n            sendAddresses(recipientId, senderId)\n        });\n    }\n    else{\n        if(typeof address != 'undefined'){\n            addressData = {\n                street_1: address.address ? address.address : 'Dirección no definida',\n                street_2: address.description ? address.description : 'Sin complemento',\n                city: address.city ? address.city : 'No definida',\n                postal_code: address.postalCode ? address.postalCode : 'No definido',\n                state: address.state ? address.state : 'No definido',\n                country: address.countryCode ? address.countryCode : 'No definido'\n            }\n        }\n\n        if(typeof payment_method == 'undefined') {\n            payment_method = {name: 'Sin definir'}\n        }\n\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendReceiptMessage(recipientId, senderId, {\n                    template_type: \"receipt\",\n                    recipient_name: user.first_name+\" \"+user.last_name,\n                    order_number: cartId,\n                    currency: \"COP\",\n                    payment_method: payment_method.name,\n                    timestamp: Math.trunc(Date.now()/1000).toString(),\n                    elements: elements,\n                    address: addressData,\n                    summary: {\n                        subtotal: total,\n                        shipping_cost: pointSale.deliveryCost,\n                        total_cost: total+pointSale.deliveryCost\n                    }\n                },\n                [\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Finalizar pedido\",\n                        \"payload\":\"CheckOrder\"\n                    },\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Seguir Pidiendo\",\n                        \"payload\":\"SendContinueOrder\"\n                    },\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Modificar carrito\",\n                        \"payload\":\"SendCartDetails\"\n                    },\n                    {\n                        \"content_type\":\"text\",\n                        \"title\":\"Borrar carrito\",\n                        \"payload\": \"ClearAndSendCart\"\n                    }\n                ])\n        });\n    }\n}\n\nfunction sendCartDetails(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let cart = getData(recipientId, 'cart');\n        let customer = getData(recipientId, 'customer');\n        let consumer = getData(recipientId, 'consumer');\n        let image_url = customer.image.url;\n        let items = cart.items;\n        let promises = [];\n\n        items.forEach(function(value, key) {\n            if (promises.length <= bot.limit) {\n                promises.push(new Parse.Query(Product).get(key).then(product => {\n                    let image = product.get('image');\n                    if(image){\n                        image_url = image.url();\n                    }\n\n                    return {\n                        \"title\": product.get('name')+\": $\"+value.price,\n                        \"subtitle\": \"Cantidad solicitada: \"+value.quantity,\n                        \"image_url\": image_url,\n                        \"buttons\": [\n                            {\n                                \"type\": \"postback\",\n                                \"title\": \"Quitar\",\n                                \"payload\": \"RemoveProduct-\" + key\n                            },\n                            {\n                                \"type\": \"postback\",\n                                \"title\": \"Aumentar 1\",\n                                \"payload\": \"IncreaseOneProduct-\" + key\n                            },\n                            {\n                                \"type\": \"postback\",\n                                \"title\": \"Disminuir 1\",\n                                \"payload\": \"DecreaseOneProduct-\" + key\n                            }\n                        ]\n                    };\n                }));\n            }\n        });\n\n        return Parse.Promise.when(promises).then(function(elements) {\n            return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                return bot.sendGenericMessage(recipientId, senderId, elements).then(()=>{\n                    sendEditCartOptions(recipientId, senderId)\n                });\n            });\n        });\n    });\n}\n\nfunction sendEditCartOptions(recipientId, senderId){\n    return bot.sendQuickReplyMessage(recipientId, senderId, \"Opciones del carrito:\", [\n        {\n            \"content_type\":\"text\",\n            \"title\":\"Finalizar pedido\",\n            \"payload\":\"CheckOrder\"\n        },\n        {\n            \"content_type\":\"text\",\n            \"title\":\"Seguir pidiendo\",\n            \"payload\":\"SendContinueOrder\"\n        }\n    ]);\n}\n\nfunction editCart(recipientId, senderId){\n    let cart = getData(recipientId, 'cart');\n\n    bot.sendTypingOn(recipientId, senderId);\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendGenericMessage(recipientId, senderId, [\n            {\n                \"title\": \"Opciones\",\n                \"image_url\": SERVER_URL+\"assets/thinking.jpg\",\n                \"buttons\": [\n                    {\n                        \"type\": \"web_url\",\n                        \"url\": SERVER_URL+\"cart?\"+cart.id,\n                        \"title\": \"Remover producto\",\n                        \"webview_height_ratio\": \"full\",\n                        \"messenger_extensions\": true\n                    }\n                ]\n            }\n        ])\n    });\n\n}\n\nfunction clearCart(recipientId){\n    let cart = getData(recipientId, 'cart');\n\n    if(typeof cart != 'undefined'){\n        let items = cart.items;\n        cart.itemsPointers = [];\n\n        items.forEach(function(value, key){\n            items.delete(key);\n        });\n    }\n    return new Promise((resolve, reject) => {\n        resolve()\n    });\n}\n\nfunction clearAndSendCart(recipientId, senderId){\n    clearCart(recipientId).then(()=>{\n        sendCart(recipientId, senderId)\n    });\n}\n\nfunction checkOrder(recipientId, senderId){\n    let cart = getData(recipientId, 'cart');\n    let consumer = getData(recipientId, 'consumer');\n    let pointSale = getData(recipientId, 'pointSale');\n    let total = 0;\n\n    if(typeof cart != 'undefined'){\n        cart.items.forEach(function(value, key){\n            total += value.quantity * value.price;\n        });\n    }\n    else{\n        cart = createCart(recipientId)\n    }\n    if(typeof pointSale == 'undefined'){\n        bot.sendTextMessage(recipientId, senderId, \"No has registrado una dirección correcta, por favor registrala para visualizar el carrito\").then(()=>{\n            sendAddresses(recipientId, senderId)\n        });\n    }else{\n        if(pointSale.minOrderPrice && pointSale.minOrderPrice > total ){\n            sendMinOrderPriceRestriction(recipientId, senderId);\n        }\n        else if(typeof consumer.phone == 'undefined' || consumer.phone == ''){\n            setTelephone(recipientId, senderId)\n        }\n        else if(typeof consumer.email == 'undefined' || consumer.email == ''){\n            setEmail(recipientId, senderId)\n        }\n        else{\n            checkPayment(recipientId, senderId);\n        }\n    }\n}\n\nfunction checkAddress(recipientId, senderId){\n\n}\n\nfunction checkPayment(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        store.dispatch(Actions.loadPaymentMethods(recipientId, senderId)).then(() => {\n            let paymentMethods = getData(recipientId, 'paymentMethods');\n            let quick_replies = [];\n\n            for(let i in paymentMethods){\n                quick_replies.push({\n                    \"content_type\": \"text\",\n                    \"title\": paymentMethods[i].name.substring(0,20),\n                    \"payload\": \"Checkout-\"+paymentMethods[i].objectId\n                });\n            }\n\n            return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                return bot.sendQuickReplyMessage(recipientId, senderId, \"Como vas a pagar tu pedido? (Tu pedido se cobra cuando lo recibes)\", quick_replies)\n            });\n        });\n    });\n}\n\nfunction checkout(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        store.dispatch(Actions.setPaymentMethod(recipientId, id)).then(() => {\n            let state = store.getState();\n            let paymentTypes = state['paymentTypes'];\n            let paymentMethod = getData(recipientId, 'paymentMethod');\n            let paymentFunction = paymentTypes[paymentMethod.method.objectId];\n\n            paymentFunction(recipientId, senderId);\n        });\n    });\n}\n\nfunction sendMinOrderPriceRestriction(recipientId, senderId){\n    let pointSale = getData(recipientId, 'pointSale');\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"El valor minimo de una orden con domicilio es \"+pointSale.minOrderPrice+\", \\npor favor modifica tu pedido para cumplir este requisito\").then(()=>{\n            sendPurchaseOptions(recipientId, senderId);\n        })\n    });\n}\n\nfunction sendScheduleRestriction(recipientId, senderId, pointSaleSchedules){\n    let pointSale = getData(recipientId, 'pointSale');\n\n    let days = ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado', 'Domingo'];\n    let text ='En este momento nuestros puntos de venta estan cerrados, \\npor favor solicita tu domicilio en los siguientes horarios:\\n\\n';\n\n    for(let pointSaleSchedule of pointSaleSchedules) {\n        let daysActive = pointSaleSchedule.get('daysActive');\n        let allDay = pointSaleSchedule.get('allDay');\n\n        for(let dayID in daysActive){\n            if((daysActive.length-1) != dayID){\n                text += days[daysActive[dayID]-1]+\", \"\n            }\n            else{\n                text += \"y \"+days[daysActive[dayID]-1]+\" \"\n            }\n        }\n\n        if(allDay){\n            text += 'las 24 horas\\n'\n        }\n        else{\n            text += \"desde las \"+pointSaleSchedule.get('hourStart')+\" \";\n            text += \"hasta las \"+pointSaleSchedule.get('hourEnd');\n        }\n        text +=\"\\n\"\n    }\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, text).then(()=>{\n            sendMenu(recipientId)\n        });\n    });\n}\n\nfunction sendCash(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let paymentMethod = getData(recipientId, 'paymentMethod');\n        saveCart(recipientId);\n\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"Se ha registrado el pago con \"+paymentMethod.name ).then(()=>{\n                orderConfirmation(recipientId, senderId);\n            })\n        });\n    });\n}\n\nfunction registerCreditCard(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId);\n    authentication(recipientId, senderId).then( () => {\n        let consumer = getData(recipientId, 'consumer');\n\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendGenericMessage(recipientId, senderId, [{\n                \"title\": \"Registro de tarjeta de credito y finalización de tu pedido.\\n\\nEstas de acuerdo?\",\n                \"image_url\": SERVER_URL + \"assets/images/creditCards.jpg\",\n                \"subtitle\": \"Por razones de seguridad te redireccionaremos a una página web segura.\",\n                \"buttons\": [\n                    {\n                        \"type\": \"web_url\",\n                        \"title\": \"Si\",\n                        \"url\": SERVER_URL + \"creditCard?id=\" + consumer.objectId,\n                        \"webview_height_ratio\": \"full\",\n                        \"messenger_extensions\": true\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"No\",\n                        \"payload\": \"CancelRegisterCreditCard\"\n                    }]\n            }]);\n        });\n    });\n}\n\nfunction registerCreditCardAndPay(recipientId, senderId){\n    bot.setDataBuffer(recipientId, 'creditCardPayload', 'SendCreditCards');\n\n    registerCreditCard(recipientId, senderId)\n}\n\nfunction cancelRegisterCreditCard(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let userBuffer = bot.buffer[recipientId];\n\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"Si no ingresas los datos de tu tarjeta en nuestro sitio seguro, no podras comprar con tarjeta online\").then(()=>{\n                if (typeof userBuffer != 'undefined' && userBuffer.hasOwnProperty('creditCardPayload')) {\n                    checkPayment(recipientId);\n                }\n                else{\n                    sendAccount(recipientId, senderId);\n                }\n            });\n        });\n    });\n}\n\nfunction sendRegisteredCreditCards(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let user = getData(recipientId, 'user');\n        let consumer = getData(recipientId, 'consumer');\n\n        CreditCard.loadInStore(store, recipientId, user).then(() => {\n            let creditCards = getData(recipientId, 'creditCards');\n            if (creditCards.length == 0) {\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendQuickReplyMessage(recipientId, senderId, \"Aun no tienes tarjetas registradas, deseas registrar una tarjeta?\", [\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Si\",\n                            \"payload\":\"RegisterCreditCardAndPay\"\n                        },\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"No\",\n                            \"payload\":\"CheckPayment\"\n                        }\n                    ])\n                });\n            }\n            else {\n                let creditCards = getData(recipientId, 'creditCards');\n                let quick_replies = [];\n\n                quick_replies.push({\n                    \"content_type\": \"text\",\n                    \"title\": \"Agregar tarjeta\",\n                    \"payload\": \"RegisterCreditCardAndPay\"\n                });\n\n                for(let card of creditCards){\n                    if (quick_replies.length < bot.limit) {\n                        quick_replies.push({\n                            \"content_type\": \"text\",\n                            \"title\": card.type+\" \"+card.lastFour,\n                            \"payload\": \"PayWithCreditCard-\" + card.lastFour\n                        });\n                    }\n                }\n\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendQuickReplyMessage(recipientId, senderId, \"Con cual tarjeta quieres pagar?\", quick_replies)\n                });\n            }\n        });\n    });\n}\n\nfunction payWithCreditCard(recipientId, senderId, creditCardId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        orderConfirmation(recipientId, senderId)\n    });\n}\n\nfunction orderConfirmation(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        saveOrder(recipientId);\n        getOrderState(0).then(state=> {\n            return bot.sendTypingOff(recipientId, senderId).then(() => {\n                return bot.sendTextMessage(recipientId, senderId, state.messagePush + \"\\n\\nEn un momento te estaremos dando información en tiempo real sobre tu pedido\")\n            });\n        });\n    });\n}\n\nfunction orderState(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId);\n\n    orderSent(recipientId)\n}\n\nfunction orderSent(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"Buenas noticias, Tu pedido ha sido Enviado. \\n\\nHaz click en el mapa para vel tu pedido\").then(()=>{\n                sendserviceRating(recipientId);\n            })\n        });\n    });\n}\n\nfunction sendOrderState(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        let orderState = getData(recipientId, 'orderState');\n        let pointSale = getData(recipientId, 'pointSale');\n\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            if(orderState.order == 1){\n                return bot.sendTextMessage(recipientId, senderId, \"Tu pedido ha sido Aceptado. \\n\\nLo estan preparando en nuestra sede y te lo enviaremos en aproximadamente \"+pointSale.deliveryTime+\" minutos\")\n            }\n            else if(orderState.order == 5){\n                return bot.sendTextMessage(recipientId, senderId, orderState.messagePush).then(()=>{\n                    sendserviceRating(recipientId);\n                });\n            }\n            else if(orderState.order == 6){\n                return new Promise((resolve, reject) => {\n                    resolve()\n                });\n            }\n            else{\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    return bot.sendTextMessage(recipientId, senderId, orderState.messagePush)\n                });\n            }\n        });\n    });\n}\n\nfunction sendserviceRating(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendQuickReplyMessage(recipientId, senderId, \"Califica tu experiencia para ayudarnos a mejorar. \\n\\nDe 1 a 5 cuantas extrellas merece nuestro servicio?\", [\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"5 (Excelente)\",\n                    \"payload\":\"SetScore-5\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"4 (Bien)\",\n                    \"payload\":\"SetScore-4\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"3 (Regular)\",\n                    \"payload\":\"SetScore-3\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Mal)\",\n                    \"payload\":\"SetScore-2\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Muy mal)\",\n                    \"payload\":\"SetScore-1\"\n                },\n            ]);\n        });\n    });\n}\n\nfunction setScore(recipientId, senderId, score){\n    let order = getData(recipientId, 'order');\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        Parse.Cloud.run('rateOrder', { orderId: order.objectId, score: Number(score), comment: ''}).then(\n            function(result){\n                return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                    thank(recipientId, senderId)\n                });\n            },\n            function(error) {\n                console.log('error');\n                console.log(error);\n            });\n    });\n}\n\nfunction thank(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"Gracias, esperamos tener el gusto de atenderle nuevamente\")\n        });\n    });\n}\n\nfunction searchProducts(recipientId, senderId, query, index){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        Parse.Cloud.run('search', { businessId: BUSINESS[senderId].BUSINESS_ID, q: query }).then(\n            function(result){\n\n                if(result.length == 0){\n                    renderSearchEmpty(recipientId, senderId);\n                }\n                else if(result.length == 1 && result[0].type == 'Category'){\n                    sendProducts(recipientId, senderId, result[0].id, 0)\n                }\n                else{\n                    if(index == undefined)\n                        index = 0;\n                    else if( typeof index == 'string')\n                        index = parseInt(index);\n\n                    if(index == 0){\n                        renderSearchInitial(recipientId, senderId)\n                    }\n\n                    splitSearchResult(recipientId, result, index).then(elements => {\n                        let idx = Object.keys(result).length;\n                        let buttons = [];\n                        let catIni = (index+1)*bot.limit;\n                        let catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n\n                        if(idx > (index+1)*bot.limit){\n                            buttons.push({\n                                type: \"postback\",\n                                title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                                payload: \"Search-\"+(index+1),\n                            });\n\n                            elements.push({\n                                title: \"Ver más productos \",\n                                subtitle: \"Productos disponibles\",\n                                buttons: buttons\n                            });\n                        }\n\n                        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n                            return bot.sendGenericMessage(recipientId, senderId, elements)\n                        });\n                    });\n                }\n            },\n            function(error) {\n                console.log('error');\n                console.log(error);\n            }\n        );\n    });\n}\n\nfunction renderSearchInitial(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"Se han encontrado los siguientes productos:\")\n    });\n}\n\nfunction renderSearchEmpty(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"No se han encontrado productos que coincidan\")\n    })\n}\n\nfunction splitSearchResult(recipientId, products, index){\n    let customer = getData(recipientId, 'customer');\n    let image_url;\n    let idx = 0;\n    let elements = [];\n    let promises = [];\n\n    products.forEach(function(item){\n        if(item && item.name && item.type == 'Product'){\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                promises.push(new Parse.Query(Product).get(item.id).then(product => {\n                    return extractParseAttributes(product);\n                }));\n                idx = idx+1;\n            }\n        }\n    });\n\n    return Parse.Promise.when(promises).then(function(productObjects) {\n        productObjects.forEach(function(product) {\n            let image = product.image;\n            image_url = (typeof image != 'undefined') ? image.url : customer.image.url;\n            elements.push({\n                title: product.name +\": $\"+ product.priceDefault,\n                subtitle: product.description,\n                image_url: image_url,\n                buttons: [{\n                    type: \"postback\",\n                    title: 'Agregar',\n                    payload: \"AddProduct-\"+product.objectId,\n                },\n                    {\n                        type: \"postback\",\n                        title: 'Ver descripción',\n                        payload: \"SendProductDescription-\"+product.objectId,\n                    }]\n            });\n        })\n        return elements;\n    });\n\n    //    subtitle: item.get('description'),\n}\n\nfunction sendHelp(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId);\n    renderHelp(recipientId, senderId).then(()=>{\n        sendContactUs(recipientId, senderId);\n    });\n}\n\nfunction renderHelp(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"InOut Bot.\\n\\nTe permite visualizar las opciones de productos, agregarlos al carrito y realizar tu compra por medio del chat de facebook.\\n\\nFuncionalidades disponibles: \\n\\n'Hola', para iniciar la conversación\\n'Pedir Domicilio', si quieres realizar un domicilio\\n'Carrito', para ver el estado actual de tu carrito\")\n    });\n}\n\nfunction sendContactUs(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \" Para mayor información puedes contactarnos en:\\n\\n Web: http://www.inoutdelivery.com/\\n\\n Email: soporte@inoutdelivery.com\")\n        });\n    });\n}\n\nfunction sendOrders(recipientId, senderId){\n    bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then( () =>{\n            let consumer = getData(recipientId, 'consumer');\n            Parse.Cloud.run('ordersBot', { businessId: BUSINESS[senderId].BUSINESS_ID, consumerId: consumer.objectId}).then( orders => {\n                store.dispatch(Actions.setOrders(recipientId, orders)).then(() => {\n                    renderOrders(recipientId, senderId);\n                });\n            }).fail(error => {\n                console.log('error');\n                console.log(error);\n            });\n        });\n    });\n}\n\nfunction renderOrders(recipientId, senderId){\n    let customer = getData(recipientId, 'customer');\n    let orders = getData(recipientId, 'orders');\n    let elements = [];\n\n    elements.push({\n        \"title\": \"Nueva orden\",\n        \"subtitle\": \"Puedes realizar una orden\",\n        \"image_url\": SERVER_URL+\"assets/images/newOrden.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": \"Nueva orden\",\n                \"payload\": \"NewOrder\"\n            }\n        ]\n    });\n\n    for(let order of orders.ongoing) {\n        let pointSale = order.pointSale;\n        if (elements.length < bot.limit){\n            let datetime = DateTime.dateString(order.createdAt);\n            let image_url = customer.image.url;\n            let title = (order.orderNumber)? 'Orden: '+order.orderNumber :  'Orden: '+dateFormat(datetime, \"h:MM:ss TT dd/mm/yyyy\")\n\n            elements.push({\n                \"title\": title,\n                \"subtitle\": 'Estado: '+order.state.name+', Valor: $'+(order.total+pointSale.deliveryCost),\n                \"image_url\": image_url,\n                \"buttons\": [\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Ver orden\",\n                        \"payload\": \"SendOrder-\"+order.objectId\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Cancelar orden\",\n                        \"payload\": \"CancelOrder-\"+order.objectId\n                    }\n                ]\n            });\n        }\n    }\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendGenericMessage(recipientId, senderId, elements)\n    });\n}\n\nfunction sendOrder(recipientId, senderId, id){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then( () =>{\n            let orders = getData(recipientId, 'orders');\n            let customer = getData(recipientId, 'customer');\n            let customer_image_url = customer.image.url;\n            let currentOrder;\n            let elements = [];\n            let element;\n            let image_url;\n            let product;\n\n            for(let order of orders.ongoing){\n                if(order.objectId == id){\n                    currentOrder = order;\n                }\n            }\n\n            for(let item of currentOrder.items){\n                product = item.product;\n                image_url = customer_image_url;\n\n                if(product.image){\n                    image_url = product.image.url;\n                }\n\n                element = {};\n                element['title'] = product.name;\n                element['quantity'] = item.amount;\n                element['price'] = item.price;\n                element['currency'] = \"COP\";\n                element['image_url'] = image_url;\n\n                elements.push(element);\n            }\n\n            renderOrder(recipientId, senderId, currentOrder, elements)\n        });\n    });\n}\n\nfunction renderOrder(recipientId, senderId, order, elements){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let address = order.consumerAddress;\n    let pointSale = order.pointSale;\n    let payment_method = order.paymentMethod;\n    let addressData = undefined;\n\n    if(typeof payment_method == 'undefined'){\n        payment_method = {name: 'Sin definir'}\n    }\n\n    if(typeof address != 'undefined'){\n        addressData = {\n            street_1: address.address ? address.address : 'Dirección no definida',\n            street_2: address.description ? address.description : 'Sin complemento',\n            city: address.city ? address.city : 'No definida',\n            postal_code: address.postalCode ? address.postalCode : 'No definido',\n            state: address.state ? address.state : 'No definido',\n            country: address.countryCode ? address.countryCode : 'No definido'\n        }\n    }\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendReceiptMessage(recipientId, senderId, {\n            template_type: \"receipt\",\n            recipient_name: user.first_name+\" \"+user.last_name,\n            order_number: order.objectId,\n            currency: \"COP\",\n            payment_method: payment_method.name,\n            timestamp: Math.trunc(Date.now()/1000).toString(),\n            elements: elements,\n            address: addressData,\n            summary: {\n                subtotal: order.total,\n                shipping_cost: pointSale.deliveryCost,\n                total_cost: order.total+pointSale.deliveryCost\n            }\n        },\n        [\n            {\n                \"content_type\":\"text\",\n                \"title\":\"Nueva orden\",\n                \"payload\":\"NewOrder\"\n            },\n            {\n                \"content_type\":\"text\",\n                \"title\":\"Ver órdenes\",\n                \"payload\":\"SendOrders\"\n            },\n            {\n                \"content_type\":\"text\",\n                \"title\":\"Cancelar orden\",\n                \"payload\":\"CancelOrder-\"+order.objectId\n            }\n        ]);\n    });\n}\n\nfunction newOrder(recipientId, senderId){\n    clearCart(recipientId).then(()=>{\n        sendAddressesWithTitle(recipientId, senderId);\n    });\n}\n\nfunction cancelOrder(recipientId, senderId, id){\n    Parse.Cloud.run('changeStatusOrder', { status: \"canceledByUser\", orderId: id}).then( () => {\n        renderCancelOrder(recipientId, senderId).then(()=>{\n            sendOrders(recipientId, senderId);\n        });\n    }).fail(error => {\n        console.log('error');\n        console.log(error);\n    });\n}\n\nfunction renderCancelOrder(recipientId, senderId){\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendTextMessage(recipientId, senderId, \"La orden ha sido cancelada.\")\n    });\n}\n\nfunction sendAccount(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        authentication(recipientId, senderId).then( ()=> {\n            renderAccount(recipientId, senderId)\n        });\n    });\n}\n\nfunction renderAccount(recipientId, senderId){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let elements = [{\n        \"title\": 'Ver direcciones',\n        \"subtitle\": 'Editar y eliminar direcciones',\n        \"image_url\": SERVER_URL+\"assets/images/addresses.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": 'Ver direcciones',\n                \"payload\": \"SendAddresses\"\n            }\n        ]\n    },{\n        \"title\": 'Ver tarjetas de credito',\n        \"subtitle\": 'Editar y eliminar tarjetas de credito',\n        \"image_url\": SERVER_URL+\"assets/images/creditCards.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": 'Ver tarjetas',\n                \"payload\": \"SendCreditCards\"\n            }\n        ]\n    }];\n\n    return bot.sendTypingOff(recipientId, senderId).then(()=>{\n        return bot.sendGenericMessage(recipientId, senderId, elements)\n    });\n}\n\nfunction sendYouAreWelcome(recipientId, senderId){\n    return bot.sendTypingOn(recipientId, senderId).then(()=>{\n        return bot.sendTypingOff(recipientId, senderId).then(()=>{\n            return bot.sendTextMessage(recipientId, senderId, \"De nada, gracias por usar nuestros servicios\")\n        });\n    });\n}\n\nfunction addCreditCard(recipientId, token, data){\n    let expiration = data['expiry'].replace(/\\s+/g,\"\").split('/');\n\n    return rp({\n        uri: PARSE_SERVER_URL+'/functions/addCreditCard',\n        headers: {\n            'Content-Type': 'text/plain;charset=UTF-8',\n            'X-Parse-Application-Id': PARSE_APP_ID,\n            'X-Parse-Session-Token': token\n        },\n        method: 'POST',\n        json: { \"number\": data['number'].replace(/\\s+/g,\"\"),\n            \"holderName\": data['holderName'],\n            \"verificationNumber\": data['cvc'],\n            \"expirationMonth\": expiration[0],\n            \"expirationYear\": expiration[1]\n        }\n    }).then( body => {\n        console.log('result');\n        console.log(body);\n        rp({\n            uri: SERVER_URL+'creditCardRegistered',\n            method: 'POST',\n            json: { \"recipientId\": recipientId}\n        })\n    }).catch(error =>{\n        console.log('error');\n        console.log(error);\n        let response = error.response;\n        //console.log(JSON.stringify(error, null, 1));\n        console.log(JSON.stringify(response.body, null, 1))\n\n    });\n}\n\nfunction getOrderState(orderStateNumber){\n    return new Parse.Query(OrderState).equalTo('order', orderStateNumber).find().then( state => {\n        return extractParseAttributes(state[0]);\n    },\n    (object, error) => {\n        console.log(error);\n    });\n}\n\nmodule.exports = {store, getData}\n\nstore.dispatch({type: types.APP_LOADED});\n"]}