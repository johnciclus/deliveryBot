{"version":3,"sources":["../../../src/actions/index.js"],"names":["loadCustomer","setCustomer","loadUser","loadConsumer","loadConsumerAddresses","loadConsumerCreditCards","loadOrders","setAddress","loadPaymentMethods","setPaymentMethod","getConsumerAndAddresses","addressSaved","hideAddressForm","addressSaveError","loadUserCreditCards","setCustomerPointSale","setOrder","setUser","setConsumer","setOrderState","setOrders","loadConsumerOrders","loadProducts","filterProductsByCategory","addProductToCart","emptyCart","facebookDataLoaded","createConsumer","updateConsumer","facebookLogin","logout","emailLogin","emailRegister","geolocationPositionAcquired","mapAddressChanged","mapBoundsChanged","addressTextChanged","showMapAddress","hideMapAddress","showAddressForm","consumerAddressChanged","consumerAddressesLoaded","showAddressList","hideAddressList","selectPaymentMethod","createNewAddress","getGeoLocation","createOrder","changeCartComment","showPaymentNotSelectedModal","showEmptyCartModal","closeCartIsEmptyModal","hidePaymentNotSelectedModal","cartTotalIsBelowMinimumPrice","hideOrderMinimumPriceModal","orderCreated","unsetCurrentOrder","setCurrentOrder","loadCart","hidePointSaleClosedModal","showPointSaleClosedModal","hideProfile","showProfile","closeOutOfCoverageModal","showOufOfCoverageModal","removeItem","increaseItem","decreaseItem","toggleCart","rateOrder","showSiteMap","hideSiteMap","hideOutOfCoverageModal","loadPointSales","geolocationError","hideAddressSearchModal","showAddressSearchModal","types","BUSINESS","get","recipientId","businessId","Parse","Query","contains","limit","first","then","dispatch","type","CUSTOMER_LOADED","data","customer","fail","CUSTOMER_NOT_FOUND","Promise","as","SET_CUSTOMER","equalTo","parseInt","consumer","id","USER_LOADED","user","USER_NOT_FOUND","CONSUMER_NOT_FOUND","CONSUMER_LOADED","find","CONSUMER_ADDRESSES_LOADED","addresses","console","log","error","CONSUMER_CREDITCARDS_LOADED","creditCards","orders","undefined","SET_CURRENT_ADDRESS","address","senderId","Cloud","run","languageCode","BUSINESS_ID","paymentMethods","PAYMENT_METHODS_LOADED","SET_PAYMENT_METHOD","paymentMethod","getState","rawParseObject","ADDRESS_SAVED","HIDE_ADDRESS_FORM","ADDRESS_SAVE_ERROR","saveConsumerAddress","consumerAddress","pendingOrder","cart","ConsumerAddress","Object","extend","parseConsumerAddress","objectId","location","parseGeoPoint","GeoPoint","lat","lng","set","name","description","save","USER_CREDITCARDS_LOADED","SET_CUSTOMER_POINT_SALE","pointSale","order","SET_ORDER","SET_USER","SET_CONSUMER","orderState","SET_ORDER_STATE","SET_ORDERS","CONSUMER_ORDERS_LOADED","category","params","currentCategory","routing","locationBeforeTransitions","query","LOADING_PRODUCTS","results","PRODUCTS_LOADED","e","PRODUCTS_LOAD_ERROR","message","code","OUT_OF_COVERAGE","FILTER_PRODUCTS_BY_CATEGORY","cartItem","isValid","ADD_TO_CART","EMPTY_CART","loadFacebookUserData","accessToken","FB","api","fields","access_token","res","FACEBOOK_USER_DATA_LOADED","consumerData","mainDispatch","CONSUMER_CREATED","push","UPDATE_CONSUMER","username","CONSUMER_UPDATED","HIDE_PROFILE","CONSUMER_UPDATE_ERROR","FacebookUtils","logIn","success","existed","FACEBOOK_REGISTER_SUCCESS","FACEBOOK_LOGIN_SUCCESS","alert","User","current","logOut","window","LOGOUT","userData","EMAIL_LOGIN","email","password","EMAIL_LOGIN_SUCCESS","EMAIL_LOGIN_ERROR","EMAIL_REGISTER","signUp","EMAIL_REGISTER_SUCCESS","passwordConfirmation","EMAIL_REGISTER_ERROR","ll","geocodeLocation","GEOLOCATION_POSITION_ACQUIRED","MAP_ADDRESS_CHANGED","fromGeoLocation","geocoder","geocode","status","place","isBetweenAddress","formatted_address","indexOf","street","substr","city","address_components","forEach","component","short_name","geometry","mapBounds","MAP_BOUNDS_CHANGED","bounds","center","ADDRESS_TEXT_CHANGED","SHOW_MAP_ADDRESS","HIDE_MAP_ADDRESS","SHOW_ADDRESS_FORM","CONSUMER_ADDRESS_CHANGED","consumerAddresses","SHOW_ADDRESS_LIST","HIDE_ADDRESS_LIST","SELECT_PAYMENT_METHOD","CREATE_NEW_ADDRESS","navigator","geolocation","getCurrentPosition","position","coords","latitude","longitude","cartToOrder","items","comment","total","deliveryCost","phone","CREATE_ORDER","HIDE_CART","CREATE_ORDER_ERROR","length","minOrderPrice","pointSaleIsOpen","outOfCoverage","orderItem","item","product","amount","price","modifiers","m","modifierItem","modifier","i","orderItemModifier","add","modifiersGroups","g","modifierGroupItem","group","orderItemModifierGroup","newOrder","saveAll","ORDER_CREATED","CHANGE_CART_COMMENT","PAYMENT_NOT_SELECTED","SHOW_EMPTY_CART_MODAL","HIDE_EMPTY_CART_MODAL","PAYMENT_SELECTED","CART_TOTAL_IS_BELOW_MIN_PRICE","CART_TOTAL_IS_ABOVE_MIN_PRICE","UNSET_CURRENT_ORDER","SET_CURRENT_ORDER","cartId","HIDE_POINT_SALE_CLOSED_MODAL","SHOW_POINT_SALE_CLOSED_MODAL","SHOW_PROFILE","HIDE_OUT_OF_COVERAGE_MODAL","SHOW_OUT_OF_COVERAGE_MODAL","CART_ITEM_REMOVE","CART_ITEM_INCREASE_AMOUNT","CART_ITEM_DECREASE_AMOUNT","isOpen","TOGGLE_CART","orderId","score","RATING_ORDER","RATE_ORDER_SUCCESS","RATE_ORDER_ERROR","SHOW_SITEMAP","HIDE_SITEMAP","POINT_OF_SALES_LOADED","GEOLOCATION_ERROR","HIDE_GEOLOCATION_ERROR_MODAL","SHOW_ADDRESS_SEARCH_MODAL","renderMenu","RENDER_MENU"],"mappings":"8EA6BgBA,Y,CAAAA,Y,SAaAC,W,CAAAA,W,SAWAC,Q,CAAAA,Q,SA2BAC,Y,CAAAA,Y,SAqBAC,qB,CAAAA,qB,SAgBAC,uB,CAAAA,uB,SAaAC,U,CAAAA,U,SAUAC,U,CAAAA,U,SAeAC,kB,CAAAA,kB,SAWAC,gB,CAAAA,gB,SAYAC,uB,CAAAA,uB,SAWAC,Y,CAAAA,Y,SAUAC,e,CAAAA,e,SAOAC,gB,CAAAA,gB,SA6BAC,mB,CAAAA,mB,SAaAC,oB,CAAAA,oB,SAYAC,Q,CAAAA,Q,SAQAC,O,CAAAA,O,SAQAC,W,CAAAA,W,SAUAC,a,CAAAA,a,SAQAC,S,CAAAA,S,SAYAC,kB,CAAAA,kB,SAmDAC,Y,CAAAA,Y,SAqCAC,wB,CAAAA,wB,SAUAC,gB,CAAAA,gB,SAiBAC,S,CAAAA,S,SAuBAC,kB,CAAAA,kB,SAWAC,c,CAAAA,c,SAqBAC,c,CAAAA,c,SAsBAC,a,CAAAA,a,SAsBAC,M,CAAAA,M,SAgBAC,U,CAAAA,U,SAsBAC,a,CAAAA,a,SAwBAC,2B,CAAAA,2B,SAWAC,iB,CAAAA,iB,SA6CAC,gB,CAAAA,gB,SAaAC,kB,CAAAA,kB,SAUAC,c,CAAAA,c,SAOAC,c,CAAAA,c,SAOAC,e,CAAAA,e,SAWAC,sB,CAAAA,sB,SAWAC,uB,CAAAA,uB,SAYAC,e,CAAAA,e,SAKAC,e,CAAAA,e,SAOAC,mB,CAAAA,mB,SAUAC,gB,CAAAA,gB,SAKAC,c,CAAAA,c,SAkCAC,W,CAAAA,W,SA8GAC,iB,CAAAA,iB,SAUAC,2B,CAAAA,2B,SAOAC,kB,CAAAA,kB,SAMAC,qB,CAAAA,qB,SAMAC,2B,CAAAA,2B,SAOAC,4B,CAAAA,4B,SAOAC,0B,CAAAA,0B,SAOAC,Y,CAAAA,Y,SAOAC,iB,CAAAA,iB,SASAC,e,CAAAA,e,SAUAC,Q,CAAAA,Q,SAuBAC,wB,CAAAA,wB,SAOAC,wB,CAAAA,wB,SAIAC,W,CAAAA,W,SAIAC,W,CAAAA,W,SAIAC,uB,CAAAA,uB,SAIAC,sB,CAAAA,sB,SAIAC,U,CAAAA,U,SAIAC,Y,CAAAA,Y,SAIAC,Y,CAAAA,Y,SAIAC,U,CAAAA,U,SAIAC,S,CAA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","file":"index.js","sourcesContent":["/* @flow */\nimport * as types from '../constants/actionTypes'\n//import Parse from 'parse'\n//import { push } from 'react-router-redux'\nimport config from 'config'\nimport GetProductsParams from '../models/GetProductsParams'\nimport {\n    User,\n    Cart,\n    Consumer,\n    ConsumerAddress,\n    CreditCard,\n    Customer,\n    CustomerPointSale,\n    Modifier,\n    ModifierGroup,\n    ModifierItem,\n    Order,\n    OrderItem,\n    OrderItemModifier,\n    OrderItemModifierGroup,\n    PaymentMethodLanguage\n} from '../models/ParseModels'\n\nconst BUSINESS = config.get('BUSINESS');\n\n/**\n * Load Consumer of given user\n */\nexport function loadCustomer(recipientId, businessId) {\n  if (businessId == null) return;\n  return dispatch => {\n    return new Parse.Query(Customer).contains('businessId', businessId).limit(1).first().then(\n        customer => {\n          dispatch({type: types.CUSTOMER_LOADED, data: {recipientId, customer}})\n        }\n    ).fail(e => {\n      dispatch({type: types.CUSTOMER_NOT_FOUND, data: {recipientId, businessId}})\n    })\n  };\n}\n\nexport function setCustomer(recipientId, customer){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({ type: types.SET_CUSTOMER, data: {recipientId, customer}})\n        })\n    }\n}\n\n/**\n * Load Consumer of given user\n */\nexport function loadUser(recipientId) {\n    return dispatch => {\n        return new Parse.Query(Consumer).equalTo('recipientId', parseInt(recipientId)).first().then(consumer => {\n            if (consumer) {\n                return new Parse.Query(User).get(consumer.get('user').id).then(user => {\n                    dispatch({type: types.USER_LOADED, data: {recipientId, user}})\n                }).fail(e => {\n                    dispatch({type: types.USER_NOT_FOUND , data: {user}})\n                })\n            }\n        }).fail(e => {\n            dispatch({type: types.CONSUMER_NOT_FOUND, data: {}})\n        })\n\n        /*\n         return new Parse.Query(User).equalTo('facebookId', recipientId).first().then(user => {\n            if (user) {\n                dispatch({type: types.USER_LOADED, data: {recipientId, user}})\n            }\n         })\n        * */\n    }\n}\n\n/**\n * Load Consumer of given user\n */\nexport function loadConsumer(recipientId, user) {\n    if (user == null) return;\n    return dispatch => {\n        return new Parse.Query(Consumer).equalTo('user', user).first().then(\n            consumer => {\n              if (consumer) {\n                dispatch({type: types.CONSUMER_LOADED, data: {recipientId, consumer}})\n\n              }\n              else {\n                  dispatch({type: types.CONSUMER_NOT_FOUND, data: {user}})\n              }\n            }).fail(e => {\n            dispatch({type: types.CONSUMER_NOT_FOUND, data: {user}})\n        })\n    }\n}\n\n/**\n * Load Consumer Addresses and dispatch action with the results.\n */\nexport function loadConsumerAddresses(recipientId, consumer) {\n    if (consumer == null) return\n    return dispatch => {\n        return new Parse.Query(ConsumerAddress).equalTo('consumer', consumer).find().then(\n            addresses => {\n                dispatch({type: types.CONSUMER_ADDRESSES_LOADED, data: {recipientId, addresses}})\n        }).fail(error => {\n            console.log('Error '+error);\n            //TODO dispatch action with error\n        })\n    }\n}\n\n/**\n * Load Consumer Addresses and dispatch action with the results.\n */\nexport function loadConsumerCreditCards(recipientId, user) {\n    if (consumer == null) return\n    return dispatch => {\n        return new Parse.Query(CreditCard).equalTo('consumer', user).find().then(\n            creditCards => {\n                dispatch({type: types.CONSUMER_CREDITCARDS_LOADED, data: {recipientId, creditCards}})\n            }).fail(error => {\n            console.log('Error '+error);\n            //TODO dispatch action with error\n        })\n    }\n}\n\nexport function loadOrders(recipientId, orders){\n    if (orders == undefined) return\n    return dispatch => {\n\n    }\n}\n\n/**\n * SET_CURRENT_ADDRESS action\n */\nexport function setAddress(recipientId, id) {\n    return dispatch => {\n        return new Parse.Query(ConsumerAddress).get(id).then(\n            address => {\n                dispatch({ type: types.SET_CURRENT_ADDRESS, data: {recipientId, address}})\n        }).fail(error => {\n            console.log('Error '+error);\n            //TODO dispatch action with error\n        });\n    }\n}\n\n/**\n * Load Payment Methods.\n */\nexport function loadPaymentMethods(recipientId, senderId) {\n    return dispatch => {\n        return new Parse.Cloud.run('paymentMethods',{\n            languageCode: 'es',\n            businessId: BUSINESS[senderId].BUSINESS_ID\n        }).then((paymentMethods) => {\n            dispatch({ type: types.PAYMENT_METHODS_LOADED, data: {recipientId, paymentMethods}})\n        })\n    }\n}\n\nexport function setPaymentMethod(recipientId, id){\n  return dispatch => {\n    return new Parse.Query(PaymentMethodLanguage).get(id).then(\n        paymentMethod => {\n          dispatch({ type: types.SET_PAYMENT_METHOD, data: {recipientId, paymentMethod}})\n        }).fail(error => {\n      console.log('Error '+error);\n      //TODO dispatch action with error\n    });\n  }\n}\n\nexport function getConsumerAndAddresses(user){\n    return (dispatch, getState) => {\n        return dispatch(recipientId, loadConsumer(user)).then(() => {\n            return dispatch(loadConsumerAddresses(getState().consumer.rawParseObject))\n        })\n    }\n}\n\n/**\n * Address Saved\n */\nexport function addressSaved(address) {\n  return {\n    type: types.ADDRESS_SAVED,\n    data: address\n  }\n}\n\n/**\n * HIDE_ADDRESS_FORM action\n */\nexport function hideAddressForm() {\n    return { type: types.HIDE_ADDRESS_FORM }\n}\n\n/**\n * Address Saved Error\n */\nexport function addressSaveError() { return { type: types.ADDRESS_SAVE_ERROR } }\n\n/**\n * Save ConsumerAddress on Parse.\n */\nfunction saveConsumerAddress(consumerAddress, dispatch, pendingOrder, cart) {\n  const ConsumerAddress = Parse.Object.extend('ConsumerAddress')\n  const parseConsumerAddress = new ConsumerAddress()\n  if (!consumerAddress.consumer) { return }\n  if (consumerAddress.objectId) {\n    parseConsumerAddress.objectId = consumerAddress.objectId\n  }\n  const consumer = consumerAddress.consumer.rawParseObject\n  const location = consumerAddress.location\n  const parseGeoPoint = new Parse.GeoPoint(location.lat, location.lng)\n  parseConsumerAddress.set('location', parseGeoPoint)\n  parseConsumerAddress.set('consumer', consumer)\n  parseConsumerAddress.set('address', consumerAddress.address)\n  parseConsumerAddress.set('name', consumerAddress.name)\n  parseConsumerAddress.set('description', consumerAddress.description)\n  parseConsumerAddress.save().then(consumerAddress => {\n    dispatch(addressSaved(consumerAddress))\n    dispatch(loadConsumerAddresses(consumer, dispatch))\n    dispatch(hideAddressForm())\n  }).fail(e => {\n    dispatch(addressSaveError())\n  })\n}\n\nexport function loadUserCreditCards(recipientId, user){\n  if(user == null) return\n  return dispatch => {\n    return new Parse.Query(CreditCard).equalTo('user', user).find().then(\n        creditCards => {\n          dispatch({type: types.USER_CREDITCARDS_LOADED, data: {recipientId, creditCards}})\n        }).fail(error => {\n        console.log('Error '+error);\n      //TODO dispatch action with error\n    })\n  }\n}\n\nexport function setCustomerPointSale(recipientId, id){\n  return dispatch => {\n    return new Parse.Query(CustomerPointSale).get(id).then(\n        pointSale => {\n          dispatch({ type: types.SET_CUSTOMER_POINT_SALE, data: {recipientId, pointSale}})\n        }).fail(error => {\n      console.log('Error '+error);\n      //TODO dispatch action with error\n    });\n  }\n}\n\nexport function setOrder(recipientId, order){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({type: types.SET_ORDER, data: {recipientId, order}})\n        })\n    }\n}\n\nexport function setUser(recipientId, user){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({ type: types.SET_USER, data: {recipientId, user}})\n        })\n    }\n}\n\nexport function setConsumer(recipientId, consumer){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({ type: types.SET_CONSUMER, data: {recipientId, consumer}})\n        })\n    }\n}\n\n\n\nexport function setOrderState(recipientId, orderState){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({ type: types.SET_ORDER_STATE, data: {recipientId, orderState}})\n        })\n    }\n}\n\nexport function setOrders(recipientId, orders){\n    return dispatch => {\n        return Parse.Promise.as().then(() => {\n            dispatch({ type: types.SET_ORDERS, data: {recipientId, orders}})\n        })\n    }\n}\n\n/**\n * Load Orders from Parse calling 'orders' cloud function.\n * It will dispatch CONSUMER_ORDERS_LOADED with ongoing and delivered orders.\n */\nexport function loadConsumerOrders(recipientId, consumer) {\n    if (consumer == null) return\n    return dispatch => {\n        /*\n        return Parse.Cloud.run('orders').then((orders) => {\n            console.log(orders);\n        })\n        */\n\n        return new Parse.Query(Order).equalTo('consumer', consumer).find().then(\n            orders => {\n                console.log(orders);\n                dispatch({type: types.CONSUMER_ORDERS_LOADED, data: {recipientId, orders}})\n            }).fail(error => {\n            console.log('Error '+error);\n        })\n\n    }\n\n   /*return dispatch => {\n    Parse.Cloud.run('orders', { businessId: BUSINESS[senderId].BUSINESS_ID }).then(orders => {\n      dispatch({\n        type: types.CONSUMER_ORDERS_LOADED,\n        data: orders\n      })\n\n       const ordersObjectId = orders.ongoing.map(o => o.id)\n       const ordersQuery = new Parse.Query(Order)\n       ordersQuery.containedIn('objectId', ordersObjectId)\n       ordersQuery.find().then(function (o) { console.log(o) })\n       const subscription = ordersQuery.subscribe()\n       subscription.on('open', () => { console.log('Opened') })\n       subscription.on('create', () => { console.log('created', arguments) })\n       subscription.on('enter', () => { console.log('entered', arguments) })\n       subscription.on('leave', () => { console.log('left', arguments) })\n       subscription.on('update', (orders) => {\n       console.log('Orders Updated', orders)\n       dispatch({\n       type: types.CONSUMER_ORDERS_LOADED,\n       data: orders\n       })\n       })\n    }).fail(e => {\n    })\n  }*/\n}\n\n\n/**\n* Load products from Parse.\n*/\nexport function loadProducts(senderId, lat, lng, category, pointSale ) {\n  return (dispatch, getState) => {\n    let params = new GetProductsParams(BUSINESS[senderId].BUSINESS_ID)\n    if (lat && lng) {\n      params.lat = lat\n      params.lng = lng\n    }\n    const currentCategory = getState().routing.locationBeforeTransitions.query.category\n    if (category) {\n      params.category = category\n    } else if (currentCategory) {\n      params.category = currentCategory\n    }\n    if (pointSale) {\n      params.pointSale = pointSale\n    }\n    dispatch({type: types.LOADING_PRODUCTS})\n    Parse.Cloud.run('getProducts', params).then((results) => {\n      dispatch({\n        type: types.PRODUCTS_LOADED,\n        data: results\n      })\n    }).fail((e) => {\n      dispatch({type: types.PRODUCTS_LOAD_ERROR})\n      try {\n        if (e.message.code === 1001) {\n          dispatch({type: types.OUT_OF_COVERAGE, data: {lat, lng}})\n          dispatch(loadPointSales())\n        }\n      } catch (e) {}\n    })\n  }\n}\n\n/**\n* Filter products by given category\n*/\nexport function filterProductsByCategory(category) {\n  return {\n    type: types.FILTER_PRODUCTS_BY_CATEGORY,\n    data: category\n  }\n}\n\n/**\n* Add Product to cart action\n*/\nexport function addProductToCart(cartItem) {\n  return (dispatch, getState) => {\n    const { cart } = getState()\n    if (cart.consumerAddress.location.isValid()) {\n      dispatch({\n        type: types.ADD_TO_CART,\n        data: cartItem\n      })\n    } else {\n      dispatch(showAddressSearchModal())\n    }\n  }\n}\n\n/**\n* Empty cart action\n*/\nexport function emptyCart() {\n  return { type: types.EMPTY_CART }\n}\n\n/**\n* Load User's Facebook data.\n*/\nfunction loadFacebookUserData(accessToken, dispatch) {\n  FB.api('/me', {\n    fields: 'email, first_name, last_name',\n    access_token: accessToken\n  }, function (res) {\n    if (!res.error) {\n      dispatch(facebookDataLoaded(res))\n    } else {\n      //TODO dispatch error event\n    }\n  })\n}\n\n/**\n* Facebook Data Loaded\n*/\nexport function facebookDataLoaded(data) {\n  return {type: types.FACEBOOK_USER_DATA_LOADED, data}\n}\n\n\n\n\n\n/**\n* Create Consumer\n*/\nexport function createConsumer(consumerData, mainDispatch) {\n  return dispatch => {\n    const consumer = new Consumer()\n    consumer.save(consumerData).then( consumer => {\n      dispatch({type: types.CONSUMER_CREATED, data: {\n        user: consumerData.user, consumer\n      }})\n      dispatch({type: types.CONSUMER_LOADED, data: {consumer}})\n      mainDispatch(push('/'))\n    }).fail(e => {\n      dispatch({type: types.CONSUMER_NOT_FOUND, data: {user: consumerData.user}})\n    })\n  }\n}\n\n/**\n* Update Consumer.\n* Update consumer's user in success callback.\n* It only dispatches CONSUMER_UPDATED if Consumer and ParseUser were\n* saved successfully.\n*/\nexport function updateConsumer(senderId, consumerData) {\n  return dispatch => {\n    dispatch({type: types.UPDATE_CONSUMER, data: consumerData})\n    const consumer = new Consumer()\n    consumer.objectId = consumerData.objectId\n    consumer.save(consumerData).then( consumer => {\n      let username = consumer.get('email') + BUSINESS[senderId].BUSINESS_ID\n      consumer.get('user').save({username}).then(u => {\n        dispatch({type: types.CONSUMER_UPDATED, data: {consumer}})\n        dispatch({type: types.HIDE_PROFILE})\n      }).fail(e => {\n        dispatch({type: types.CONSUMER_UPDATE_ERROR, data: {consumer}})\n      })\n    }).fail(e => {\n      dispatch({type: types.CONSUMER_UPDATE_ERROR, data: {consumer}})\n    })\n  }\n}\n\n/**\n* Facebook Login Success\n*/\nexport function facebookLogin (mainDispatch) {\n  return dispatch => {\n    Parse.FacebookUtils.logIn(null, {\n      success: function(user) {\n        if (!user.existed()) {\n          dispatch({type: types.FACEBOOK_REGISTER_SUCCESS})\n        } else {\n          dispatch({type: types.FACEBOOK_LOGIN_SUCCESS, data: user})\n        }\n        mainDispatch(push('/'))\n        dispatch(loadConsumer(user, mainDispatch))\n      },\n      error: function(user, error) {\n        alert(\"Login cancelado.\")\n      }\n    })\n  }\n}\n\n/**\n* Logout\n*/\nexport function logout(mainDispatch) {\n  return dispatch =>{\n\n    if(Parse.User.current()) {\n      Parse.User.logOut()\n    }\n\n    mainDispatch(push('/'))\n    window.location = \"/\"\n    dispatch({type: types.LOGOUT})\n  }\n}\n\n/**\n* Email Login Action\n*/\nexport function emailLogin(senderId, userData, mainDispatch) {\n  mainDispatch({type: types.EMAIL_LOGIN})\n  return dispatch => {\n    Parse.User.logIn(userData.email + BUSINESS[senderId].BUSINESS_ID, userData.password).then(user => {\n      dispatch({\n        type: types.EMAIL_LOGIN_SUCCESS,\n        data: user\n      })\n      mainDispatch(push('/'))\n      dispatch(loadConsumer(user, mainDispatch))\n    }).fail(e => {\n      dispatch({\n        type: types.EMAIL_LOGIN_ERROR,\n        data: e\n      })\n    })\n  }\n}\n\n/**\n* Email Login Action\n*/\nexport function emailRegister(senderId, userData, mainDispatch) {\n  mainDispatch({type: types.EMAIL_REGISTER})\n  return dispatch => {\n    Parse.User.signUp(userData.email + BUSINESS[senderId].BUSINESS_ID, userData.password).then(user => {\n      dispatch({\n        type: types.EMAIL_REGISTER_SUCCESS,\n        data: {user, userData}\n      })\n      delete userData.password\n      delete userData.passwordConfirmation\n      userData.user = user\n      dispatch(createConsumer(userData, mainDispatch))\n    }).fail(e => {\n      dispatch({\n        type: types.EMAIL_REGISTER_ERROR,\n        data: e\n      })\n    })\n  }\n}\n\n/**\n* Geolocation Position Acquired action.\n*/\nexport function geolocationPositionAcquired(ll, mainDispatch) {\n  geocodeLocation(ll, mainDispatch, true)\n  return {\n    type: types.GEOLOCATION_POSITION_ACQUIRED,\n    data: ll\n  }\n}\n\n/**\n* Map Address Changed\n*/\nexport function mapAddressChanged(address) {\n  return {\n    type: types.MAP_ADDRESS_CHANGED,\n    data: address\n  }\n}\n\n\n\n\n/**\n* Geocode Given Location and dispatch MAP_ADDRESS_CHANGED action.\n*/\nfunction geocodeLocation(location, mainDispatch, fromGeoLocation) {\n  geocoder.geocode({location}, (results, status) => {\n    if (status === \"OK\") {\n      const place = results[0]\n      const address = {}\n\n      let isBetweenAddress = -1\n      isBetweenAddress = place.formatted_address.indexOf(\" a \")\n      if (isBetweenAddress === -1) {\n        address.address = place.formatted_address\n      } else {\n        let street = place.formatted_address.substr(0, isBetweenAddress)\n        let city = \"\"\n        place.address_components.forEach(component => {\n          if (component.types.indexOf(\"locality\") !== -1) city = component.short_name\n        })\n        address.address = street + \", \" + city\n      }\n\n      address.location = {\n        lat: place.geometry.location.lat(),\n        lng: place.geometry.location.lng()\n      }\n      address.fromGeoLocation = fromGeoLocation\n      mainDispatch(mapAddressChanged(address))\n    }\n  })\n}\n\n/**\n* Map Location Changed, geocode and send MAP_ADDRESS_CHANGED with geocoded result\n*/\nexport function mapBoundsChanged(mapBounds, mainDispatch) {\n  mainDispatch({\n    type: types.MAP_BOUNDS_CHANGED,\n    data: mapBounds.bounds\n  })\n  return dispatch => {\n    geocodeLocation(mapBounds.center, mainDispatch)\n  }\n}\n\n/**\n* Address Text Changed\n*/\nexport function addressTextChanged(address) {\n  return {\n    type: types.ADDRESS_TEXT_CHANGED,\n    data: address\n  }\n}\n\n/**\n* SHOW_MAP_ADDRESS action\n*/\nexport function showMapAddress() {\n  return { type: types.SHOW_MAP_ADDRESS }\n}\n\n/**\n* HIDE_MAP_ADDRESS action\n*/\nexport function hideMapAddress() {\n  return { type: types.HIDE_MAP_ADDRESS }\n}\n\n/**\n* SHOW_ADDRESS_FORM action\n*/\nexport function showAddressForm() {\n  return { type: types.SHOW_ADDRESS_FORM }\n}\n\n\n\n\n\n/**\n* CONSUMER_ADDRESS_CHANGED action\n*/\nexport function consumerAddressChanged(consumerAddress, dispatch, pendingOrder, cart) {\n  saveConsumerAddress(consumerAddress, dispatch, pendingOrder, cart)\n  return {\n    type: types.CONSUMER_ADDRESS_CHANGED,\n    data: consumerAddress\n  }\n}\n\n/**\n* CONSUMER ADDRESS LOADED action\n*/\nexport function consumerAddressesLoaded(consumerAddresses) {\n  return {\n    type: types.CONSUMER_ADDRESSES_LOADED,\n    data: consumerAddresses\n  }\n}\n\n\n\n/**\n* SHOW_ADDRESS_LIST action\n*/\nexport function showAddressList() {return {type: types.SHOW_ADDRESS_LIST}}\n\n/**\n* HIDE_ADDRESS_LIST action\n*/\nexport function hideAddressList() {return {type: types.HIDE_ADDRESS_LIST}}\n\n\n\n/**\n* Select Payment Method action\n*/\nexport function selectPaymentMethod(paymentMethod) {\n  return {\n    type: types.SELECT_PAYMENT_METHOD,\n    data: paymentMethod\n  }\n}\n\n/**\n* Create New Address action\n*/\nexport function createNewAddress() { return { type: types.CREATE_NEW_ADDRESS } }\n\n/**\n* Get Geolocation\n*/\nexport function getGeoLocation(dispatch) {\n  if (\"geolocation\" in navigator) {\n    navigator.geolocation.getCurrentPosition(position => {\n      const ll = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude\n      }\n      dispatch(geolocationPositionAcquired(ll, dispatch))\n    })\n  }\n}\n\n/**\n* Convert Cart to Order\n*/\nfunction cartToOrder(cart, items) {\n  return {\n    items: items,\n    comment: cart.comment,\n    consumer: cart.consumer.rawParseObject,\n    pointSale: cart.pointSale.rawParseObject,\n    paymentMethod: cart.paymentMethod,\n    consumerAddress: cart.consumerAddress.rawParseObject,\n    total: cart.total,\n    deliveryCost: cart.pointSale.deliveryCost,\n    email: cart.consumer.email,\n    name: cart.consumer.name,\n    phone: cart.consumer.phone\n  }\n}\n\n/**\n* Create Order Action\n*/\nexport function createOrder(cart, mainDispatch) {\n  mainDispatch(push('/'))\n  mainDispatch({type: types.CREATE_ORDER})\n  const consumer = cart.consumerAddress.consumer\n\n  //Go to Login route if cart has no consumer\n  if (!consumer.objectId) {\n    mainDispatch({type: types.HIDE_CART})\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(push('/login'))\n  }\n\n  //Check that cart has at least 1 item.\n  if (cart.items.length === 0) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(showEmptyCartModal())\n  }\n\n  //If payment method isn't set, dispatch action to show payment method modal\n  if (!cart.paymentMethod) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(showPaymentNotSelectedModal())\n  }\n\n  //If cart total price is below point of sale minimum price dispatch action\n  //to show minimum price modal\n  if (cart.total < cart.pointSale.minOrderPrice) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(cartTotalIsBelowMinimumPrice())\n  }\n\n  //If cart hasn't consumer address show list of address.\n  if (!cart.consumerAddress.objectId) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(showAddressList())\n  }\n\n  //Check if Point of Sale is open\n  if (!cart.pointSaleIsOpen) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(showPointSaleClosedModal())\n  }\n  //Check if is inside coverage\n  if (cart.outOfCoverage) {\n    mainDispatch({type: types.CREATE_ORDER_ERROR})\n    return mainDispatch(showOufOfCoverageModal())\n  }\n\n  const items = []\n  cart.items.forEach(item => {\n    const orderItem = new OrderItem()\n    orderItem.set('modifiers', [])\n    orderItem.set('modifiersGroups', [])\n    orderItem.set('product', item.product.rawParseObject)\n    orderItem.set('amount', item.amount)\n    orderItem.set('price', item.price)\n    //Set OrderItemModifiers\n    item.modifiers.forEach(modifierItem => {\n      const m = new Modifier()\n      m.id = modifierItem.modifier.objectId\n      const i = new ModifierItem()\n      i.id = modifierItem.modifierItem.objectId\n      const orderItemModifier = new OrderItemModifier({\n        modifier: m,\n        modifierItem: i,\n        price: modifierItem.price\n      })\n      orderItem.add('modifiers', orderItemModifier)\n    })\n    //Set Modifiers Group\n    item.modifiersGroups.forEach(modifierGroupItem => {\n      const g = new ModifierGroup()\n      g.id = modifierGroupItem.group.objectId\n      const orderItemModifierGroup = new OrderItemModifierGroup({\n        group: g,\n        items: []\n      })\n      modifierGroupItem.items.forEach(modifierItem => {\n        const m = new Modifier()\n        m.id = modifierItem.modifier.objectId\n        const i = new ModifierItem()\n        i.id = modifierItem.modifierItem.objectId\n        orderItemModifierGroup.add('items', new OrderItemModifier({\n          modifier: m,\n          modifierItem: i,\n          price: modifierItem.price\n        }))\n      })\n      orderItem.add('modifiersGroups', orderItemModifierGroup)\n    })\n    items.push(orderItem)\n  })\n\n  const newOrder = new Order()\n  newOrder.set(cartToOrder(cart, items))\n  Parse.Object.saveAll(items).then(function () {\n    return newOrder.save()\n  }).then(order => {\n    mainDispatch({type: types.ORDER_CREATED, data: order})\n    mainDispatch(emptyCart())\n    mainDispatch(loadConsumerOrders())\n    mainDispatch(toggleCart(false))\n  }).fail(e => {\n    alert('Hubo un error al crear su pedido, por favor intenta nuevamente.')\n  })\n}\n\n/**\n* Change Cart Comment Action\n*/\nexport function changeCartComment(comment) {\n  return {\n    type: types.CHANGE_CART_COMMENT,\n    data: comment\n  }\n}\n\n/**\n* Show Payment not selected Modal action\n*/\nexport function showPaymentNotSelectedModal() {\n  return { type: types.PAYMENT_NOT_SELECTED }\n}\n\n/**\n* Show Cart is Empty Modal\n*/\nexport function showEmptyCartModal() {\n  return { type: types.SHOW_EMPTY_CART_MODAL }\n}\n/**\n* Hide Cart is Empty Modal\n*/\nexport function closeCartIsEmptyModal() {\n  return { type: types.HIDE_EMPTY_CART_MODAL }\n}\n/**\n* Hide Payment not selected Modal action\n*/\nexport function hidePaymentNotSelectedModal() {\n  return { type: types.PAYMENT_SELECTED }\n}\n\n/**\n* Action to show cart minimum price modal\n*/\nexport function cartTotalIsBelowMinimumPrice() {\n  return { type: types.CART_TOTAL_IS_BELOW_MIN_PRICE }\n}\n\n/**\n* Action to hide cart minimum price modal\n*/\nexport function hideOrderMinimumPriceModal() {\n  return { type: types.CART_TOTAL_IS_ABOVE_MIN_PRICE }\n}\n\n/**\n* Order Created Action\n*/\nexport function orderCreated(order) {\n  return {\n    type: types.ORDER_CREATED,\n    data: order\n  }\n}\n\nexport function unsetCurrentOrder() {\n  return {type: types.UNSET_CURRENT_ORDER}\n}\n\n\n\n/**\n* Set current order action\n*/\nexport function setCurrentOrder(order) {\n  return {\n    type: types.SET_CURRENT_ORDER,\n    data: order\n  }\n}\n\n/**\n* Load Cart by Id.\n*/\nexport function loadCart(cartId) {\n  return {type: 'NOTHING'}\n  /* * /\n  //Disabled due to malfunction.\n  return dispatch => {\n    new Parse.Query(Cart).include([\"consumer\", \"pointSale\",\n        \"consumerAddress.consumer\", \"items.product\",\n        \"items.modifiers.modifier.items\", \"items.modifiers.modifierItem\",\n        \"items.modifiersGroups.group.modifiers.items\",\n        \"items.modifiersGroups.items.modifier.items\",\n        \"items.modifiersGroups.items.modifierItem\"\n      ]).get(cartId).then(cart => {dispatch({\n        type: types.CART_LOADED,\n        data: cart\n      })\n    })\n  }\n  /* */\n}\n\n/**\n* Close Point Sale Closed Modal\n*/\nexport function hidePointSaleClosedModal() {\n  return {type: types.HIDE_POINT_SALE_CLOSED_MODAL}\n}\n\n/**\n* Open Point Sale Closed Modal\n*/\nexport function showPointSaleClosedModal() {\n  return {type: types.SHOW_POINT_SALE_CLOSED_MODAL}\n}\n\nexport function hideProfile() {\n  return {type: types.HIDE_PROFILE}\n}\n\nexport function showProfile() {\n  return {type: types.SHOW_PROFILE}\n}\n\nexport function closeOutOfCoverageModal() {\n  return {type: types.HIDE_OUT_OF_COVERAGE_MODAL}\n}\n\nexport function showOufOfCoverageModal() {\n  return {type: types.SHOW_OUT_OF_COVERAGE_MODAL}\n}\n\nexport function removeItem(item) {\n  return {type: types.CART_ITEM_REMOVE, data: item}\n}\n\nexport function increaseItem(item) {\n  return {type: types.CART_ITEM_INCREASE_AMOUNT, data: item}\n}\n\nexport function decreaseItem(item) {\n  return {type: types.CART_ITEM_DECREASE_AMOUNT, data: item}\n}\n\nexport function toggleCart(isOpen) {\n  return {type: types.TOGGLE_CART, data: isOpen}\n}\n\nexport function rateOrder(orderId, score, comment) {\n  return dispatch => {\n    dispatch({type: types.RATING_ORDER})\n    Parse.Cloud.run('rateOrder', {orderId, score, comment}).then(function () {\n      dispatch({type: types.RATE_ORDER_SUCCESS})\n      return dispatch(loadConsumerOrders())\n    }).fail(function (e) {\n      return {type: types.RATE_ORDER_ERROR, data: e}\n    })\n  }\n}\n\nexport function showSiteMap () {\n  return { type: types.SHOW_SITEMAP}\n}\n\nexport function hideSiteMap () {\n  return { type: types.HIDE_SITEMAP }\n}\n\nexport function hideOutOfCoverageModal() {\n  return { type: types.HIDE_OUT_OF_COVERAGE_MODAL }\n}\n\n/**\n* Load Point of Sales of given businessId.\n*/\nexport function loadPointSales (senderId) {\n  const params = {businessId: BUSINESS[senderId].BUSINESS_ID}\n  return dispatch => {\n    Parse.Cloud.run('getPointSales', params).then((results) => {\n      dispatch({type: types.POINT_OF_SALES_LOADED, data: results})\n    })\n  }\n}\n\n/**\n* Geolocation error.\n*/\nexport function geolocationError() {\n  return {type: types.GEOLOCATION_ERROR }\n}\n\n/**\n* Hide Geolocation Error Modal.\n*/\nexport function hideAddressSearchModal() {\n  return {type: types.HIDE_GEOLOCATION_ERROR_MODAL }\n}\n\n/**\n* Show Address Search Modal.\n*/\nexport function showAddressSearchModal() {\n  return {type: types.SHOW_ADDRESS_SEARCH_MODAL }\n}\n\n\nfunction renderMenu() {\n    return {type: types.RENDER_MENU }\n}"]}