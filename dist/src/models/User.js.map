{"version":3,"sources":["../../../src/models/User.js"],"names":["FACEBOOK_GRAPH","get","User","Parse","Object","extend","initialize","attrs","options","signUpWithFacebookData","data","facebookId","signUp","assign","username","toString","password","fail","console","log","error","message","registered","Query","equalTo","first","createConsumer","store","recipientId","conversationToken","consumer","conversationId","parseInt","setUser","save","then","saveInStore","dispatch","loadInStore","getFacebookUserData","uri","qs","access_token","fields","method","JSON","parse","body","catch","createUser","user","id"],"mappings":"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","file":"User.js","sourcesContent":["import { setUser, loadUser } from '../actions/index';\nimport Consumer from '../models/Consumer';\nimport rp from 'request-promise';\nimport config from 'config';\n\nconst FACEBOOK_GRAPH = config.get('FACEBOOK_GRAPH');\n\nconst User = Parse.Object.extend('User', {\n    initialize: function (attrs, options) {\n        //console.log('new user');\n        //console.log();\n        //console.log(options);\n    },\n    signUpWithFacebookData: function(data){\n        let facebookId = this.get('facebookId');\n        return this.signUp(Object.assign(data, {\n            username: facebookId.toString(),\n            password: facebookId.toString()\n        })).fail(error => {\n            console.log('Error code: ' + error.message);\n        });\n    },\n    registered: function () {\n        return new Parse.Query('User').equalTo('facebookId', this.get('facebookId')).first().fail(error => {\n            console.log('Error code: ' + error.message);\n        });\n    },\n    createConsumer: function(store, recipientId, conversationToken){\n        let consumer = new Consumer({conversationId: parseInt(recipientId), conversationToken: conversationToken});\n        consumer.setUser(this);\n        return consumer.save().then(()=>{\n            return consumer.saveInStore(store, recipientId)\n        });\n    },\n    saveInStore: function(store, recipientId){\n        return store.dispatch(setUser(recipientId, this)).fail(error => {\n            console.log('Error code: ' + error.message);\n        });\n    }\n},  {\n    loadInStore: function(store, recipientId){\n        return store.dispatch(loadUser(recipientId)).fail(error => {\n            console.log('Error code: ' + error.message);\n        });\n    },\n    getFacebookUserData: function(facebookId, conversationToken){\n        return rp({\n            uri: FACEBOOK_GRAPH + facebookId,\n            qs: {access_token: conversationToken, fields: 'first_name,last_name,locale,timezone,gender'},\n            method: 'GET'\n        }).then( body => {\n            return JSON.parse(body);\n        }).catch(error =>{\n            console.log('error');\n            console.log(error);\n        });\n    },\n    createUser: function(store, recipientId, facebookId, conversationToken){\n        let user = new User({facebookId: parseInt(facebookId)});\n        return User.getFacebookUserData(facebookId, conversationToken).then(data => {\n            delete data.id;\n            return user.signUpWithFacebookData(data).then(() => {\n                return user.saveInStore(store, recipientId)\n            });\n        });\n    }\n});\n\nexport default User"]}