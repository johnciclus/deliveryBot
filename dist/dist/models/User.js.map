{"version":3,"sources":["../../models/User.js"],"names":["Object","defineProperty","exports","value","_index","require","_Consumer","_Consumer2","_interopRequireDefault","_requestPromise","_requestPromise2","_config","_config2","obj","__esModule","default","FACEBOOK_GRAPH","get","User","Parse","extend","initialize","attrs","options","signUpWithFacebookData","data","facebookId","signUp","assign","username","toString","password","fail","error","console","log","message","registered","Query","equalTo","first","createConsumer","store","recipientId","senderId","conversationToken","consumer","parseInt","setUser","save","then","saveInStore","dispatch","loadInStore","loadUser","getFacebookUserData","uri","qs","access_token","fields","method","body","JSON","parse","catch","createUser","user","id"],"mappings":"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","file":"User.js","sourcesContent":["'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});var _index=require('../actions/index');var _Consumer=require('../models/Consumer');var _Consumer2=_interopRequireDefault(_Consumer);var _requestPromise=require('request-promise');var _requestPromise2=_interopRequireDefault(_requestPromise);var _config=require('config');var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var FACEBOOK_GRAPH=_config2.default.get('FACEBOOK_GRAPH');var User=Parse.Object.extend('User',{initialize:function initialize(attrs,options){//console.log('new user');\n//console.log();\n//console.log(options);\n},signUpWithFacebookData:function signUpWithFacebookData(data){var facebookId=this.get('facebookId');return this.signUp(Object.assign(data,{username:facebookId.toString(),password:facebookId.toString()})).fail(function(error){console.log('Error code: '+error.message);});},registered:function registered(){return new Parse.Query('User').equalTo('facebookId',this.get('facebookId')).first().fail(function(error){console.log('Error code: '+error.message);});},createConsumer:function createConsumer(store,recipientId,senderId,conversationToken){var consumer=new _Consumer2.default({recipientId:parseInt(recipientId),senderId:parseInt(senderId),conversationToken:conversationToken});consumer.setUser(this);return consumer.save().then(function(){return consumer.saveInStore(store,recipientId);});},saveInStore:function saveInStore(store,recipientId){return store.dispatch((0,_index.setUser)(recipientId,this)).fail(function(error){console.log('Error code: '+error.message);});}},{loadInStore:function loadInStore(store,recipientId){return store.dispatch((0,_index.loadUser)(recipientId)).fail(function(error){console.log('Error code: '+error.message);});},getFacebookUserData:function getFacebookUserData(facebookId,conversationToken){return(0,_requestPromise2.default)({uri:FACEBOOK_GRAPH+facebookId,qs:{access_token:conversationToken,fields:'first_name,last_name,locale,timezone,gender'},method:'GET'}).then(function(body){return JSON.parse(body);}).catch(function(error){console.log('error');console.log(error);});},createUser:function createUser(store,recipientId,facebookId,conversationToken){var user=new User({facebookId:parseInt(facebookId)});return User.getFacebookUserData(facebookId,conversationToken).then(function(data){delete data.id;return user.signUpWithFacebookData(data).then(function(){return user.saveInStore(store,recipientId);});});}});exports.default=User;"]}