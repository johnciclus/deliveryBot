{"version":3,"sources":["../server-compiled.js"],"names":["_express","require","_express2","_interopRequireDefault","_bodyParser","_bodyParser2","_config","_config2","_crypto","_crypto2","_request","_request2","obj","__esModule","default","APP_SECRET","process","env","MESSENGER_APP_SECRET","get","VALIDATION_TOKEN","MESSENGER_VALIDATION_TOKEN","PAGE_ACCESS_TOKEN","MESSENGER_PAGE_ACCESS_TOKEN","SERVER_URL","PARSE_APP_ID","PARSE_SERVER_URL","FACEBOOK_APP_ID","REDIRECT_URI","console","error","exit","app","set","PORT","use","json","verify","verifyRequestSignature","static","rules","Map","req","res","buf","signature","headers","elements","split","method","signatureHash","expectedHash","createHmac","update","digest","Error","receivedAuthentication","event","senderID","sender","id","recipientID","recipient","timeOfAuth","timestamp","passThroughParam","optin","ref","log","sendTextMessage","receivedMessage","timeOfMessage","message","JSON","stringify","isEcho","is_echo","messageId","mid","appId","app_id","metadata","messageText","text","messageAttachments","attachments","quickReply","quick_reply","quickReplyPayload","payload","sendImageMessage","sendGifMessage","sendAudioMessage","sendVideoMessage","sendFileMessage","sendButtonMessage","sendGenericMessage","sendReceiptMessage","sendQuickReply","sendReadReceipt","sendTypingOn","sendTypingOff","sendAccountLinking","toLowerCase","receivedDeliveryConfirmation","delivery","messageIDs","mids","watermark","sequenceNumber","seq","forEach","messageID","receivedPostback","timeOfPostback","postback","sendMenuMessage","startsWith","params","listCategories","parseInt","listProducts","addProduct","sendBillMessage","receivedMessageRead","read","receivedAccountLink","status","account_linking","authCode","authorization_code","callSendAPI","messageData","uri","qs","access_token","response","body","statusCode","recipientId","recipient_id","message_id","attachment","type","url","template_type","buttons","title","subtitle","item_url","image_url","receiptId","Math","floor","random","recipient_name","order_number","currency","payment_method","quantity","price","address","street_1","street_2","city","postal_code","state","country","summary","subtotal","shipping_cost","total_tax","total_cost","adjustments","name","amount","quick_replies","sender_action","query","send","sendStatus","post","data","object","entry","pageEntry","pageID","timeOfEvent","time","messaging","messagingEvent","accountLinkingToken","redirectURI","redirectURISuccess","render","listen","module","exports"],"mappings":"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","file":"server-compiled.js","sourcesContent":["'use strict';var _express=require('express');var _express2=_interopRequireDefault(_express);var _bodyParser=require('body-parser');var _bodyParser2=_interopRequireDefault(_bodyParser);var _config=require('config');var _config2=_interopRequireDefault(_config);var _crypto=require('crypto');var _crypto2=_interopRequireDefault(_crypto);var _request=require('request');var _request2=_interopRequireDefault(_request);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}// App Secret can be retrieved from the App Dashboard\nvar APP_SECRET=process.env.MESSENGER_APP_SECRET?process.env.MESSENGER_APP_SECRET:_config2.default.get('APP_SECRET');// Arbitrary value used to validate a webhook\nvar VALIDATION_TOKEN=process.env.MESSENGER_VALIDATION_TOKEN?process.env.MESSENGER_VALIDATION_TOKEN:_config2.default.get('VALIDATION_TOKEN');// Generate a page access token for your page from the App Dashboard\nvar PAGE_ACCESS_TOKEN=process.env.MESSENGER_PAGE_ACCESS_TOKEN?process.env.MESSENGER_PAGE_ACCESS_TOKEN:_config2.default.get('PAGE_ACCESS_TOKEN');// URL where the app is running (include protocol). Used to point to scripts and\n// assets located at this address.\nvar SERVER_URL=process.env.SERVER_URL?process.env.SERVER_URL:_config2.default.get('SERVER_URL');var PARSE_APP_ID=process.env.PARSE_APP_ID?process.env.PARSE_APP_ID:_config2.default.get('PARSE_APP_ID');var PARSE_SERVER_URL=process.env.PARSE_SERVER_URL?process.env.PARSE_SERVER_URL:_config2.default.get('PARSE_SERVER_URL');var FACEBOOK_APP_ID=process.env.FACEBOOK_APP_ID?process.env.FACEBOOK_APP_ID:_config2.default.get('FACEBOOK_APP_ID');var REDIRECT_URI=process.env.REDIRECT_URI?process.env.REDIRECT_URI:_config2.default.get('REDIRECT_URI');if(!(APP_SECRET&&VALIDATION_TOKEN&&PAGE_ACCESS_TOKEN&&SERVER_URL)){console.error(\"Missing config values\");process.exit(1);}var app=(0,_express2.default)();app.set('port',process.env.PORT||8000);app.set('view engine','ejs');app.use(_bodyParser2.default.json({verify:verifyRequestSignature}));app.use(_express2.default.static('public'));var rules=new Map();/*\n * Verify that the callback came from Facebook. Using the App Secret from\n * the App Dashboard, we can verify the signature that is sent with each\n * callback in the x-hub-signature field, located in the header.\n *\n * https://developers.facebook.com/docs/graph-api/webhooks#setup\n *\n */function verifyRequestSignature(req,res,buf){var signature=req.headers[\"x-hub-signature\"];if(!signature){// For testing, let's log an error. In production, you should throw an\n// error.\nconsole.error(\"Couldn't validate the signature.\");}else{var elements=signature.split('=');var method=elements[0];var signatureHash=elements[1];var expectedHash=_crypto2.default.createHmac('sha1',APP_SECRET).update(buf).digest('hex');if(signatureHash!=expectedHash){throw new Error(\"Couldn't validate the request signature.\");}}}/*\n * Authorization Event\n *\n * The value for 'optin.ref' is defined in the entry point. For the \"Send to\n * Messenger\" plugin, it is the 'data-ref' field. Read more at\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/authentication\n *\n */function receivedAuthentication(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfAuth=event.timestamp;// The 'ref' field is set in the 'Send to Messenger' plugin, in the 'data-ref'\n// The developer can set this to an arbitrary value to associate the\n// authentication callback with the 'Send to Messenger' click event. This is\n// a way to do account linking when the user clicks the 'Send to Messenger'\n// plugin.\nvar passThroughParam=event.optin.ref;console.log(\"Received authentication for user %d and page %d with pass \"+\"through param '%s' at %d\",senderID,recipientID,passThroughParam,timeOfAuth);// When an authentication is received, we'll send a message back to the sender\n// to let them know it was successful.\nsendTextMessage(senderID,\"Authentication successful\");}/*\n * Message Event\n *\n * This event is called when a message is sent to your page. The 'message'\n * object format can vary depending on the kind of message that was received.\n * Read more at https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-received\n *\n * For this example, we're going to echo any text that we get. If we get some\n * special keywords ('button', 'generic', 'receipt'), then we'll send back\n * examples of those bubbles to illustrate the special message bubbles we've\n * created. If we receive a message with an attachment (image, video, audio),\n * then we'll simply confirm that we've received the attachment.\n *\n */function receivedMessage(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfMessage=event.timestamp;var message=event.message;console.log(\"Received message for user %d and page %d at %d with message:\",senderID,recipientID,timeOfMessage);console.log(JSON.stringify(message));var isEcho=message.is_echo;var messageId=message.mid;var appId=message.app_id;var metadata=message.metadata;// You may get a text or attachment but not both\nvar messageText=message.text;var messageAttachments=message.attachments;var quickReply=message.quick_reply;if(isEcho){// Just logging message echoes to console\nconsole.log(\"Received echo for message %s and app %d with metadata %s\",messageId,appId,metadata);return;}else if(quickReply){var quickReplyPayload=quickReply.payload;console.log(\"Quick reply for message %s with payload %s\",messageId,quickReplyPayload);sendTextMessage(senderID,\"Quick reply tapped\");return;}if(messageText){// If we receive a text message, check to see if it matches any special\n// keywords and send back the corresponding example. Otherwise, just echo\n// the text we received.\nswitch(messageText){case'image':sendImageMessage(senderID);break;case'gif':sendGifMessage(senderID);break;case'audio':sendAudioMessage(senderID);break;case'video':sendVideoMessage(senderID);break;case'file':sendFileMessage(senderID);break;case'button':sendButtonMessage(senderID);break;case'generic':sendGenericMessage(senderID);break;case'receipt':sendReceiptMessage(senderID);break;case'quick reply':sendQuickReply(senderID);break;case'read receipt':sendReadReceipt(senderID);break;case'typing on':sendTypingOn(senderID);break;case'typing off':sendTypingOff(senderID);break;case'account linking':sendAccountLinking(senderID);break;//default:\n//sendTextMessage(senderID, messageText);\n}messageText=messageText.toLowerCase();if(rules.get(messageText)){rules.get(messageText)(senderID);}/*\n                if (messageText.indexOf(\"hola\") > -1){\n                    sendMenuMessage(senderID);\n                }\n                else if (messageText.indexOf(\"buenos dias\") > -1){\n                    sendMenuMessage(senderID);\n                }\n                else if (messageText.indexOf(\"menu del dia\") > -1){\n                    sendMenuMessage(senderID);\n                }\n                else if (messageText.indexOf(\"cuenta\") > -1){\n                    sendBillMessage(senderID);\n                }\n        */}else if(messageAttachments){sendTextMessage(senderID,\"Message with attachment received\");}}/*\n * Delivery Confirmation Event\n *\n * This event is sent to confirm the delivery of a message. Read more about\n * these fields at https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-delivered\n *\n */function receivedDeliveryConfirmation(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var delivery=event.delivery;var messageIDs=delivery.mids;var watermark=delivery.watermark;var sequenceNumber=delivery.seq;if(messageIDs){messageIDs.forEach(function(messageID){console.log(\"Received delivery confirmation for message ID: %s\",messageID);});}console.log(\"All message before %d were delivered.\",watermark);}/*\n * Postback Event\n *\n * This event is called when a postback is tapped on a Structured Message.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/postback-received\n *\n */function receivedPostback(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfPostback=event.timestamp;// The 'payload' param is a developer-defined field which is set in a postback\n// button for Structured Messages.\nvar payload=event.postback.payload;console.log(\"Received postback for user %d and page %d with payload '%s' \"+\"at %d\",senderID,recipientID,payload,timeOfPostback);// When a postback is called, we'll send a message back to the sender to\n// let them know it was successful\nif(payload=='Greeting'){sendMenuMessage(senderID);}else if(payload.startsWith(\"ListCategories\")){var params=payload.split(\"-\");console.log(\"List Categories\");console.log(params);listCategories(senderID,parseInt(params[1]));}else if(payload.startsWith(\"ListProducts\")){var params=payload.split(\"-\");listProducts(senderID,params[1],parseInt(params[2]));}else if(payload.startsWith(\"Add\")){var params=payload.split(\"-\");addProduct(params[1]);}else if(payload.startsWith(\"ShoppingCart\")){sendBillMessage(senderID);}else{sendTextMessage(senderID,\"Postback called \"+payload);}}/*\n * Message Read Event\n *\n * This event is called when a previously-sent message has been read.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-read\n *\n */function receivedMessageRead(event){var senderID=event.sender.id;var recipientID=event.recipient.id;// All messages before watermark (a timestamp) or sequence have been seen.\nvar watermark=event.read.watermark;var sequenceNumber=event.read.seq;console.log(\"Received message read event for watermark %d and sequence \"+\"number %d\",watermark,sequenceNumber);}/*\n * Account Link Event\n *\n * This event is called when the Link Account or UnLink Account action has been\n * tapped.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/account-linking\n *\n */function receivedAccountLink(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var status=event.account_linking.status;var authCode=event.account_linking.authorization_code;console.log(\"Received account link event with for user %d with status %s \"+\"and auth code %s \",senderID,status,authCode);}/*\n * Call the Send API. The message data goes in the body. If successful, we'll\n * get the message id in a response\n *\n */function callSendAPI(messageData){(0,_request2.default)({uri:'https://graph.facebook.com/v2.6/me/messages',qs:{access_token:PAGE_ACCESS_TOKEN},method:'POST',json:messageData},function(error,response,body){if(!error&&response.statusCode==200){var recipientId=body.recipient_id;var messageId=body.message_id;if(messageId){console.log(\"Successfully sent message with id %s to recipient %s\",messageId,recipientId);}else{console.log(\"Successfully called Send API for recipient %s\",recipientId);}}else{console.error(response.error);}});}/*\n * Send an image using the Send API.\n *\n */function sendImageMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"image\",payload:{url:SERVER_URL+\"/assets/rift.png\"}}}};callSendAPI(messageData);}/*\n * Send a Gif using the Send API.\n *\n */function sendGifMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"image\",payload:{url:SERVER_URL+\"/assets/instagram_logo.gif\"}}}};callSendAPI(messageData);}/*\n * Send audio using the Send API.\n *\n */function sendAudioMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"audio\",payload:{url:SERVER_URL+\"/assets/sample.mp3\"}}}};callSendAPI(messageData);}/*\n * Send a video using the Send API.\n *\n */function sendVideoMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"video\",payload:{url:SERVER_URL+\"/assets/allofus480.mov\"}}}};callSendAPI(messageData);}/*\n * Send a video using the Send API.\n *\n */function sendFileMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"file\",payload:{url:SERVER_URL+\"/assets/test.txt\"}}}};callSendAPI(messageData);}/*\n * Send a text message using the Send API.\n *\n */function sendTextMessage(recipientId,messageText){var messageData={recipient:{id:recipientId},message:{text:messageText,metadata:\"DEVELOPER_DEFINED_METADATA\"}};callSendAPI(messageData);}/*\n * Send a button message using the Send API.\n *\n */function sendButtonMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"button\",text:\"This is test text\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/rift/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Trigger Postback\",payload:\"DEVELOPED_DEFINED_PAYLOAD\"},{type:\"phone_number\",title:\"Call Phone Number\",payload:\"+16505551234\"}]}}}};callSendAPI(messageData);}/*\n * Send a Structured Message (Generic Message type) using the Send API.\n *\n */function sendGenericMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"generic\",elements:[{title:\"rift\",subtitle:\"Next-generation virtual reality\",item_url:\"https://www.oculus.com/en-us/rift/\",image_url:SERVER_URL+\"/assets/rift.png\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/rift/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Call Postback\",payload:\"Payload for first bubble\"}]},{title:\"touch\",subtitle:\"Your Hands, Now in VR\",item_url:\"https://www.oculus.com/en-us/touch/\",image_url:SERVER_URL+\"/assets/touch.png\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/touch/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Call Postback\",payload:\"Payload for second bubble\"}]}]}}}};callSendAPI(messageData);}/*\n * Send a receipt message using the Send API.\n *\n */function sendReceiptMessage(recipientId){// Generate a random receipt ID as the API requires a unique ID\nvar receiptId=\"order\"+Math.floor(Math.random()*1000);var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"receipt\",recipient_name:\"Peter Chang\",order_number:receiptId,currency:\"COP\",payment_method:\"Visa 1234\",timestamp:\"1428444852\",elements:[{title:\"Oculus Rift\",subtitle:\"Includes: headset, sensor, remote\",quantity:1,price:599.00,currency:\"USD\",image_url:SERVER_URL+\"/assets/riftsq.png\"},{title:\"Samsung Gear VR\",subtitle:\"Frost White\",quantity:1,price:99.99,currency:\"USD\",image_url:SERVER_URL+\"/assets/gearvrsq.png\"}],address:{street_1:\"1 Hacker Way\",street_2:\"\",city:\"Menlo Park\",postal_code:\"94025\",state:\"CA\",country:\"US\"},summary:{subtotal:698.99,shipping_cost:20.00,total_tax:57.67,total_cost:626.66},adjustments:[{name:\"New Customer Discount\",amount:-50},{name:\"$100 Off Coupon\",amount:-100}]}}}};callSendAPI(messageData);}/*\n * Send a message with Quick Reply buttons.\n *\n */function sendQuickReply(recipientId){var messageData={recipient:{id:recipientId},message:{text:\"What's your favorite movie genre?\",metadata:\"DEVELOPER_DEFINED_METADATA\",quick_replies:[{\"content_type\":\"text\",\"title\":\"Action\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_ACTION\"},{\"content_type\":\"text\",\"title\":\"Comedy\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_COMEDY\"},{\"content_type\":\"text\",\"title\":\"Drama\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_DRAMA\"}]}};callSendAPI(messageData);}/*\n * Send a read receipt to indicate the message has been read\n *\n */function sendReadReceipt(recipientId){console.log(\"Sending a read receipt to mark message as seen\");var messageData={recipient:{id:recipientId},sender_action:\"mark_seen\"};callSendAPI(messageData);}/*\n * Turn typing indicator on\n *\n */function sendTypingOn(recipientId){console.log(\"Turning typing indicator on\");var messageData={recipient:{id:recipientId},sender_action:\"typing_on\"};callSendAPI(messageData);}/*\n * Turn typing indicator off\n *\n */function sendTypingOff(recipientId){console.log(\"Turning typing indicator off\");var messageData={recipient:{id:recipientId},sender_action:\"typing_off\"};callSendAPI(messageData);}/*\n * Send a message with the account linking call-to-action\n *\n */function sendAccountLinking(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"button\",text:\"Welcome. Link your account.\",buttons:[{type:\"account_link\",url:SERVER_URL+\"/authorize\"}]}}}};callSendAPI(messageData);}/*\n * Use your own validation token. Check that the token used in the Webhook\n * setup is the same token used here.\n *\n */app.get('/webhook',function(req,res){if(req.query['hub.mode']==='subscribe'&&req.query['hub.verify_token']===VALIDATION_TOKEN){console.log(\"Validating webhook\");res.status(200).send(req.query['hub.challenge']);}else{console.error(\"Failed validation. Make sure the validation tokens match.\");res.sendStatus(403);}});/*\n * All callbacks for Messenger are POST-ed. They will be sent to the same\n * webhook. Be sure to subscribe your app to your page to receive callbacks\n * for your page.\n * https://developers.facebook.com/docs/messenger-platform/product-overview/setup#subscribe_app\n *\n */app.post('/webhook',function(req,res){var data=req.body;// Make sure this is a page subscription\nif(data.object=='page'){// Iterate over each entry\n// There may be multiple if batched\ndata.entry.forEach(function(pageEntry){var pageID=pageEntry.id;var timeOfEvent=pageEntry.time;// Iterate over each messaging event\npageEntry.messaging.forEach(function(messagingEvent){console.log(messagingEvent);if(messagingEvent.optin){receivedAuthentication(messagingEvent);}else if(messagingEvent.message){receivedMessage(messagingEvent);}else if(messagingEvent.delivery){receivedDeliveryConfirmation(messagingEvent);}else if(messagingEvent.postback){receivedPostback(messagingEvent);}else if(messagingEvent.read){receivedMessageRead(messagingEvent);}else if(messagingEvent.account_linking){receivedAccountLink(messagingEvent);}else{console.log(\"Webhook received unknown messagingEvent: \",messagingEvent);}});});// Assume all went well.\n//\n// You must send back a 200, within 20 seconds, to let us know you've\n// successfully received the callback. Otherwise, the request will time out.\nres.sendStatus(200);}});/*\n * This path is used for account linking. The account linking call-to-action\n * (sendAccountLinking) is pointed to this URL.\n *\n */app.get('/authorize',function(req,res){var accountLinkingToken=req.query['account_linking_token'];var redirectURI=req.query['redirect_uri'];// Authorization Code should be generated per user by the developer. This will\n// be passed to the Account Linking callback.\nvar authCode=\"1234567890\";// Redirect users to this URI on successful login\nvar redirectURISuccess=redirectURI+\"&authorization_code=\"+authCode;res.render('authorize',{accountLinkingToken:accountLinkingToken,redirectURI:redirectURI,redirectURISuccess:redirectURISuccess});});// Start server\n// Webhooks must be available via SSL with a certificate signed by a valid\n// certificate authority.\napp.listen(app.get('port'),function(){console.log('Node app is running on port',app.get('port'));});module.exports={app:app,rules:rules,callSendAPI:callSendAPI,sendTypingOn:sendTypingOn,sendTypingOff:sendTypingOff};//# sourceMappingURL=server-compiled.js.map"]}