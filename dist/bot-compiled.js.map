{"version":3,"sources":["bot.js"],"names":[],"mappings":"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","file":"bot-compiled.js","sourcesContent":["'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i[\"return\"])_i[\"return\"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");}};}();var _server=require('./server');var _bodyParser=require('body-parser');var _bodyParser2=_interopRequireDefault(_bodyParser);var _config=require('config');var _config2=_interopRequireDefault(_config);var _crypto=require('crypto');var _crypto2=_interopRequireDefault(_crypto);var _request=require('request');var _request2=_interopRequireDefault(_request);var _underscore=require('underscore');var _=_interopRequireWildcard(_underscore);var _requestPromise=require('request-promise');var _requestPromise2=_interopRequireDefault(_requestPromise);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}//import parseExpressHttpsRedirect from 'parse-express-https-redirect'\n//import parseExpressCookieSession from './src/parse-express-cookie-session/index'\n// App Secret can be retrieved from the App Dashboard\nvar APP_SECRET=process.env.MESSENGER_APP_SECRET?process.env.MESSENGER_APP_SECRET:_config2.default.get('APP_SECRET');// Arbitrary value used to validate a webhook\nvar VALIDATION_TOKEN=process.env.MESSENGER_VALIDATION_TOKEN?process.env.MESSENGER_VALIDATION_TOKEN:_config2.default.get('VALIDATION_TOKEN');// Generate a page access token for your page from the App Dashboard\nvar PAGE_ACCESS_TOKEN=process.env.MESSENGER_PAGE_ACCESS_TOKEN?process.env.MESSENGER_PAGE_ACCESS_TOKEN:_config2.default.get('PAGE_ACCESS_TOKEN');// URL where the app is running (include protocol). Used to point to scripts and\n// assets located at this address.\nvar SERVER_URL=process.env.SERVER_URL?process.env.SERVER_URL:_config2.default.get('SERVER_URL');var FACEBOOK_APP_ID=process.env.FACEBOOK_APP_ID?process.env.FACEBOOK_APP_ID:_config2.default.get('FACEBOOK_APP_ID');var FACEBOOK_GRAPH=process.env.FACEBOOK_GRAPH?process.env.FACEBOOK_GRAPH:_config2.default.get('FACEBOOK_GRAPH');var REDIRECT_URI=process.env.REDIRECT_URI?process.env.REDIRECT_URI:_config2.default.get('REDIRECT_URI');var limit=9;if(!(APP_SECRET&&VALIDATION_TOKEN&&PAGE_ACCESS_TOKEN&&SERVER_URL)){console.error(\"Missing config values\");process.exit(1);}_server.app.use(_bodyParser2.default.json({verify:verifyRequestSignature}));//app.use(parseExpressHttpsRedirect());\n//app.use(parseExpressCookieSession({ fetchUser: true }));\nvar listener={};var buffer={};var rules=new Map();var payloadRules=new Map();/*\n * Verify that the callback came from Facebook. Using the App Secret from\n * the App Dashboard, we can verify the signature that is sent with each\n * callback in the x-hub-signature field, located in the header.\n *\n * https://developers.facebook.com/docs/graph-api/webhooks#setup\n *\n */function verifyRequestSignature(req,res,buf){var signature=req.headers[\"x-hub-signature\"];if(!signature){// For testing, let's log an error. In production, you should throw an\n// error.\nconsole.error(\"Couldn't validate the signature.\");}else{var elements=signature.split('=');var method=elements[0];var signatureHash=elements[1];//console.log(signature);\nvar expectedHash=_crypto2.default.createHmac('sha1',APP_SECRET).update(buf).digest('hex');if(signatureHash!=expectedHash){throw new Error(\"Couldn't validate the request signature.\");}}}/*\n * Authorization Event\n *\n * The value for 'optin.ref' is defined in the entry point. For the \"Send to\n * Messenger\" plugin, it is the 'data-ref' field. Read more at\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/authentication\n *\n */function receivedAuthentication(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfAuth=event.timestamp;// The 'ref' field is set in the 'Send to Messenger' plugin, in the 'data-ref'\n// The developer can set this to an arbitrary value to associate the\n// authentication callback with the 'Send to Messenger' click event. This is\n// a way to do account linking when the user clicks the 'Send to Messenger'\n// plugin.\nsenderID=parseInt(senderID);var passThroughParam=event.optin.ref;console.log(\"Received authentication for user %d and page %d with pass \"+\"through param '%s' at %d\",senderID,recipientID,passThroughParam,timeOfAuth);// When an authentication is received, we'll send a message back to the sender\n// to let them know it was successful.\nsendTextMessage(senderID,\"Authentication successful\");}/*\n * Message Event\n *\n * This event is called when a message is sent to your page. The 'message'\n * object format can lety depending on the kind of message that was received.\n * Read more at https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-received\n *\n * For this example, we're going to echo any text that we get. If we get some\n * special keywords ('button', 'generic', 'receipt'), then we'll send back\n * examples of those bubbles to illustrate the special message bubbles we've\n * created. If we receive a message with an attachment (image, video, audio),\n * then we'll simply confirm that we've received the attachment.\n *\n */function receivedMessage(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfMessage=event.timestamp;var message=event.message;//console.log(\"Received message for user %d and page %d at %d with message:\", senderID, recipientID, timeOfMessage);\n//console.log(JSON.stringify(message));\nvar isEcho=message.is_echo;var messageId=message.mid;var appId=message.app_id;var metadata=message.metadata;// You may get a text or attachment but not both\nvar messageText=message.text;var messageAttachments=message.attachments;var quickReply=message.quick_reply;senderID=parseInt(senderID);if(isEcho){// Just logging message echoes to console\nconsole.log(\"Received echo for message %s and app %d with metadata %s\",messageId,appId,metadata);return;}else if(quickReply){var quickReplyPayload=quickReply.payload;//console.log(\"Quick reply for message %s with payload %s\", messageId, quickReplyPayload);\nvar payloadFunction=void 0;if(quickReplyPayload.includes('-')){var params=quickReplyPayload.split('-');payloadFunction=payloadRules.get(params[0]);//console.log(senderID);\n//console.log(typeof senderID);\nif(payloadFunction){payloadFunction(senderID,params[1]);}}else{payloadFunction=payloadRules.get(quickReplyPayload);if(payloadFunction){payloadFunction(senderID);}/*\n             payloadFunction = findKeyStartsWith(payloadRules, quickReplyPayload);\n             if(payloadFunction){\n             payloadFunction(senderID);\n             }*/}//sendTextMessage(senderID, \"Quick reply tapped\");\nreturn;}else if(messageText){// If we receive a text message, check to see if it matches any special\n// keywords and send back the corresponding example. Otherwise, just echo\n// the text we received.\n//Object.keys(listener);\nvar userListeners=listener[senderID];var existRule=false;//console.log(senderID);\n//console.log(typeof senderID);\nif(!_.isEmpty(userListeners)){if(!buffer[senderID]){buffer[senderID]={};}var keys=Object.keys(userListeners);var key=keys.shift();//console.log('User Listeners');\nwhile(key){//console.log(key);\nif(userListeners[key].type=='text'){buffer[senderID][key]=messageText;userListeners[key].callback(senderID);existRule=true;}delete userListeners[key];key=keys.shift();}}else{messageText=messageText.toLowerCase();rules.forEach(function(value,key){if(messageText.includes(key)){value(senderID);existRule=true;}});}if(!existRule){//console.log(messageText);\n//console.log(defaultSearch);\ndefaultSearch(senderID,messageText);}/*\n\n\n         switch (messageText) {\n         case 'image':\n         sendImageMessage(senderID);\n         break;\n\n         case 'gif':\n         sendGifMessage(senderID);\n         break;\n\n         case 'audio':\n         sendAudioMessage(senderID);\n         break;\n\n         case 'video':\n         sendVideoMessage(senderID);\n         break;\n\n         case 'file':\n         sendFileMessage(senderID);\n         break;\n\n         case 'button':\n         sendButtonMessage(senderID);\n         break;\n\n         case 'generic':\n         sendGenericMessage(senderID);\n         break;\n\n         case 'receipt':\n         sendReceiptMessage(senderID);\n         break;\n\n         case 'quick reply':\n         sendQuickReply(senderID);\n         break;\n\n         case 'read receipt':\n         sendReadReceipt(senderID);\n         break;\n\n         case 'typing on':\n         sendTypingOn(senderID);\n         break;\n\n         case 'typing off':\n         sendTypingOff(senderID);\n         break;\n\n         case 'account linking':\n         sendAccountLinking(senderID);\n         break;\n\n         default:\n         sendTextMessage(senderID, messageText);\n         }\n         /*\n         if (messageText.indexOf(\"hola\") > -1){\n         sendMenuMessage(senderID);\n         }\n         else if (messageText.indexOf(\"buenos dias\") > -1){\n         sendMenuMessage(senderID);\n         }\n         else if (messageText.indexOf(\"menu del dia\") > -1){\n         sendMenuMessage(senderID);\n         }\n         else if (messageText.indexOf(\"cuenta\") > -1){\n         sendBillMessage(senderID);\n         }\n         */}else if(messageAttachments){if(messageAttachments[0].type=='location'){var location=messageAttachments[0].payload.coordinates;var _userListeners=listener[senderID];//console.log(senderID);\n//console.log(typeof senderID);\nif(!_.isEmpty(_userListeners)){if(!buffer[senderID]){buffer[senderID]={};}var _keys=Object.keys(_userListeners);var _key=_keys.shift();while(_key){console.log(_key);if(_userListeners[_key].type=='attachment'){buffer[senderID][_key]={lat:location.lat,lng:location.long};_userListeners[_key].callback(senderID);}delete _userListeners[_key];_key=_keys.shift();}}}//sendTextMessage(senderID, \"Message with attachment received\");\n}}/*\n * Delivery Confirmation Event\n *\n * This event is sent to confirm the delivery of a message. Read more about\n * these fields at https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-delivered\n *\n */function receivedDeliveryConfirmation(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var delivery=event.delivery;var messageIDs=delivery.mids;var watermark=delivery.watermark;var sequenceNumber=delivery.seq;senderID=parseInt(senderID);if(messageIDs){messageIDs.forEach(function(messageID){//console.log(\"Received delivery confirmation for message ID: %s\", messageID);\n});}//console.log(\"All message before %d were delivered.\", watermark);\n}/*\n * Postback Event\n *\n * This event is called when a postback is tapped on a Structured Message.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/postback-received\n *\n */function receivedPostback(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var timeOfPostback=event.timestamp;// The 'payload' param is a developer-defined field which is set in a postback\n// button for Structured Messages.\nvar payload=event.postback.payload;//console.log(\"Received postback for user %d and page %d with payload '%s' \" + \"at %d\", senderID, recipientID, payload, timeOfPostback);\n// When a postback is called, we'll send a message back to the sender to\n// let them know it was successful\nvar payloadFunction=void 0;var params=payload.split('-');payloadFunction=payloadRules.get(params[0]);senderID=parseInt(senderID);//console.log(senderID);\n//console.log(typeof senderID);\nif(payloadFunction){switch(params.length){case 1:payloadFunction(senderID);break;case 2:payloadFunction(senderID,params[1]);break;case 3:payloadFunction(senderID,params[1],params[2]);break;default:console.log('Payload not found: '+params);}}/*\n    if(payload == 'Greeting'){\n        sendMenuMessage(senderID);\n    }\n    else if(payload == 'Delivery'){\n        sendMenuMessage(senderID);\n    }\n    else if(payload.startsWith(\"ListCategories\")){\n        let params = payload.split(\"-\");\n        console.log(\"List Categories\");\n        console.log(params);\n        listCategories(senderID, parseInt(params[1]));\n    }\n    else if(payload.startsWith(\"ListProducts\")){\n        let params = payload.split(\"-\");\n        listProducts(senderID, params[1], parseInt(params[2]));\n    }\n    else if(payload.startsWith(\"Add\")){\n        let params = payload.split(\"-\");\n        addProduct(params[1]);\n    }\n    else if(payload.startsWith(\"ShoppingCart\")){\n        sendBillMessage(senderID);\n    }\n    else{\n        sendTextMessage(senderID, \"Postback called \"+payload);\n    }\n    */}/*\n * Message Read Event\n *\n * This event is called when a previously-sent message has been read.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-read\n *\n */function receivedMessageRead(event){var senderID=event.sender.id;var recipientID=event.recipient.id;// All messages before watermark (a timestamp) or sequence have been seen.\nvar watermark=event.read.watermark;var sequenceNumber=event.read.seq;senderID=parseInt(senderID);console.log(\"Received message read event for watermark %d and sequence \"+\"number %d\",watermark,sequenceNumber);}/*\n * Account Link Event\n *\n * This event is called when the Link Account or UnLink Account action has been\n * tapped.\n * https://developers.facebook.com/docs/messenger-platform/webhook-reference/account-linking\n *\n */function receivedAccountLink(event){var senderID=event.sender.id;var recipientID=event.recipient.id;var status=event.account_linking.status;var authCode=event.account_linking.authorization_code;senderID=parseInt(senderID);console.log(\"Received account link event with for user %d with status %s \"+\"and auth code %s \",senderID,status,authCode);}/*\n * Call the Send API. The message data goes in the body. If successful, we'll\n * get the message id in a response\n *\n */function callSendAPI(messageData,callback){(0,_request2.default)({uri:FACEBOOK_GRAPH+'me/messages',qs:{access_token:PAGE_ACCESS_TOKEN},method:'POST',json:messageData},function(error,response,body){if(!error&&response.statusCode==200){var recipientId=body.recipient_id;var messageId=body.message_id;if(messageId){if(callback)callback(recipientId);//console.log(\"Successfully sent message with id %s to recipient %s\", messageId, recipientId);\n}else{//console.log(\"Successfully called Send API for recipient %s\", recipientId);\n}}else{console.error(response);console.error(body);console.error(error);}});}function testAPI(){(0,_request2.default)({uri:FACEBOOK_GRAPH+'me?fields=name,email,age_range,birthday,is_verified,location',qs:{access_token:PAGE_ACCESS_TOKEN},method:'GET'},function(error,response,body){if(!error&&response.statusCode==200){console.log('Successful login for: '+response.name);console.log('Thanks for logging in, '+response.email+'!');console.log(response);}else{console.error('Error');console.error(body);console.error(error);}});}/*\n * Turn typing indicator on\n *\n */function sendTypingOn(recipientId){//console.log(\"Turning typing indicator on\");\nvar messageData={recipient:{id:recipientId},sender_action:\"typing_on\"};callSendAPI(messageData);}/*\n * Turn typing indicator off\n *\n */function sendTypingOff(recipientId){//console.log(\"Turning typing indicator off\");\nvar messageData={recipient:{id:recipientId},sender_action:\"typing_off\"};callSendAPI(messageData);}/*\n * Send a text message using the Send API.\n *\n */function sendTextMessage(recipientId,messageText){var messageData={recipient:{id:recipientId},message:{text:messageText,metadata:\"DEVELOPER_DEFINED_METADATA\"}};callSendAPI(messageData);}/*\n * Send an image using the Send API.\n *\n */function sendImageMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"image\",payload:{url:SERVER_URL+\"/assets/rift.png\"}}}};callSendAPI(messageData);}/*\n * Send a Gif using the Send API.\n *\n */function sendGifMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"image\",payload:{url:SERVER_URL+\"/assets/instagram_logo.gif\"}}}};callSendAPI(messageData);}/*\n * Send audio using the Send API.\n *\n */function sendAudioMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"audio\",payload:{url:SERVER_URL+\"/assets/sample.mp3\"}}}};callSendAPI(messageData);}/*\n * Send a video using the Send API.\n *\n */function sendVideoMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"video\",payload:{url:SERVER_URL+\"/assets/allofus480.mov\"}}}};callSendAPI(messageData);}/*\n * Send a video using the Send API.\n *\n */function sendFileMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"file\",payload:{url:SERVER_URL+\"/assets/test.txt\"}}}};callSendAPI(messageData);}/*\n * Send a button message using the Send API.\n *\n */function sendButtonMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"button\",text:\"This is test text\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/rift/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Trigger Postback\",payload:\"DEVELOPED_DEFINED_PAYLOAD\"},{type:\"phone_number\",title:\"Call Phone Number\",payload:\"+16505551234\"}]}}}};callSendAPI(messageData);}/*\n * Send a Structured Message (Generic Message type) using the Send API.\n *\n */function sendGenericMessage(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"generic\",elements:[{title:\"rift\",subtitle:\"Next-generation virtual reality\",item_url:\"https://www.oculus.com/en-us/rift/\",image_url:SERVER_URL+\"/assets/rift.png\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/rift/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Call Postback\",payload:\"Payload for first bubble\"}]},{title:\"touch\",subtitle:\"Your Hands, Now in VR\",item_url:\"https://www.oculus.com/en-us/touch/\",image_url:SERVER_URL+\"/assets/touch.png\",buttons:[{type:\"web_url\",url:\"https://www.oculus.com/en-us/touch/\",title:\"Open Web URL\"},{type:\"postback\",title:\"Call Postback\",payload:\"Payload for second bubble\"}]}]}}}};callSendAPI(messageData);}/*\n * Send a receipt message using the Send API.\n *\n */function sendReceiptMessage(recipientId){// Generate a random receipt ID as the API requires a unique ID\nvar receiptId=\"order\"+Math.floor(Math.random()*1000);var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"receipt\",recipient_name:\"Peter Chang\",order_number:receiptId,currency:\"COP\",payment_method:\"Visa 1234\",timestamp:\"1428444852\",elements:[{title:\"Oculus Rift\",subtitle:\"Includes: headset, sensor, remote\",quantity:1,price:599.00,currency:\"USD\",image_url:SERVER_URL+\"/assets/riftsq.png\"},{title:\"Samsung Gear VR\",subtitle:\"Frost White\",quantity:1,price:99.99,currency:\"USD\",image_url:SERVER_URL+\"/assets/gearvrsq.png\"}],address:{street_1:\"1 Hacker Way\",street_2:\"\",city:\"Menlo Park\",postal_code:\"94025\",state:\"CA\",country:\"US\"},summary:{subtotal:698.99,shipping_cost:20.00,total_tax:57.67,total_cost:626.66},adjustments:[{name:\"New Customer Discount\",amount:-50},{name:\"$100 Off Coupon\",amount:-100}]}}}};callSendAPI(messageData);}/*\n * Send a message with Quick Reply buttons.\n *\n */function sendQuickReply(recipientId){var messageData={recipient:{id:recipientId},message:{text:\"What's your favorite movie genre?\",metadata:\"DEVELOPER_DEFINED_METADATA\",quick_replies:[{\"content_type\":\"text\",\"title\":\"Action\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_ACTION\"},{\"content_type\":\"text\",\"title\":\"Comedy\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_COMEDY\"},{\"content_type\":\"text\",\"title\":\"Drama\",\"payload\":\"DEVELOPER_DEFINED_PAYLOAD_FOR_PICKING_DRAMA\"}]}};callSendAPI(messageData);}/*\n * Send a read receipt to indicate the message has been read\n *\n */function sendReadReceipt(recipientId){console.log(\"Sending a read receipt to mark message as seen\");var messageData={recipient:{id:recipientId},sender_action:\"mark_seen\"};callSendAPI(messageData);}/*\n * Send a message with the account linking call-to-action\n *\n */function sendAccountLinking(recipientId){var messageData={recipient:{id:recipientId},message:{attachment:{type:\"template\",payload:{template_type:\"button\",text:\"Welcome. Link your account.\",buttons:[{type:\"account_link\",url:SERVER_URL+\"/authorize\"}]}}}};callSendAPI(messageData);}function findKeyStartsWith(map,str){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=map[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _step$value=_slicedToArray(_step.value,2);var key=_step$value[0];var value=_step$value[1];if(key.startsWith(str))return value;}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}return undefined;}function getFacebookUser(facebookId,conversationToken){return(0,_requestPromise2.default)({uri:FACEBOOK_GRAPH+facebookId,qs:{access_token:conversationToken,fields:'first_name,last_name,email,locale,timezone,gender'},method:'GET'}).then(function(body){return JSON.parse(body);}).catch(function(error){console.log('error');console.log(error);});}function setListener(recipientId,dataId,type,callback){if(typeof listener[recipientId]=='undefined'){listener[recipientId]={};}listener[recipientId][dataId]={callback:callback,type:type};}function getListener(recipientId,dataId){if(typeof listener[recipientId]=='undefined'){return undefined;}return listener[recipientId][dataId];}function deleteListener(recipientId,dataId){if(!listener[recipientId]){return false;}delete listener[recipientId][dataId];return true;}function setDataBuffer(recipientId,key,value){if(!buffer[recipientId]){buffer[recipientId]={};}buffer[recipientId][key]=value;}function defaultSearch(recipientId,query){//console.log('defaultSearch');\n//console.log(search);\nvar search=payloadRules.get('Search');if(search){search(recipientId,query);}};/*\n * Use your own validation token. Check that the token used in the Webhook\n * setup is the same token used here.\n *\n */_server.app.get('/webhook',function(req,res){if(req.query['hub.mode']==='subscribe'&&req.query['hub.verify_token']===VALIDATION_TOKEN){console.log(\"Validating webhook\");res.status(200).send(req.query['hub.challenge']);}else{console.error(\"Failed validation. Make sure the validation tokens match.\");res.sendStatus(403);}});/*\n * All callbacks for Messenger are POST-ed. They will be sent to the same\n * webhook. Be sure to subscribe your app to your page to receive callbacks\n * for your page.\n * https://developers.facebook.com/docs/messenger-platform/product-overview/setup#subscribe_app\n *\n */_server.app.post('/webhook',function(req,res){var data=req.body;// Make sure this is a page subscription\nif(data.object=='page'){// Iterate over each entry\n// There may be multiple if batched\ndata.entry.forEach(function(pageEntry){var pageID=pageEntry.id;var timeOfEvent=pageEntry.time;// Iterate over each messaging event\npageEntry.messaging.forEach(function(messagingEvent){//console.log(messagingEvent);\nif(messagingEvent.optin){receivedAuthentication(messagingEvent);}else if(messagingEvent.message){receivedMessage(messagingEvent);}else if(messagingEvent.delivery){receivedDeliveryConfirmation(messagingEvent);}else if(messagingEvent.postback){receivedPostback(messagingEvent);}else if(messagingEvent.read){receivedMessageRead(messagingEvent);}else if(messagingEvent.account_linking){receivedAccountLink(messagingEvent);}else{console.log(\"Webhook received unknown messagingEvent: \",messagingEvent);}});});// Assume all went well.\n//\n// You must send back a 200, within 20 seconds, to let us know you've\n// successfully received the callback. Otherwise, the request will time out.\nres.sendStatus(200);}});/*\n * This path is used for account linking. The account linking call-to-action\n * (sendAccountLinking) is pointed to this URL.\n *\n */_server.app.get('/authorize',function(req,res){var accountLinkingToken=req.query['account_linking_token'];var redirectURI=req.query['redirect_uri'];// Authorization Code should be generated per user by the developer. This will\n// be passed to the Account Linking callback.\nvar authCode=\"1234567890\";// Redirect users to this URI on successful login\nvar redirectURISuccess=redirectURI+\"&authorization_code=\"+authCode;res.render('authorize',{accountLinkingToken:accountLinkingToken,redirectURI:redirectURI,redirectURISuccess:redirectURISuccess});});// Start server\n// Webhooks must be available via SSL with a certificate signed by a valid\n// certificate authority.\n_server.app.listen(_server.app.get('port'),function(){//console.log('Node app is running on port', app.get('port'));\n});module.exports={app:_server.app,Parse:_server.Parse,rules:rules,payloadRules:payloadRules,buffer:buffer,listener:listener,limit:limit,defaultSearch:defaultSearch,callSendAPI:callSendAPI,sendTypingOn:sendTypingOn,sendTypingOff:sendTypingOff,getFacebookUser:getFacebookUser,setListener:setListener,getListener:getListener,deleteListener:deleteListener,setDataBuffer:setDataBuffer,testAPI:testAPI};"]}