{"version":3,"sources":["app.js"],"names":[],"mappings":";;;;AAAA;;IAAY,C;;AACZ;;IAAY,G;;AACZ;;IAAY,K;;AACZ;;IAAY,O;;AACZ;;IAAY,W;;AACZ;;AACA;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAM,aAAc,QAAQ,GAAR,CAAY,oBAAb,GAAqC,QAAQ,GAAR,CAAY,oBAAjD,GAAwE,iBAAO,GAAP,CAAW,YAAX,CAA3F;;AAEA,IAAM,oBAAqB,QAAQ,GAAR,CAAY,2BAAb,GAA6C,QAAQ,GAAR,CAAY,2BAAzD,GAAwF,iBAAO,GAAP,CAAW,mBAAX,CAAlH;;AAEA,IAAM,eAAgB,QAAQ,GAAR,CAAY,YAAb,GAA8B,QAAQ,GAAR,CAAY,YAA1C,GAA0D,iBAAO,GAAP,CAAW,cAAX,CAA/E;;AAEA,IAAM,mBAAoB,QAAQ,GAAR,CAAY,gBAAb,GAAkC,QAAQ,GAAR,CAAY,gBAA9C,GAAkE,iBAAO,GAAP,CAAW,kBAAX,CAA3F;;AAEA,IAAM,mBAAoB,QAAQ,GAAR,CAAY,gBAAb,GAAkC,QAAQ,GAAR,CAAY,gBAA9C,GAAkE,iBAAO,GAAP,CAAW,kBAAX,CAA3F;;AAEA,IAAM,kBAAmB,QAAQ,GAAR,CAAY,eAAb,GAAiC,QAAQ,GAAR,CAAY,eAA7C,GAAgE,iBAAO,GAAP,CAAW,iBAAX,CAAxF;;AAEA,IAAM,eAAgB,QAAQ,GAAR,CAAY,YAAb,GAA8B,QAAQ,GAAR,CAAY,YAA1C,GAA0D,iBAAO,GAAP,CAAW,cAAX,CAA/E;;AAEA,IAAM,cAAe,QAAQ,GAAR,CAAY,WAAb,GAA6B,QAAQ,GAAR,CAAY,WAAzC,GAAwD,iBAAO,GAAP,CAAW,aAAX,CAA5E;;AAGA,aAAG,OAAH,CAAW;AACP,WAAgB,eADT;AAEP,eAAgB,UAFT;AAGP,iBAAgB;AAHT,CAAX;;AAMA,IAAI,KAAJ,CAAU,GAAV,CAAc,MAAd,EAAsB,QAAtB;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,SAAd,EAAyB,QAAzB;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,SAAd,EAAyB,QAAzB;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,UAAd,EAA0B,QAA1B;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,aAAd,EAA6B,QAA7B;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,eAAd,EAA+B,QAA/B;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,iBAAd,EAAiC,eAAjC;AACA,IAAI,KAAJ,CAAU,GAAV,CAAc,QAAd,EAAwB,gBAAxB;;AAEA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,UAArB,EAAiC,QAAjC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,iBAArB,EAAwC,eAAxC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,YAArB,EAAmC,UAAnC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,YAArB,EAAmC,UAAnC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,cAArB,EAAqC,YAArC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,aAArB,EAAoC,WAApC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,gBAArB,EAAuC,cAAvC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,gBAArB,EAAuC,cAAvC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,cAArB,EAAqC,YAArC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,YAArB,EAAmC,UAAnC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,kBAArB,EAAyC,gBAAzC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,qBAArB,EAA4C,mBAA5C;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,UAArB,EAAiC,QAAjC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,YAArB,EAAmC,eAAnC;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,oBAArB,EAA2C,kBAA3C;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,2BAArB,EAAkD,yBAAlD;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,0BAArB,EAAiD,wBAAjD;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,mBAArB,EAA0C,iBAA1C;AACA,IAAI,YAAJ,CAAiB,GAAjB,CAAqB,WAArB,EAAkC,SAAlC;;AAEA,IAAM,eAAe;AACjB,sBAAkB,EAAC,KAAK,CAAC,CAAP,EAAU,KAAK,CAAC,CAAhB,EADD;AAEjB,eAAW,EAFM;AAGjB,eAAW,EAHM;AAIjB,gBAAY,EAJK;AAKjB,sBAAkB,KALD;AAMjB,cAAU,EANO;AAOjB,kBAAc,EAPG;AAQjB,gBAAY,EARK;AASjB,oBAAgB,EATC;AAUjB,cAAU,EAVO;AAWjB,cAAU,EAXO;AAYjB,YAAQ,EAAE,SAAS,EAAX,EAAe,WAAW,EAA1B,EAZS;AAajB,iBAAa,IAbI;AAcjB,kBAAc;AACV,yBAAgB,EADN;AAEV,eAAO;AAFG,KAdG;AAkBjB,kBAAc,CAlBG;AAmBjB,mBAAe,KAnBE;AAoBjB,sBAAkB,KApBD;AAqBjB,uBAAmB,KArBF;AAsBjB,uBAAmB,KAtBF;AAuBjB,mBAAe,KAvBE;AAwBjB,mBAAe,KAxBE;AAyBjB,8BAA0B,KAzBT;AA0BjB,kCAA8B,KA1Bb;AA2BjB,qBAAiB,EA3BA;AA4BjB,sBAAkB,KA5BD;AA6BjB,sBAAkB,KA7BD;AA8BjB,iBAAa,EA9BI;AA+BjB,kBAAc;AA/BG,CAArB;;AAkCA,IAAM,UAAU,SAAV,OAAU,GAAkC;AAAA,QAAjC,KAAiC,yDAAzB,YAAyB;AAAA,QAAX,MAAW;;AAC9C,YAAQ,GAAR,CAAY,QAAZ;AACA,YAAQ,GAAR,CAAY,MAAZ;AACA,QAAI,aAAJ;AACA,YAAQ,OAAO,IAAf;AACI,aAAK,MAAM,UAAX;AACI,oBAAQ,GAAR,CAAY,gCAAZ,EAA8C,IAAI,GAAJ,CAAQ,GAAR,CAAY,MAAZ,CAA9C;AACA,gCAAW,KAAX;AACJ,aAAK,MAAM,gBAAX;AACI,gCAAW,KAAX;AACJ,aAAK,MAAM,eAAX;AACI,gBAAI,MAAM,gBAAV,EAA4B,OAAO,MAAM,gBAAb;AAC5B,gBAAI,WAAW,wCAAuB,OAAO,IAAP,CAAY,QAAnC,CAAf;AACA;AACA,wCAAa,KAAb,EAAoB,EAAC,kBAAD,EAAW,aAAa,OAAO,IAAP,CAAY,IAApC,EAApB;AACA,gCAAW,KAAX;AACJ,aAAK,MAAM,kBAAX;AACI,wCAAa,KAAb,EAAoB;AAChB,kCAAkB,IADF;AAEhB,6BAAa,OAAO,IAAP,CAAY;AAFT,aAApB;AAIA,gCAAW,KAAX;AACJ,aAAK,MAAM,yBAAX;AACI,gBAAI,YAAY,OAAO,IAAP,CAAY,GAAZ,CAAgB;AAAA,uBAAK,wCAAuB,CAAvB,CAAL;AAAA,aAAhB,CAAhB;AACA,wCAAa,KAAb,EAAoB,EAAC,WAAW,SAAZ,EAApB;AACA,gCAAW,KAAX;AACJ,aAAK,MAAM,sBAAX;AACI,gBAAM,SAAS,OAAO,IAAtB;AACA,gBAAI,UAAU,OAAO,SAAP,EAAkB,GAAlB,CAAsB;AAAA,uBAAK,wCAAuB,CAAvB,CAAL;AAAA,aAAtB,CAAd;AACA,gBAAI,YAAY,OAAO,WAAP,EAAoB,GAApB,CAAwB;AAAA,uBAAK,wCAAuB,CAAvB,CAAL;AAAA,aAAxB,CAAhB;AACA,gBAAI,cAAc,UAAU,CAAV,CAAlB;AACA,wCAAa,KAAb,EAAoB;AAChB,wBAAQ,EAAC,gBAAD,EAAU,oBAAV,EADQ;AAEhB;AAFgB,aAApB;AAIA,gCAAW,KAAX;AACJ,aAAK,MAAM,eAAX;AACI,gBAAI,WAAW,wCAAuB,OAAO,IAAP,CAAY,QAAnC,CAAf;AACA,wCAAa,KAAb,EAAoB,EAAC,UAAU,QAAX,EAApB;AACA,gCAAW,KAAX;AACJ,aAAK,MAAM,WAAX;AACI;;;;;AAKA;;AAEA;;;;;;AAMA,mBAAO,KAAP;AACJ,aAAM,MAAM,mBAAZ;;AAEI;;AAEA,mBAAO,KAAP;AACJ;AACI,mBAAO,KAAP;AAzDR;AA2DH,CA/DD;;AAiEA,IAAM,QAAQ,wBAAY,OAAZ,EAAqB,iDAArB,CAAd;;AAEA,MAAM,SAAN,CAAgB;AAAA,WACZ,QAAQ,GAAR,CAAY,IAAZ,CADY;AAAA,CAAhB,CACsB;AADtB;;AAIA;;AAEA,SAAS,cAAT,CAAwB,WAAxB,EAAqC,QAArC,EAA8C;AAC1C,QAAI,MAAM,KAAV,CAAgB,YAAY,IAA5B,EAAkC,OAAlC,CAA0C,YAA1C,EAAwD,WAAxD,EAAqE,KAArE,GAA6E,IAA7E,CAAkF,gBAAQ;AACtF,YAAG,IAAH,EAAQ;AACJ,gBAAG,QAAH,EAAY;AACR,yBAAS,IAAT;AACH;AACJ,SAJD,MAIK;AACD,gBAAI,eAAJ,CAAoB,WAApB,EAAiC,UAAC,QAAD,EAAc;AAC3C,uBAAO,WAAP,EAAoB,QAApB,EAA8B,QAA9B;AACH,aAFD;AAGH;AACJ,KAVD,EAWA,UAAC,MAAD,EAAS,KAAT,EAAmB;AACf,gBAAQ,GAAR,CAAY,KAAZ;AACH,KAbD;AAcH;;AAED,SAAS,MAAT,CAAgB,UAAhB,EAA4B,QAA5B,EAAsC,QAAtC,EAA+C;AAAK;AAChD,QAAG,QAAH,EAAY;AACR,YAAI,eAAe,IAAI,YAAY,IAAhB,EAAnB;AACA,qBAAa,IAAb,CAAkB,OAAO,MAAP,CAAc,QAAd,EAAwB,EAAC,UAAU,WAAW,QAAX,EAAX,EAAkC,UAAU,WAAW,QAAX,EAA5C,EAAmE,YAAY,UAA/E,EAAxB,CAAlB,EAAuI;AACnI,qBAAS,iBAAS,IAAT,EAAe;AACpB,oBAAI,WAAW,IAAI,YAAY,QAAhB,EAAf;AACA,yBAAS,GAAT,CAAa,MAAb,EAAqB,KAAK,GAAL,CAAS,YAAT,IAAuB,GAAvB,GAA2B,KAAK,GAAL,CAAS,WAAT,CAAhD;AACA,yBAAS,GAAT,CAAa,MAAb,EAAqB;AACjB,4BAAQ,SADS;AAEjB,+BAAW,OAFM;AAGjB,8BAAU,KAAK;AAHE,iBAArB;AAKA,yBAAS,IAAT,CAAc,SAAd,EAAyB;AACrB,6BAAS,iBAAS,QAAT,EAAmB;AACxB,iDAAyB,UAAzB;AACA,iCAAS,IAAT;AACH,qBAJoB;AAKrB,2BAAO,eAAS,IAAT,EAAe,MAAf,EAAsB;AACzB;AACA;AACA,gCAAQ,GAAR,CAAY,mDAAmD,OAAM,OAArE;AACH;AAToB,iBAAzB;AAaH,aAtBkI;AAuBnI,mBAAO,eAAS,IAAT,EAAe,OAAf,EAAsB;AACzB;AACA;AACA,wBAAQ,GAAR,CAAY,mDAAmD,QAAM,OAArE;AACH;AA3BkI,SAAvI;AA6BH;AACJ;;AAED,SAAS,wBAAT,CAAkC,WAAlC,EAA8C;AAC1C,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;;AADH;AAJK,KAAlB;AASA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,QAAT,CAAkB,WAAlB,EAA+B;AAC3B,QAAI,YAAJ,CAAiB,WAAjB;AACA,kBAAc,SAAS,WAAT,CAAd;;AAEA,mBAAe,WAAf,EAA4B,gBAAQ;AAChC,YAAG,IAAH,EAAQ;AACJ,kBAAM,QAAN,CAAe,QAAQ,YAAR,CAAqB,WAArB,CAAf,EAAkD,IAAlD,CACI,YAAM;AACF,sBAAM,QAAN,CAAe,QAAQ,YAAR,CAAqB,IAArB,CAAf,EAA2C,IAA3C,CACI,YAAM;AACF,sCAAkB,WAAlB;AACH,iBAHL;AAKH,aAPL;AASH,SAVD,MAWI;AACA,gBAAI,cAAc;AACd,2BAAW;AACP,wBAAI;AADG,iBADG;AAId,yBAAS;AACL,4BAAQ;AADH;AAJK,aAAlB;;AASA,gBAAI,aAAJ,CAAkB,WAAlB;AACA,gBAAI,WAAJ,CAAgB,WAAhB;AAEH;AACJ,KA1BD;AA2BH;;AAED,SAAS,iBAAT,CAA2B,WAA3B,EAAwC;AACpC,QAAI,WAAW,MAAM,QAAN,GAAiB,QAAhC;AACA,QAAI,WAAW,MAAM,QAAN,GAAiB,QAAhC;;AAEA;;AAEA,QAAI,YAAY,SAAS,KAAT,CAAe,GAA/B;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,wBAAY;AACR,sBAAM,UADE;AAER,yBAAS;AACL,mCAAe,SADV;AAEL;AACA,8BAAU,CAAC;AACP,iCAAa,UAAQ,SAAS,UAAjB,GAA4B,uBADlC;AAEP,oCAAa,8EAFN;AAGP,qCAAa,SAHN;AAIP,mCAAU,CACN;AACI,oCAAO,UADX;AAEI,qCAAQ,iBAFZ;AAGI,uCAAW;AAHf,yBADM,EAMN;AACI,oCAAO,UADX;AAEI,qCAAQ,oBAFZ;AAGI,uCAAW;AAHf,yBANM,EAWN;AACI,oCAAO,UADX;AAEI,qCAAQ,qBAFZ;AAGI,uCAAW;AAHf,yBAXM;AAJH,qBAAD;AAHL;AAFD;AADP;AAJK,KAAlB;;AAqCA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,eAAT,CAAyB,WAAzB,EAAqC;AACjC,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,WAAW,MAAM,QAAN,GAAiB,QAAhC;AACA,kBAAc,SAAS,WAAT,CAAd;;AAEA,QAAG,CAAC,EAAE,OAAF,CAAU,QAAV,CAAJ,EAAwB;AACpB,cAAM,QAAN,CAAe,QAAQ,qBAAR,CAA8B,SAAS,cAAvC,CAAf,EAAuE,IAAvE,CACI,YAAM;AACF,qCAAyB,WAAzB;AACH,SAHL;AAKH,KAND,MAOI;AACA,cAAM,QAAN,CAAe,QAAQ,YAAR,CAAqB,WAArB,CAAf,EAAkD,IAAlD,CACI,YAAM;AACF,2BAAe,WAAf,EAA4B,gBAAQ;AAChC,oBAAG,IAAH,EAAQ;AACJ,0BAAM,QAAN,CAAe,QAAQ,YAAR,CAAqB,IAArB,CAAf,EAA2C,IAA3C,CACI,YAAM;AACF,mCAAW,MAAM,QAAN,GAAiB,QAA5B;AACA,8BAAM,QAAN,CAAe,QAAQ,qBAAR,CAA8B,SAAS,cAAvC,CAAf,EAAuE,IAAvE,CACI,YAAM;AACF,qDAAyB,WAAzB;AACH,yBAHL;AAKH,qBARL;AAUH;AACJ,aAbD;AAcH,SAhBL;AAkBH;AACJ;;AAED,SAAS,wBAAT,CAAkC,WAAlC,EAA8C;AAC1C,QAAI,YAAY,MAAM,QAAN,GAAiB,SAAjC;AACA,QAAI,gBAAgB,EAApB;;AAEA,YAAQ,GAAR,CAAY,SAAZ;AACA,YAAQ,GAAR,CAAY,UAAU,MAAtB;;AAL0C;AAAA;AAAA;;AAAA;AAO1C,6BAAmB,SAAnB,8HAA6B;AAAA,gBAArB,OAAqB;;AACzB,gBAAG,cAAc,MAAd,IAAwB,IAAI,KAA/B,EACA,QAAQ,GAAR,CAAY,OAAZ;AACA,0BAAc,IAAd,CAAmB;AACf,gCAAgB,MADD;AAEf,yBAAS,QAAQ,IAFF;AAGf,2BAAW,gBAAc,QAAQ,EAHlB,CAGqB;AAHrB,aAAnB;AAKH;AAfyC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAiB1C,kBAAc,IAAd,CAAmB;AACf,wBAAgB,MADD;AAEf,iBAAS,iBAFM;AAGf,mBAAW;AAHI,KAAnB;;AAMA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,uHADH,EAC+H;AACpI,6BAAiB;AAFZ;AAJK,KAAlB;;AAUA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,UAAT,CAAoB,WAApB,EAAiC,IAAjC,EAAsC;AAClC,QAAI,YAAJ,CAAiB,WAAjB;AACA,8BAA0B,WAA1B;AACH;;AAED,SAAS,UAAT,CAAoB,WAApB,EAAgC;AAC5B,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,kDADH;AAEL,6BAAgB,CACZ;AACI,gCAAgB,MADpB;AAEI,yBAAS,oBAFb;AAGI,2BAAW;AAHf,aADY,EAMZ;AACI,gCAAgB,MADpB;AAEI,yBAAS,qBAFb;AAGI,2BAAW;AAHf,aANY;AAFX;AAJK,KAAlB;AAoBA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,YAAT,CAAsB,WAAtB,EAAkC;AAC9B,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,UAAJ,CAAe,WAAf,EAA4B,SAA5B,EAAuC,iBAAvC;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,cAAT,CAAwB,WAAxB,EAAqC,QAArC,EAA8C;AAC1C,QAAI,aAAa,IAAI,MAAJ,CAAW,WAAX,CAAjB;;AAEA,YAAQ,GAAR,CAAY,gBAAZ;;AAEA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,mBAAW;AACP,oBAAQ,gDAA8C,WAAW,OAAzD,GAAiE;AADlE;AAJG,KAAlB;;AASA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,QAA7B;AACH;;AAED,SAAS,OAAT,CAAiB,WAAjB,EAA8B,QAA9B,EAAuC;AACnC,QAAI,aAAa,IAAI,MAAJ,CAAW,WAAX,CAAjB;;AAEA,YAAQ,GAAR,CAAY,SAAZ;;AAEA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,mBAAW;AACP,0BAAc;AACV,wBAAQ,OADE;AAEV,2BAAW;AACP,2BAAO,2DAAyD,WAAW,QAAX,CAAoB,GAA7E,GAAiF,GAAjF,GAAqF,WAAW,QAAX,CAAoB,GAAzG,GAA6G,4CAA7G,GAA0J,WAAW,QAAX,CAAoB,GAA9K,GAAkL,GAAlL,GAAsL,WAAW,QAAX,CAAoB;AAD1M;AAFD;AADP;AAJG,KAAlB;;AAcA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,QAA7B;AACH;;AAED,SAAS,iBAAT,CAA2B,WAA3B,EAAuC;AACnC,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,aAAa,IAAI,MAAJ,CAAW,WAAX,CAAjB;;AAEA,uBAAS,OAAT,CAAiB,WAAW,OAA5B,EAAqC,UAAC,KAAD,EAAQ,IAAR,EAAgB;AACjD,YAAG,CAAC,KAAD,IAAU,KAAK,MAAL,IAAe,IAA5B,EAAiC;AAC7B,gBAAI,SAAS,KAAK,OAAL,CAAa,CAAb,CAAb;;AAEA,uBAAW,OAAX,GAAqB,OAAO,iBAA5B;AACA,uBAAW,QAAX,GAAsB,OAAO,QAAP,CAAgB,QAAtC;;AAEA,oBAAQ,GAAR,CAAY,UAAZ;;AAEA,2BAAe,WAAf,EAA4B,YAAM;AAC9B,wBAAQ,WAAR,EAAqB,YAAM;AACvB,wBAAI,cAAc;AACd,mCAAW;AACP,gCAAI;AADG,yBADG;AAId,iCAAS;AACL,oCAAQ,cADH;AAEL,6CAAgB,CACZ;AACI,gDAAgB,MADpB;AAEI,yCAAS,IAFb;AAGI,2CAAW;AAHf,6BADY,EAMZ;AACI,gDAAgB,MADpB;AAEI,yCAAS,IAFb;AAGI,2CAAW;AAHf,6BANY;AAFX;AAJK,qBAAlB;AAoBA,wBAAI,WAAJ,CAAgB,WAAhB;AACH,iBAtBD;AAuBH,aAxBD;AAyBH,SAjCD,MAkCI;AACA,oBAAQ,GAAR,CAAY,mBAAZ;AACA,oBAAQ,GAAR,CAAY,KAAZ;AACH;AAEJ,KAxCD;AAyCH;;AAED,SAAS,oBAAT,CAA8B,WAA9B,EAA0C;AACtC,QAAI,WAAW,MAAM,QAAN,GAAiB,QAAhC;AACA,QAAI,aAAa,IAAI,MAAJ,CAAW,WAAX,CAAjB;;AAEA,YAAQ,GAAR,CAAY,IAAI,MAAJ,CAAW,WAAX,CAAZ;;AAEA,QAAI,WAAW,IAAI,MAAM,QAAV,CAAmB,EAAC,UAAU,WAAW,WAAW,QAAX,CAAoB,GAA/B,CAAX,EAAgD,WAAW,WAAW,WAAW,QAAX,CAAoB,GAA/B,CAA3D,EAAnB,CAAf;;AAEA,QAAI,kBAAkB,IAAI,YAAY,eAAhB,EAAtB;AACA,oBAAgB,GAAhB,CAAoB,MAApB,EAA4B,WAAW,cAAX,CAA5B;AACA,oBAAgB,GAAhB,CAAoB,SAApB,EAA+B,WAAW,OAA1C;AACA,oBAAgB,GAAhB,CAAoB,UAApB,EAAgC;AAC5B,gBAAQ,SADoB;AAE5B,mBAAW,UAFiB;AAG5B,kBAAU,SAAS,cAAT,CAAwB;AAHN,KAAhC;AAKA,oBAAgB,GAAhB,CAAoB,UAApB,EAAgC,QAAhC;;AAEA,oBAAgB,IAAhB,CAAqB,SAArB,EAAgC;AAC5B,iBAAS,iBAAS,MAAT,EAAiB;;AAEtB,mBAAO,WAAW,OAAlB;AACA,mBAAO,WAAW,QAAlB;AACA,mBAAO,WAAW,cAAX,CAAP;;AAEA,oBAAQ,GAAR,CAAY,kBAAZ;AAEH,SAT2B;AAU5B,eAAO,eAAS,IAAT,EAAe,OAAf,EAAsB;AACzB;AACA;AACA,oBAAQ,GAAR,CAAY,mDAAmD,QAAM,OAArE;AACH;AAd2B,KAAhC;;AAiBA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;;AASA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,eAA7B;AACH;;AAED,SAAS,cAAT,CAAwB,WAAxB,EAAoC;AAChC,QAAI,aAAJ,CAAkB,WAAlB;;AAEA,QAAI,aAAa,IAAI,MAAJ,CAAW,WAAX,CAAjB;;AAEA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,UAAJ,CAAe,WAAf,EAA4B,cAA5B,EAA4C,oBAA5C;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,WAAT,CAAqB,WAArB,EAAiC;AAC7B,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,oDADH;AAEL,6BAAgB,CACZ;AACI,gCAAe;AADnB,aADY;AAFX;AAJK,KAAlB;AAaA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,yBAAT,CAAmC,WAAnC,EAA+C;AAC3C,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,cAA7B;AACH;;AAED,SAAS,8BAAT,CAAwC,WAAxC,EAAoD;AAChD,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,cAAT,CAAwB,WAAxB,EAAqC,MAArC,EAA4C;AACxC,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,QAAG,UAAU,SAAb,EACI,SAAS,CAAT,CADJ,KAEK,IAAI,OAAO,MAAP,IAAiB,QAArB,EACD,SAAS,SAAS,MAAT,CAAT;;AAEJ,QAAG,UAAU,CAAb,EAAe;AACX,uCAA+B,WAA/B;AACA,YAAI,YAAJ,CAAiB,WAAjB;AACH;;AAED,UAAM,KAAN,CAAY,GAAZ,CAAgB,aAAhB,EAA+B,EAAE,YAAY,WAAd,EAA/B,EAA4D,IAA5D,CACI,UAAS,MAAT,EAAgB;;AAEZ,YAAI,WAAW,gBAAgB,OAAO,UAAvB,EAAmC,MAAnC,CAAf;AACA,YAAI,MAAM,OAAO,IAAP,CAAY,OAAO,UAAnB,EAA+B,MAAzC;AACA,YAAI,UAAU,EAAd;AACA,YAAI,SAAS,CAAC,SAAO,CAAR,IAAW,IAAI,KAA5B;AACA,YAAI,SAAW,MAAM,SAAO,IAAI,KAAlB,GAA2B,SAAO,IAAI,KAAtC,GAA8C,GAA5D;AACA;;;;;;AAMA,YAAG,MAAM,CAAC,SAAO,CAAR,IAAW,IAAI,KAAxB,EAA8B;AAC1B,oBAAQ,IAAR,CAAa;AACT,sBAAM,UADG;AAET,uBAAO,iBAAe,SAAO,CAAtB,IAAyB,GAAzB,GAA6B,MAF3B;AAGT,yBAAS,qBAAmB,SAAO,CAA1B;AAHA,aAAb;;AAMA,qBAAS,IAAT,CAAc;AACV,uBAAO,qBADG;AAEV,0BAAU,wBAFA;AAGV,yBAAS;AAHC,aAAd;AAKH;;AAED,YAAI,cAAc;AACd,uBAAW;AACP,oBAAI;AADG,aADG;AAId,qBAAS;AACL,4BAAY;AACR,0BAAM,UADE;AAER,6BAAS;AACL,uCAAe,SADV;AAEL,kCAAU;AAFL;AAFD;AADP;AAJK,SAAlB;;AAeA,YAAI,aAAJ,CAAkB,WAAlB;AACA,YAAI,WAAJ,CAAgB,WAAhB;AAEH,KA9CL,EA+CI,UAAS,KAAT,EAAgB,CAEf,CAjDL;AAkDH;;AAED,SAAS,eAAT,CAAyB,UAAzB,EAAqC,MAArC,EAA4C;AACxC,QAAI,MAAM,CAAV;AACA,QAAI,WAAW,EAAf;;AAEA,eAAW,OAAX,CAAmB,UAAS,IAAT,EAAc;AAC7B;AACA,YAAG,QAAQ,KAAK,GAAL,CAAS,MAAT,CAAX,EAA4B;AACxB;AACA,gBAAG,OAAQ,MAAD,GAAS,IAAI,KAApB,IAA6B,MAAM,CAAC,SAAO,CAAR,IAAW,IAAI,KAArD,EAA2D;AACvD,oBAAI,QAAQ,KAAK,GAAL,CAAS,OAAT,CAAZ;AACA,oBAAI,YAAY,oIAAhB;AACA,oBAAG,KAAH,EAAS;AACL,gCAAY,MAAM,GAAN,EAAZ;AACH;AACD,yBAAS,IAAT,CAAc;AACV,2BAAO,KAAK,GAAL,CAAS,MAAT,CADG;AAEV;AACA;AACA,+BAAW,SAJD;AAKV,6BAAS,CAAC;AACN,8BAAM,UADA;AAEN,+BAAO,KAAK,GAAL,CAAS,MAAT,CAFD;AAGN,iCAAS,kBAAgB,KAAK,EAArB,GAAwB,GAAxB,GAA4B;AAH/B,qBAAD;AALC,iBAAd;AAWH;AACD,kBAAM,MAAI,CAAV;AACH;AACJ,KAxBD;AAyBA,WAAO,QAAP;AACH;;AAED,SAAS,4BAAT,CAAsC,WAAtC,EAAmD,UAAnD,EAA8D;AAC1D,WAAO,IAAI,MAAM,KAAV,CAAgB,YAAY,QAA5B,EAAsC,GAAtC,CAA0C,UAA1C,EAAsD,IAAtD,CACH,oBAAY;AACR,YAAI,cAAc;AACd,uBAAW;AACP,oBAAI;AADG,aADG;AAId,qBAAS;AACL,sBAAM,4BAA0B,SAAS,GAAT,CAAa,MAAb,CAA1B,GAA+C;AADhD;AAJK,SAAlB;AAQA,YAAI,aAAJ,CAAkB,WAAlB;AACA,YAAI,WAAJ,CAAgB,WAAhB;AACH,KAZE,EAaH,UAAC,MAAD,EAAS,KAAT,EAAmB;AACf,gBAAQ,GAAR,CAAY,KAAZ;AACA;AACH,KAhBE,CAAP;AAkBH;;AAED,SAAS,YAAT,CAAsB,WAAtB,EAAmC,QAAnC,EAA6C,MAA7C,EAAoD;AAChD,QAAI,YAAJ,CAAiB,WAAjB;AACA,aAAS,SAAS,MAAT,CAAT;AACA,QAAG,UAAU,CAAb,EAAe;AACX,qCAA6B,WAA7B,EAA0C,QAA1C;AACA,YAAI,YAAJ,CAAiB,WAAjB;AACH;;AAED,UAAM,KAAN,CAAY,GAAZ,CAAgB,aAAhB,EAA+B,EAAE,YAAY,WAAd,EAA2B,UAAU,QAArC,EAA/B,EAAgF,IAAhF,CAAqF,UAAS,MAAT,EAAiB;AAClG,YAAI,WAAW,cAAc,OAAO,QAArB,EAA+B,MAA/B,CAAf;AACA,YAAI,MAAM,OAAO,IAAP,CAAY,OAAO,QAAnB,EAA6B,MAAvC;AACA,YAAI,UAAU,EAAd;AACA,YAAI,SAAS,CAAC,SAAO,CAAR,IAAW,IAAI,KAA5B;AACA,YAAI,SAAW,MAAM,SAAO,IAAI,KAAlB,GAA2B,SAAO,IAAI,KAAtC,GAA8C,GAA5D;AACA;;;;;;AAMA,YAAI,MAAM,CAAC,SAAO,CAAR,IAAW,IAAI,KAAzB,EAAgC;AAC5B,oBAAQ,IAAR,CAAa;AACT,sBAAM,UADG;AAET,uBAAO,gBAAc,SAAO,CAArB,IAAwB,GAAxB,GAA4B,MAF1B;AAGT,yBAAS,kBAAgB,QAAhB,GAAyB,GAAzB,IAA8B,SAAO,CAArC;AAHA,aAAb;;AAMA,qBAAS,IAAT,CAAc;AACV,uBAAO,oBADG;AAEV,0BAAU,uBAFA;AAGV,yBAAS;AAHC,aAAd;AAKH;;AAED,YAAI,cAAc;AACd,uBAAW;AACP,oBAAI;AADG,aADG;AAId,qBAAS;AACL,4BAAY;AACR,0BAAM,UADE;AAER,6BAAS;AACL,uCAAe,SADV;AAEL,kCAAU;AAFL;AAFD;AADP;AAJK,SAAlB;;AAeA,YAAI,aAAJ,CAAkB,WAAlB;AACA,YAAI,WAAJ,CAAgB,WAAhB;AACH,KA3CD,EA4CA,UAAS,KAAT,EAAgB,CAEf,CA9CD;AA+CH;;AAED,SAAS,aAAT,CAAuB,QAAvB,EAAiC,MAAjC,EAAwC;AACpC,QAAI,MAAM,CAAV;AACA,QAAI,WAAW,EAAf;;AAEA,aAAS,OAAT,CAAiB,UAAS,IAAT,EAAc;AAC3B,YAAG,QAAQ,KAAK,GAAL,CAAS,MAAT,CAAX,EAA4B;AACxB,gBAAG,OAAQ,MAAD,GAAS,IAAI,KAApB,IAA6B,MAAM,CAAC,SAAO,CAAR,IAAW,IAAI,KAArD,EAA2D;AACvD,oBAAI,QAAQ,KAAK,GAAL,CAAS,OAAT,CAAZ;AACA,oBAAI,YAAY,oIAAhB;AACA,oBAAG,KAAH,EAAS;AACL,gCAAY,MAAM,GAAN,EAAZ;AACH;AACD,yBAAS,IAAT,CAAc;AACV,2BAAO,KAAK,GAAL,CAAS,MAAT,IAAkB,KAAlB,GAAyB,KAAK,GAAL,CAAS,cAAT,CADtB;AAEV,8BAAU,KAAK,GAAL,CAAS,aAAT,CAFA;AAGV;AACA,+BAAW,SAJD;AAKV,6BAAS,CAAC;AACN,8BAAM,UADA;AAEN,+BAAO,SAFD;AAGN,iCAAS,gBAAc,KAAK;AAHtB,qBAAD;AALC,iBAAd;AAWH;AACD,kBAAM,MAAI,CAAV;AACH;AACJ,KAtBD;AAuBA,WAAO,QAAP;AACH;;AAED,SAAS,UAAT,CAAoB,WAApB,EAAiC,SAAjC,EAA2C;AACvC;AACA;AACA,QAAG,CAAC,MAAM,GAAN,CAAU,SAAV,CAAJ,EAAyB;AACrB,cAAM,GAAN,CAAU,SAAV,EAAqB,CAArB;AACH,KAFD,MAGI;AACA,cAAM,GAAN,CAAU,SAAV,EAAqB,MAAM,GAAN,CAAU,SAAV,IAAqB,CAA1C;AACH;AACD,iCAA6B,WAA7B,EAA0C,SAA1C;AACH;;AAED,SAAS,4BAAT,CAAsC,WAAtC,EAAmD,SAAnD,EAA6D;AACzD,WAAO,IAAI,MAAM,KAAV,CAAgB,YAAY,OAA5B,EAAqC,GAArC,CAAyC,SAAzC,EAAoD,IAApD,CACH,mBAAW;AACP,YAAI,cAAc;AACd,uBAAW;AACP,oBAAI;AADG,aADG;AAId,qBAAS;AACL,wBAAQ,iBAAe,QAAQ,GAAR,CAAY,MAAZ,CAAf,GAAmC,0EADtC;AAEL,iCAAgB,CACZ;AACI,oCAAe,MADnB;AAEI,6BAAQ,iBAFZ;AAGI,+BAAU;AAHd,iBADY,EAMZ;AACI,oCAAe,MADnB;AAEI,6BAAQ,aAFZ;AAGI,+BAAU;AAHd,iBANY;AAFX;AAJK,SAAlB;AAoBA,YAAI,aAAJ,CAAkB,WAAlB;AACA,YAAI,WAAJ,CAAgB,WAAhB;AACH,KAxBE,EAyBH,UAAC,MAAD,EAAS,KAAT,EAAmB;AACf,gBAAQ,GAAR,CAAY,KAAZ;AACA;AACH,KA5BE,CAAP;AA8BH;;AAED,SAAS,mBAAT,CAA6B,WAA7B,EAAyC;AACrC,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,oDADH;AAEL,6BAAgB,CACZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,iBAFZ;AAGI,2BAAU;AAHd,aADY,EAMZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,aAFZ;AAGI,2BAAU;AAHd,aANY;AAFX;AAJK,KAAlB;AAoBA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,gBAAT,CAA0B,WAA1B,EAAsC;AAClC;AACA,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,QAAI,WAAW,EAAf;AACA,QAAI,UAAU,EAAd;AACA,QAAI,QAAQ,CAAZ;AACA,QAAI,aAAa,MAAM,KAAN,EAAjB;AACA,QAAI,MAAM,CAAV;AACA,QAAI,KAAJ;AACA,QAAI,SAAJ;;AAEA,YAAQ,GAAR,CAAY,eAAZ;;AAEA,QAAG,cAAc,CAAjB,EAAmB;AACf,gCAAwB,WAAxB;AACH,KAFD,MAGI;AACA,cAAM,OAAN,CAAc,UAAS,KAAT,EAAgB,GAAhB,EAAoB;AAC9B,gBAAI,UAAU,MAAM,MAAN,CAAa,MAAb,CAAoB,SAApB,CAAd;AACA,gBAAI,UAAU,IAAI,MAAM,KAAV,CAAgB,OAAhB,CAAd;AACA;;AAEA,oBAAQ,GAAR,CAAY,GAAZ,EAAiB;AACb,yBAAS,iBAAU,IAAV,EAAgB;AACrB,4BAAQ,KAAK,GAAL,CAAS,OAAT,CAAR;AACA,gCAAY,oIAAZ;AACA,wBAAG,KAAH,EAAS;AACL,oCAAY,MAAM,GAAN,EAAZ;AACH;;AAED,8BAAU,EAAV;AACA,4BAAQ,OAAR,IAAmB,KAAK,GAAL,CAAS,MAAT,CAAnB;AACA,4BAAQ,UAAR,IAAsB,KAAK,GAAL,CAAS,aAAT,CAAtB;AACA,4BAAQ,UAAR,IAAsB,MAAM,GAAN,CAAU,GAAV,CAAtB;AACA,4BAAQ,OAAR,IAAmB,SAAS,KAAK,GAAL,CAAS,cAAT,CAAT,CAAnB;AACA,4BAAQ,UAAR,IAAsB,KAAtB;AACA,4BAAQ,WAAR,IAAuB,SAAvB;;AAEA,6BAAS,IAAT,CAAc,OAAd;AACA,6BAAS,QAAQ,UAAR,IAAoB,QAAQ,OAAR,CAA7B;;AAEA;;AAEA,wBAAG,OAAO,UAAV,EAAqB;AACjB,2CAAmB,WAAnB,EAAgC,QAAhC,EAA0C,KAA1C;AACH;AACJ,iBAxBY;AAyBb,uBAAO,eAAU,OAAV,EAAiB;AACpB,0BAAM,YAAY,QAAM,IAAlB,GAAyB,GAAzB,GAA+B,QAAM,OAA3C;AACH;AA3BY,aAAjB;AA6BH,SAlCD;AAmCH;AAEJ;;AAED,SAAS,uBAAT,CAAiC,WAAjC,EAA6C;AACzC,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,mBAA7B;AACH;;AAED,SAAS,kBAAT,CAA4B,WAA5B,EAAyC,QAAzC,EAAmD,KAAnD,EAAyD;AACrD,QAAI,YAAY,UAAU,KAAK,KAAL,CAAW,KAAK,MAAL,KAAc,IAAzB,CAA1B;;AAEA,2BAAQ;AACJ,aAAK,qCAAmC,WADpC;AAEJ,YAAI,EAAE,cAAc,iBAAhB,EAAmC,QAAQ,6CAA3C,EAFA;AAGJ,gBAAQ;;AAHJ,KAAR,EAKG,UAAU,KAAV,EAAiB,QAAjB,EAA2B,IAA3B,EAAiC;AAChC,YAAI,CAAC,KAAD,IAAU,SAAS,UAAT,IAAuB,GAArC,EAA0C;AACtC,gBAAI,WAAW,KAAK,KAAL,CAAW,IAAX,CAAf;AACA;;AAEA,gBAAI,cAAc;AACd,2BAAW;AACP,wBAAI;AADG,iBADG;AAId,yBAAQ;AACJ,gCAAY;AACR,8BAAM,UADE;AAER,iCAAS;AACL,2CAAe,SADV;AAEL,4CAAgB,SAAS,UAAT,GAAoB,GAApB,GAAwB,SAAS,SAF5C;AAGL,0CAAc,SAHT;AAIL,sCAAU,KAJL;AAKL,4CAAgB,WALX;AAML,uCAAW,KAAK,KAAL,CAAW,KAAK,GAAL,KAAW,IAAtB,EAA4B,QAA5B,EANN;AAOL,sCAAU,QAPL;AAQL,qCAAS;AACL,0CAAU,uBADL;AAEL,0CAAU,EAFL;AAGL,sCAAM,UAHD;AAIL,6CAAa,QAJR;AAKL,uCAAO,IALF;AAML,yCAAS;AANJ,6BARJ;AAgBL,qCAAS;AACL,0CAAU,KADL;AAEL,+CAAe,OAFV;AAGL,2CAAW,QAAM,IAHZ;AAIL,4CAAY,QAAM,IAAN,GAAW;AAJlB;AAMT;AACA;AACA;AACA;AACA;AACA;AACA;AA5BK;AAFD;AADR;AAJM,aAAlB;AAwCA;AACA;AACA,gBAAI,aAAJ,CAAkB,WAAlB;AACA,gBAAI,WAAJ,CAAgB,WAAhB,EAA6B,8BAA7B;AACA;AACH;AACJ,KAxDD;AAyDH;;AAED,SAAS,8BAAT,CAAwC,WAAxC,EAAoD;AAChD,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,0CADH;AAEL,6BAAgB,CACZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,IAFZ;AAGI,2BAAU;AAHd,aADY,EAMZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,IAFZ;AAGI,2BAAU;AAHd,aANY;AAFX;AAJK,KAAlB;AAoBA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,QAAT,CAAkB,WAAlB,EAA8B;AAC1B,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,mBAAe,WAAf;AACH;;AAED,SAAS,cAAT,CAAwB,WAAxB,EAAoC;AAChC,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,oEADH;AAEL,6BAAgB,CACZ;AACI,gCAAgB,MADpB;AAEI,yBAAS,gBAFb;AAGI,2BAAW;AAHf,aADY,EAMZ;AACI,gCAAgB,MADpB;AAEI,yBAAS,KAFb;AAGI,2BAAW;AAHf,aANY,EAWZ;AACI,gCAAgB,MADpB;AAEI,yBAAS,UAFb;AAGI,2BAAW;AAHf,aAXY;AAFX;AAJK,KAAlB;AAyBA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,eAAT,CAAyB,WAAzB,EAAqC;AACjC,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,qBAAiB,WAAjB;AACH;;AAED,SAAS,gBAAT,CAA0B,WAA1B,EAAsC;AAClC,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,mEADH;AAEL,6BAAgB,CACZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,IAFZ;AAGI,2BAAU;AAHd,aADY,EAMZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,IAFZ;AAGI,2BAAU;AAHd,aANY;AAFX;AAJK,KAAlB;AAoBA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,kBAAT,CAA4B,WAA5B,EAAwC;AACpC,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,0BAAa;AACT,wBAAO,UADE;AAET,2BAAU;AACN,qCAAiB,QADX;AAEN,4BAAQ,uJAFF;AAGN,+BAAU,CACN;AACI,gCAAO,SADX;AAEI,+BAAM,gCAFV;AAGI,iCAAQ;AAHZ,qBADM,EAON;AACI,gCAAO,UADX;AAEI,iCAAQ,IAFZ;AAGI,mCAAU;AAHd,qBAPM;AAHJ;AAFD;AADR;AAJK,KAAlB;AA2BA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,yBAA7B;AACH;;AAED,SAAS,wBAAT,CAAkC,WAAlC,EAA8C;AAC1C,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,QAA7B;AACH;;AAED,SAAS,yBAAT,CAAmC,WAAnC,EAA+C;AAC3C,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,iCADH;AAEL,6BAAgB,CACZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,qBAFZ;AAGI,2BAAU;AAHd,aADY,EAMZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,iBAFZ;AAGI,2BAAU;AAHd,aANY;AAFX;AAJK,KAAlB;AAoBA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,iBAAT,CAA2B,WAA3B,EAAwC,YAAxC,EAAqD;AACjD,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,sBAAkB,WAAlB;AACH;;AAED,SAAS,iBAAT,CAA2B,WAA3B,EAAuC;AACnC,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,UAA7B;AACH;;AAED,SAAS,UAAT,CAAoB,WAApB,EAAgC;AAC5B,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,SAA7B;AACH;;AAED,SAAS,SAAT,CAAmB,WAAnB,EAA+B;AAC3B,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB,EAA6B,aAA7B;AACH;;AAED,SAAS,aAAT,CAAuB,WAAvB,EAAmC;AAC/B,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ,4GADH;AAEL,6BAAgB,CACZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,eAFZ;AAGI,2BAAU;AAHd,aADY,EAMZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,UAFZ;AAGI,2BAAU;AAHd,aANY,EAWZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,aAFZ;AAGI,2BAAU;AAHd,aAXY,EAgBZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,SAFZ;AAGI,2BAAU;AAHd,aAhBY,EAqBZ;AACI,gCAAe,MADnB;AAEI,yBAAQ,aAFZ;AAGI,2BAAU;AAHd,aArBY;AAFX;AAJK,KAAlB;AAmCA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,SAAS,SAAT,CAAmB,WAAnB,EAAgC,MAAhC,EAAuC;AACnC,QAAI,YAAJ,CAAiB,WAAjB;;AAEA,UAAM,WAAN;AACH;;AAED,SAAS,KAAT,CAAe,WAAf,EAA2B;AACvB,QAAI,YAAJ,CAAiB,WAAjB;AACA,QAAI,cAAc;AACd,mBAAW;AACP,gBAAI;AADG,SADG;AAId,iBAAS;AACL,oBAAQ;AADH;AAJK,KAAlB;AAQA,QAAI,aAAJ,CAAkB,WAAlB;AACA,QAAI,WAAJ,CAAgB,WAAhB;AACH;;AAED,MAAM,QAAN,CAAe,EAAC,MAAM,MAAM,UAAb,EAAf;;AAEA;;;;;;;;;;;;AAYA,IAAI,QAAQ,uBAAZ","file":"app-compiled.js","sourcesContent":["import * as _ from 'underscore';\nimport * as bot from './bot';\nimport * as types from './constants/actionTypes';\nimport * as Actions from './actions/index';\nimport * as ParseModels from './ParseModels';\nimport { extractParseAttributes } from './ParseUtils';\nimport { createStore, applyMiddleware } from 'redux';\n\nimport config from 'config';\nimport request from 'request';\nimport HashMap  from 'hashmap';\nimport objectAssign from 'object-assign';\nimport thunk from 'redux-thunk';\nimport FB from 'fb';\nimport geocoder from 'geocoder';\n\nconst APP_SECRET = (process.env.MESSENGER_APP_SECRET) ? process.env.MESSENGER_APP_SECRET : config.get('APP_SECRET');\n\nconst PAGE_ACCESS_TOKEN = (process.env.MESSENGER_PAGE_ACCESS_TOKEN) ? (process.env.MESSENGER_PAGE_ACCESS_TOKEN) : config.get('PAGE_ACCESS_TOKEN');\n\nconst PARSE_APP_ID = (process.env.PARSE_APP_ID) ? (process.env.PARSE_APP_ID) : config.get('PARSE_APP_ID');\n\nconst PARSE_SERVER_URL = (process.env.PARSE_SERVER_URL) ? (process.env.PARSE_SERVER_URL) : config.get('PARSE_SERVER_URL');\n\nconst PARSE_CLIENT_KEY = (process.env.PARSE_CLIENT_KEY) ? (process.env.PARSE_CLIENT_KEY) : config.get('PARSE_CLIENT_KEY');\n\nconst FACEBOOK_APP_ID = (process.env.FACEBOOK_APP_ID) ? (process.env.FACEBOOK_APP_ID) : config.get('FACEBOOK_APP_ID');\n\nconst REDIRECT_URI = (process.env.REDIRECT_URI) ? (process.env.REDIRECT_URI) : config.get('REDIRECT_URI');\n\nconst BUSINESS_ID = (process.env.BUSINESS_ID) ? (process.env.BUSINESS_ID) : config.get('BUSINESS_ID');\n\n\nFB.options({\n    appId:          FACEBOOK_APP_ID,\n    appSecret:      APP_SECRET,\n    redirectUri:    REDIRECT_URI\n});\n\nbot.rules.set('hola', sendMenu);\nbot.rules.set('iniciar', sendMenu);\nbot.rules.set('empezar', sendMenu);\nbot.rules.set('comenzar', sendMenu);\nbot.rules.set('buenos dias', sendMenu);\nbot.rules.set('buenas tardes', sendMenu);\nbot.rules.set('pedir domicilio', sendAddressMenu);\nbot.rules.set('cuenta', sendShoppingCart);\n\nbot.payloadRules.set('Greeting', sendMenu);\nbot.payloadRules.set('SendAddressMenu', sendAddressMenu);\nbot.payloadRules.set('SetAddress', setAddress);\nbot.payloadRules.set('NewAddress', newAddress);\nbot.payloadRules.set('WriteAddress', writeAddress);\nbot.payloadRules.set('SetLocation', setLocation);\nbot.payloadRules.set('ConfirmAddress', confirmAddress);\nbot.payloadRules.set('SendCategories', sendCategories);\nbot.payloadRules.set('SendProducts', sendProducts);\nbot.payloadRules.set('AddProduct', addProduct);\nbot.payloadRules.set('SendShoppingCart', sendShoppingCart);\nbot.payloadRules.set('SendPurchaseOptions', sendPurchaseOptions);\nbot.payloadRules.set('Checkout', checkout);\nbot.payloadRules.set('CreditCard', checkCreditCard);\nbot.payloadRules.set('RegisterCreditCard', registerCreditCard);\nbot.payloadRules.set('ConfirmRegisterCreditCard', confirmRegisterCreditCard);\nbot.payloadRules.set('CancelRegisterCreditCard', cancelRegisterCreditCard);\nbot.payloadRules.set('PayWithCreditCard', payWithCreditCard);\nbot.payloadRules.set('SetRating', setRating);\n\nconst initialState = {\n    geocodedLocation: {lat: -1, lng: -1},\n    addresses: [],\n    mapBounds: {},\n    mapAddress: '',\n    useSubCategories: false,\n    products: [],\n    pointOfSales: [],\n    categories: [],\n    paymentMethods: [],\n    consumer: {},\n    customer: {},\n    orders: { ongoing: [], delivered: [] },\n    orderToRate: null,\n    currentOrder: {\n        consumerAddress:{},\n        items: []\n    },\n    locationZoom: 3,\n    profileIsOpen: false,\n    mapAddressIsOpen: false,\n    addressFormIsOpen: false,\n    addressListIsOpen: false,\n    savingAddress: false,\n    creatingOrder: false,\n    paymentMethodNotSelected: false,\n    cartTotalIsBelowMinimumPrice: false,\n    currentCategory: {},\n    consumerNotFound: false,\n    updatingConsumer: false,\n    currentUser: {},\n    pendingOrder: false\n};\n\nconst reducer = (state = initialState, action) => {\n    console.log('ACTION');\n    console.log(action);\n    let item;\n    switch (action.type) {\n        case types.APP_LOADED:\n            console.log('Application is running on port', bot.app.get('port'));\n            return {...state};\n        case types.CONSUMER_UPDATED:\n            return {...state};\n        case types.CONSUMER_LOADED:\n            if (state.consumerNotFound) delete state.consumerNotFound\n            var consumer = extractParseAttributes(action.data.consumer)\n            //objectAssign(state.consumerAddress, {consumer})\n            objectAssign(state, {consumer, currentUser: action.data.user});\n            return {...state};\n        case types.CONSUMER_NOT_FOUND:\n            objectAssign(state, {\n                consumerNotFound: true,\n                currentUser: action.data.user\n            })\n            return {...state};\n        case types.CONSUMER_ADDRESSES_LOADED:\n            let addresses = action.data.map(a => extractParseAttributes(a))\n            objectAssign(state, {addresses: addresses})\n            return {...state};\n        case types.CONSUMER_ORDERS_LOADED:\n            const orders = action.data\n            let ongoing = orders['ongoing'].map(o => extractParseAttributes(o))\n            let delivered = orders['delivered'].map(o => extractParseAttributes(o))\n            let orderToRate = delivered[0]\n            objectAssign(state, {\n                orders: {ongoing, delivered},\n                orderToRate\n            })\n            return {...state}\n        case types.CUSTOMER_LOADED:\n            var customer = extractParseAttributes(action.data.customer)\n            objectAssign(state, {customer: customer});\n            return {...state}\n        case types.RENDER_MENU:\n            /*\n            console.log('Store');\n            console.log(store.getState())\n            console.log('Consumer');\n            console.log(consumer);*/\n            renderMenuMessage()\n\n            /*request({\n             uri: 'https://graph.facebook.com/v2.6/' + '1100195690052041',\n             qs: {access_token: PAGE_ACCESS_TOKEN, fields: 'first_name,last_name,locale,timezone,gender'},\n             method: 'GET'\n             }, renderMenuMessage);*/\n\n            return state;\n        case  types.RENDER_ADDRESS_MENU:\n\n            renderAddressMenuMessage()\n\n            return state;\n        default:\n            return state;\n    }\n}\n\nconst store = createStore(reducer, applyMiddleware(thunk));\n\nstore.subscribe(() =>\n    console.log('\\n') //store.getState())\n);\n\n//global.FB = FB;\n\nfunction authentication(recipientId, callback){\n    new Parse.Query(ParseModels.User).equalTo('facebookId', recipientId).first().then(user => {\n        if(user){\n            if(callback){\n                callback(user)\n            }\n        }else{\n            bot.getFacebookUser(recipientId, (userData) => {\n                signup(recipientId, userData, callback);\n            });\n        }\n    },\n    (object, error) => {\n        console.log(error);\n    })\n}\n\nfunction signup(facebookId, userData, callback){    //1100195690052041\n    if(userData){\n        var facebookUser = new ParseModels.User();\n        facebookUser.save(Object.assign(userData, {username: facebookId.toString(), password: facebookId.toString(), facebookId: facebookId}), {\n            success: function(user) {\n                var consumer = new ParseModels.Consumer();\n                consumer.set('name', user.get('first_name')+\" \"+user.get('last_name'));\n                consumer.set('user', {\n                    __type: \"Pointer\",\n                    className: \"_User\",\n                    objectId: user.id\n                });\n                consumer.save(undefined, {\n                    success: function(consumer) {\n                        sendRegisterFacebookUser(facebookId);\n                        callback(user);\n                    },\n                    error: function(user, error) {\n                        // Execute any logic that should take place if the save fails.\n                        // error is a Parse.Error with an error code and message.\n                        console.log('Failed to create new object, with error code: ' + error.message);\n                    }\n                });\n\n\n            },\n            error: function(user, error) {\n                // Execute any logic that should take place if the save fails.\n                // error is a Parse.Error with an error code and message.\n                console.log('Failed to create new object, with error code: ' + error.message);\n            }\n        });\n    }\n}\n\nfunction sendRegisterFacebookUser(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Registro exitoso.\",\n\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendMenu(recipientId) {\n    bot.sendTypingOn(recipientId);\n    recipientId = parseInt(recipientId);\n\n    authentication(recipientId, user => {\n        if(user){\n            store.dispatch(Actions.loadCustomer(BUSINESS_ID)).then(\n                () => {\n                    store.dispatch(Actions.loadConsumer(user)).then(\n                        () => {\n                            renderMenuMessage(recipientId);\n                        }\n                    );\n                }\n            )\n        }\n        else{\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"Usuario no registrado en el sistema, informacion obtenida: first_name, last_name, locale, timezone, gender\"\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n\n        }\n    });\n}\n\nfunction renderMenuMessage(recipientId) {\n    var consumer = store.getState().consumer;\n    var customer = store.getState().customer;\n\n    //var currentUser = Parse.User.current();\n\n    var image_url = customer.image.url;\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: \"template\",\n                payload: {\n                    template_type: \"generic\",\n                    //text: \"Buenos dias, para conocer nuestros menus del dia, por favor escoja una opción:\",\n                    elements: [{\n                        \"title\":     \"Hola \"+consumer.first_name+\", Bienvenido a OXXO. \",\n                        \"subtitle\":  \"Aquí puedes pedir un domicilio, escribe o selecciona alguna de las opciones:\",\n                        \"image_url\": image_url,\n                        \"buttons\":[\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir domicilio\",\n                                \"payload\": \"SendAddressMenu\"\n                            },\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir para recoger\",\n                                \"payload\": \"TakeOut\"\n                            },\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Servicio al cliente\",\n                                \"payload\": \"CustomerService\"\n                            }\n                        ]\n                    }]\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendAddressMenu(recipientId){\n    bot.sendTypingOn(recipientId);\n    var consumer = store.getState().consumer;\n    recipientId = parseInt(recipientId);\n\n    if(!_.isEmpty(consumer)){\n        store.dispatch(Actions.loadConsumerAddresses(consumer.rawParseObject)).then(\n            () => {\n                renderAddressMenuMessage(recipientId);\n            }\n        );\n    }\n    else{\n        store.dispatch(Actions.loadCustomer(BUSINESS_ID)).then(\n            () => {\n                authentication(recipientId, user => {\n                    if(user){\n                        store.dispatch(Actions.loadConsumer(user)).then(\n                            () => {\n                                consumer = store.getState().consumer;\n                                store.dispatch(Actions.loadConsumerAddresses(consumer.rawParseObject)).then(\n                                    () => {\n                                        renderAddressMenuMessage(recipientId);\n                                    }\n                                );\n                            }\n                        );\n                    }\n                });\n            }\n        )\n    }\n}\n\nfunction renderAddressMenuMessage(recipientId){\n    var addresses = store.getState().addresses;\n    var quick_replies = [];\n\n    console.log(addresses);\n    console.log(addresses.length);\n\n    for(var address of addresses){\n        if(quick_replies.length <= bot.limit)\n        console.log(address);\n        quick_replies.push({\n            \"content_type\": \"text\",\n            \"title\": address.name,\n            \"payload\": \"SetAddress-\"+address.id //\"SetAddress-Office\"\n        });\n    }\n\n    quick_replies.push({\n        \"content_type\": \"text\",\n        \"title\": \"Nueva dirección\",\n        \"payload\": \"NewAddress\"\n    });\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A cual dirección vas hacer tu pedido?\\n\\nPuedes escoger entre tus direcciones guardadas o agregar una nueva dirección\",    //puedes escoger entre tus direcciones almacenadas o registrar una nueva\n            \"quick_replies\": quick_replies\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setAddress(recipientId, args){\n    bot.sendTypingOn(recipientId);\n    renderAddressConfirmation(recipientId)\n}\n\nfunction newAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Deseas escribir o compartir tu ubicación actual?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Escribir dirección\",\n                    \"payload\": \"WriteAddress\"\n                },\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Compartir ubicación\",\n                    \"payload\": \"SetLocation\"\n                }\n            ]\n        }\n    };\n    bot.callSendAPI(messageData);\n}\n\nfunction writeAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor escribe tu dirección actual. \\n\\nEjemplo: Calle 67 #52-20, Medellín\"\n        }\n    };\n    bot.listenData(recipientId, 'address', writeAddressCheck);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendMapMessage(recipientId, callback){\n    var userBuffer = bot.buffer[recipientId];\n\n    console.log('sendMapMessage')\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"text\": \"Encontré esta dirección en Google Maps:\\n\\n\"+userBuffer.address+\"\"\n        }\n    };\n\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction sendMap(recipientId, callback){\n    var userBuffer = bot.buffer[recipientId];\n\n    console.log('sendMap')\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"attachment\": {\n                \"type\": \"image\",\n                \"payload\": {\n                    \"url\": \"https://maps.googleapis.com/maps/api/staticmap?center=\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+userBuffer.location.lat+\",\"+userBuffer.location.lng\n                }\n            }\n        }\n    };\n\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction writeAddressCheck(recipientId){\n    bot.sendTypingOff(recipientId);\n    let userBuffer = bot.buffer[recipientId];\n    \n    geocoder.geocode(userBuffer.address, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            let result = data.results[0];\n\n            userBuffer.address = result.formatted_address;\n            userBuffer.location = result.geometry.location;\n\n            console.log(userBuffer)\n\n            sendMapMessage(recipientId, () => {\n                sendMap(recipientId, () => {\n                    var messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"text\": \"Es correcta?\",\n                            \"quick_replies\":[\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"Si\",\n                                    \"payload\": \"ConfirmAddress\"\n                                },\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"No\",\n                                    \"payload\": \"WriteAddress\"\n                                }\n                            ]\n                        }\n                    };\n                    bot.callSendAPI(messageData);\n                });\n            });\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n        }\n\n    });\n}\n\nfunction writeAddressComplete(recipientId){\n    let consumer = store.getState().consumer;\n    let userBuffer = bot.buffer[recipientId];\n\n    console.log(bot.buffer[recipientId]);\n\n    var location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n    var consumerAddress = new ParseModels.ConsumerAddress();\n    consumerAddress.set('name', userBuffer['address-name']);\n    consumerAddress.set('address', userBuffer.address);\n    consumerAddress.set('consumer', {\n        __type: \"Pointer\",\n        className: \"Consumer\",\n        objectId: consumer.rawParseObject.id\n    });\n    consumerAddress.set('location', location);\n\n    consumerAddress.save(undefined, {\n        success: function(result) {\n\n            delete userBuffer.address;\n            delete userBuffer.location;\n            delete userBuffer['address-name'];\n\n            console.log('Consumer Address');\n\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"La dirección ha sido almacenada.\"\n        }\n    };\n\n    bot.callSendAPI(messageData, sendAddressMenu );\n}\n\nfunction confirmAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n\n    let userBuffer = bot.buffer[recipientId];\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor coloca un nombre a esta dirección. \\n\\nEjemplo: casa, apartamento o oficina\"\n        }\n    };\n    bot.listenData(recipientId, 'address-name', writeAddressComplete);\n    bot.callSendAPI(messageData);\n}\n\nfunction setLocation(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor confirma el envio de tu dirección actual\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"location\"\n                }\n            ]\n        }\n    };\n    bot.callSendAPI(messageData);\n}\n\nfunction renderAddressConfirmation(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Perfecto, ya guardé tu dirección para próximos pedidos\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendCategories);\n}\n\nfunction renderCategoriesInitialMessage(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A continuación te presentamos las categorías de productos disponibles.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendCategories(recipientId, catIdx){\n    bot.sendTypingOn(recipientId);\n\n    if(catIdx == undefined)\n        catIdx = 0;\n    else if( typeof catIdx == 'string')\n        catIdx = parseInt(catIdx);\n\n    if(catIdx == 0){\n        renderCategoriesInitialMessage(recipientId)\n        bot.sendTypingOn(recipientId);\n    }\n\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID }).then(\n        function(result){\n\n            var elements = splitCategories(result.categories, catIdx);\n            var idx = Object.keys(result.categories).length;\n            var buttons = [];\n            var catIni = (catIdx+1)*bot.limit;\n            var catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n            /*\n            console.log('length: '+idx);\n            console.log('catIni: '+catIni);\n            console.log('catFin: '+catFin);\n            console.log('limit: '+(catIdx+1)*bot.limit);\n            */\n            if(idx > (catIdx+1)*bot.limit){\n                buttons.push({\n                    type: \"postback\",\n                    title: \"Categorias \"+(catIni+1)+\"-\"+catFin,\n                    payload: \"SendCategories-\"+(catIdx+1),\n                });\n\n                elements.push({\n                    title: \"Ver más categorias \",\n                    subtitle: \"Categorias disponibles\",\n                    buttons: buttons\n                });\n            }\n\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    attachment: {\n                        type: \"template\",\n                        payload: {\n                            template_type: \"generic\",\n                            elements: elements\n                        }\n                    }\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n\n        },\n        function(error) {\n\n        });\n}\n\nfunction splitCategories(categories, catIdx){\n    var idx = 0;\n    var elements = [];\n\n    categories.forEach(function(item){\n        //console.log(item.get('name'));\n        if(item && item.get('name')){\n            //console.log(elements.length);\n            if(idx >= (catIdx)*bot.limit && idx < (catIdx+1)*bot.limit){\n                var image = item.get('image');\n                var image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name'),\n                    //subtitle: item.get('name'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: item.get('name'),\n                        payload: \"SendProducts-\"+item.id+\"-\"+catIdx,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction renderProductsInitialMessage(recipientId, categoryId){\n    return new Parse.Query(ParseModels.Category).get(categoryId).then(\n        category => {\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    text: \"Tenemos los siguientes \"+category.get('name')+\":\"\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendProducts(recipientId, category, proIdx){\n    bot.sendTypingOn(recipientId);\n    proIdx = parseInt(proIdx);\n    if(proIdx == 0){\n        renderProductsInitialMessage(recipientId, category);\n        bot.sendTypingOn(recipientId);\n    }\n\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID, category: category }).then(function(result) {\n        var elements = splitProducts(result.products, proIdx);\n        var idx = Object.keys(result.products).length;\n        var buttons = [];\n        var catIni = (proIdx+1)*bot.limit;\n        var catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n        /*\n        console.log('length: '+idx);\n        console.log('catIni: '+catIni);\n        console.log('catFin: '+catFin);\n        console.log('limit: '+(proIdx+1)*bot.limit);\n        */\n        if( idx > (proIdx+1)*bot.limit ){\n            buttons.push({\n                type: \"postback\",\n                title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                payload: \"SendProducts-\"+category+\"-\"+(proIdx+1),\n            });\n\n            elements.push({\n                title: \"Ver más productos \",\n                subtitle: \"Productos disponibles\",\n                buttons: buttons\n            });\n        }\n\n        var messageData = {\n            recipient: {\n                id: recipientId\n            },\n            message: {\n                attachment: {\n                    type: \"template\",\n                    payload: {\n                        template_type: \"generic\",\n                        elements: elements\n                    }\n                }\n            }\n        };\n\n        bot.sendTypingOff(recipientId);\n        bot.callSendAPI(messageData);\n    },\n    function(error) {\n\n    })\n}\n\nfunction splitProducts(products, proIdx){\n    var idx = 0;\n    var elements = [];\n\n    products.forEach(function(item){\n        if(item && item.get('name')){\n            if(idx >= (proIdx)*bot.limit && idx < (proIdx+1)*bot.limit){\n                var image = item.get('image');\n                var image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name') +\": $\"+ item.get('priceDefault'),\n                    subtitle: item.get('description'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: \"Agregar\",\n                        payload: \"AddProduct-\"+item.id,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction addProduct(recipientId, productId){\n    //console.log(\"Add product: \"+productId);\n    //console.log(\"Order.count: \"+order.count());\n    if(!order.get(productId)){\n        order.set(productId, 1);\n    }\n    else{\n        order.set(productId, order.get(productId)+1);\n    }\n    renderAddProductConfirmation(recipientId, productId)\n}\n\nfunction renderAddProductConfirmation(recipientId, productId){\n    return new Parse.Query(ParseModels.Product).get(productId).then(\n        product => {\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"El producto \"+product.get('name')+\" ha sido agregado.\\n\\nDeseas agregar otro producto o terminar tu pedido?\",\n                    \"quick_replies\":[\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Seguir pidiendo\",\n                            \"payload\":\"SendCategories-0\"\n                        },\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Ver carrito\",\n                            \"payload\":\"SendShoppingCart\"\n                        }\n                    ]\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendPurchaseOptions(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Deseas agregar otro producto o terminar tu pedido?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Seguir pidiendo\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver carrito\",\n                    \"payload\":\"SendShoppingCart\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendShoppingCart(recipientId){\n    // Generate a random receipt ID as the API requires a unique ID\n    bot.sendTypingOn(recipientId);\n\n    var elements = [];\n    var element = {};\n    var total = 0;\n    var orderLimit = order.count();\n    var ind = 0;\n    var image;\n    var image_url;\n\n    console.log('Shopping Cart');\n\n    if(orderLimit == 0){\n        renderShoppingCartEmpty(recipientId)\n    }\n    else{\n        order.forEach(function(value, key){\n            var Product = Parse.Object.extend(\"Product\");\n            var product = new Parse.Query(Product);\n            //console.log(key);\n\n            product.get(key, {\n                success: function (item) {\n                    image = item.get('image');\n                    image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                    if(image){\n                        image_url = image.url();\n                    }\n\n                    element = {}\n                    element['title'] = item.get('name');\n                    element['subtitle'] = item.get('description');\n                    element['quantity'] = order.get(key);\n                    element['price'] = parseInt(item.get('priceDefault'));\n                    element['currency'] = \"COP\";\n                    element['image_url'] = image_url;\n\n                    elements.push(element);\n                    total += element['quantity']*element['price'];\n\n                    ind++;\n\n                    if(ind == orderLimit){\n                        renderShoppingCart(recipientId, elements, total)\n                    }\n                },\n                error: function (error) {\n                    alert(\"Error: \" + error.code + \" \" + error.message);\n                }\n            })\n        });\n    }\n\n}\n\nfunction renderShoppingCartEmpty(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu carrito de compras está vacío.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendPurchaseOptions);\n}\n\nfunction renderShoppingCart(recipientId, elements, total){\n    var receiptId = \"order\" + Math.floor(Math.random()*1000);\n\n    request({\n        uri: 'https://graph.facebook.com/v2.6/'+recipientId,\n        qs: { access_token: PAGE_ACCESS_TOKEN, fields: 'first_name,last_name,locale,timezone,gender' },\n        method: 'GET'\n\n    }, function (error, response, body) {\n        if (!error && response.statusCode == 200) {\n            var userData = JSON.parse(body);\n            //console.log(userData)\n\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message:{\n                    attachment: {\n                        type: \"template\",\n                        payload: {\n                            template_type: \"receipt\",\n                            recipient_name: userData.first_name+\" \"+userData.last_name,\n                            order_number: receiptId,\n                            currency: \"COP\",\n                            payment_method: \"Visa 1234\",\n                            timestamp: Math.trunc(Date.now()/1000).toString(),\n                            elements: elements,\n                            address: {\n                                street_1: \"Carrera x con calle x\",\n                                street_2: \"\",\n                                city: \"Medellin\",\n                                postal_code: \"680001\",\n                                state: \"SA\",\n                                country: \"CO\"\n                            },\n                            summary: {\n                                subtotal: total,\n                                shipping_cost: 2000.00,\n                                total_tax: total*0.16,\n                                total_cost: total*1.16+2000.00\n                            }\n                            //adjustments: [{\n                            //  name: \"New Customer Discount\",\n                            //  amount: -1000\n                            //}, {\n                            //    name: \"$1000 Off Coupon\",\n                            //    amount: -1000\n                            //}]\n                        }\n                    }\n                }\n            };\n            //order = new HashMap();\n            //console.log(\"callSendAPI(messageData)\");\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData, renderShoppingCartConfirmation);\n            //bot.sendTypingOn(recipientId);\n        }\n    });\n}\n\nfunction renderShoppingCartConfirmation(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Es correcto, deseas finalizar tu pedido?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Si\",\n                    \"payload\":\"Checkout\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"No\",\n                    \"payload\":\"SendPurchaseOptions\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction checkout(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    renderCheckout(recipientId)\n}\n\nfunction renderCheckout(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Como vas a pagar tu pedido? (Tu pedido se cobra cuando lo recibes)\",\n            \"quick_replies\":[\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Tarjeta Online\",\n                    \"payload\": \"CreditCard\"\n                },\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"PSE\",\n                    \"payload\": \"PSE\"\n                },\n                {\n                    \"content_type\": \"text\",\n                    \"title\": \"Efectivo\",\n                    \"payload\": \"Cash\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction checkCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    renderCreditCard(recipientId)\n}\n\nfunction renderCreditCard(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Aun no tienes tarjetas registradas, deseas registrar una tarjeta?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Si\",\n                    \"payload\":\"RegisterCreditCard\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"No\",\n                    \"payload\":\"Checkout\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction registerCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\":\"template\",\n                \"payload\":{\n                    \"template_type\": \"button\",\n                    \"text\": \"Por razones de seguidad te vamos a redireccionar a una página web segura para que agregues tu tarjeta y finalizaremos tu pedido.\\n\\nEstas de acuerdo?\",\n                    \"buttons\":[\n                        {\n                            \"type\":\"web_url\",\n                            \"url\":\"https://bot.inoutdelivery.com/\",\n                            \"title\":\"Si\",\n                            //\"payload\": 'confirmRegisterCreditCard'\n                        },\n                        {\n                            \"type\":\"postback\",\n                            \"title\":\"No\",\n                            \"payload\":\"CancelRegisterCreditCard\"\n                        }\n                    ]\n                }\n            }\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, confirmRegisterCreditCard);\n}\n\nfunction cancelRegisterCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Si no ingresas los datos de tu tarjeta en nuestro sitio seguro, no podras comprar con tarjeta online\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, checkout);\n}\n\nfunction confirmRegisterCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Con cual tarjeta quieres pagar?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"xxxx-xxxx-xxxx-9876\",\n                    \"payload\":\"PayWithCreditCard-9876\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Agregar tarjeta\",\n                    \"payload\":\"RegisterCreditCard\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction payWithCreditCard(recipientId, creditCardId){\n    bot.sendTypingOn(recipientId);\n\n    orderConfirmation(recipientId)\n}\n\nfunction orderConfirmation(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu pedido ha sido registrado. \\n\\n En un momento te estaremos dando información en tiempo real sobre tu pedido\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderState);\n}\n\nfunction orderState(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu pedido ha sido Aceptado. \\n\\n Lo estan preparando en nuestra sede y te lo enviaremos en aproximadamente 10 minutos\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderSent);\n}\n\nfunction orderSent(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Buenas noticias, Tu pedido ha sido Enviado. \\n\\n Haz click en el mapa para vel tu pedido\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, serviceRating);\n}\n\nfunction serviceRating(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Califica tu experiencia para ayudarnos a mejorar. \\n\\n De 1 a 5 cuantas extrellas merece nuestro servicio?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"5 (Excelente)\",\n                    \"payload\":\"SetRating-5\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"4 (Bien)\",\n                    \"payload\":\"SetRating-4\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"3 (Regular)\",\n                    \"payload\":\"SetRating-3\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Mal)\",\n                    \"payload\":\"SetRating-2\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Muy mal)\",\n                    \"payload\":\"SetRating-1\"\n                },\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setRating(recipientId, rating){\n    bot.sendTypingOn(recipientId);\n\n    thank(recipientId)\n}\n\nfunction thank(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Gracias, esperamos tener el gusto de atenderle nuevamente\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nstore.dispatch({type: types.APP_LOADED})\n\n/*\nconsole.log('Exist FB.init: '+( typeof FB.init === 'function') );\nconsole.log(FB.getLoginUrl({ scope: 'user_about_me' }));\n\n Parse.FacebookUtils.init({ // this line replaces FB.init({\n appId      : FACEBOOK_APP_ID, // Facebook App ID\n cookie     : true,  // enable cookies to allow Parse to access the session\n xfbml      : true,  // initialize Facebook social plugins on the page\n version    : 'v2.4' // point to the latest Facebook Graph API version\n });\n */\n\nvar order = new HashMap();\n"]}