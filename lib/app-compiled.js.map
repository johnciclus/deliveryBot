{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["import * as _ from 'underscore';\nimport * as bot from './bot';\nimport * as types from './constants/actionTypes';\nimport * as Actions from './actions/index';\nimport * as ParseModels from './ParseModels';\nimport { extractParseAttributes } from './ParseUtils';\nimport { createStore, applyMiddleware } from 'redux';\n\nimport utils from './utils';\nimport config from 'config';\nimport request from 'request';\nimport HashMap  from 'hashmap';\nimport objectAssign from 'object-assign';\nimport thunk from 'redux-thunk';\nimport FB from 'fb';\nimport geocoder from 'geocoder';\n\nconst APP_SECRET = (process.env.MESSENGER_APP_SECRET) ? process.env.MESSENGER_APP_SECRET : config.get('APP_SECRET');\n\nconst PAGE_ACCESS_TOKEN = (process.env.MESSENGER_PAGE_ACCESS_TOKEN) ? (process.env.MESSENGER_PAGE_ACCESS_TOKEN) : config.get('PAGE_ACCESS_TOKEN');\n\nconst PARSE_APP_ID = (process.env.PARSE_APP_ID) ? (process.env.PARSE_APP_ID) : config.get('PARSE_APP_ID');\n\nconst PARSE_SERVER_URL = (process.env.PARSE_SERVER_URL) ? (process.env.PARSE_SERVER_URL) : config.get('PARSE_SERVER_URL');\n\nconst PARSE_CLIENT_KEY = (process.env.PARSE_CLIENT_KEY) ? (process.env.PARSE_CLIENT_KEY) : config.get('PARSE_CLIENT_KEY');\n\nconst FACEBOOK_APP_ID = (process.env.FACEBOOK_APP_ID) ? (process.env.FACEBOOK_APP_ID) : config.get('FACEBOOK_APP_ID');\n\nconst REDIRECT_URI = (process.env.REDIRECT_URI) ? (process.env.REDIRECT_URI) : config.get('REDIRECT_URI');\n\nconst BUSINESS_ID = (process.env.BUSINESS_ID) ? (process.env.BUSINESS_ID) : config.get('BUSINESS_ID');\n\nconst GOOGLE_MAPS_KEY = (process.env.GOOGLE_MAPS_KEY) ? (process.env.GOOGLE_MAPS_KEY) : config.get('GOOGLE_MAPS_KEY');\n\nFB.options({\n    appId:          FACEBOOK_APP_ID,\n    appSecret:      APP_SECRET,\n    redirectUri:    REDIRECT_URI\n});\n\nbot.rules.set('hola', sendMenu);\nbot.rules.set('iniciar', sendMenu);\nbot.rules.set('empezar', sendMenu);\nbot.rules.set('comenzar', sendMenu);\nbot.rules.set('buenos dias', sendMenu);\nbot.rules.set('buenas tardes', sendMenu);\nbot.rules.set('pedir domicilio', sendAddressMenu);\nbot.rules.set('cuenta', sendShoppingCart);\n\nbot.payloadRules.set('Greeting', sendMenu);\nbot.payloadRules.set('SendAddressMenu', sendAddressMenu);\nbot.payloadRules.set('SetAddress', setAddress);\nbot.payloadRules.set('NewAddress', newAddress);\nbot.payloadRules.set('SetLocation', setLocation);\nbot.payloadRules.set('ConfirmAddress', confirmAddress);\nbot.payloadRules.set('SendCategories', sendCategories);\nbot.payloadRules.set('SendProducts', sendProducts);\nbot.payloadRules.set('AddProduct', addProduct);\nbot.payloadRules.set('Search', searchProducts);\nbot.payloadRules.set('SendShoppingCart', sendShoppingCart);\nbot.payloadRules.set('SendPurchaseOptions', sendPurchaseOptions);\nbot.payloadRules.set('Checkout', checkout);\nbot.payloadRules.set('CheckPayment', checkPayment);\nbot.payloadRules.set('RegisterCreditCard', registerCreditCard);\nbot.payloadRules.set('ConfirmRegisterCreditCard', confirmRegisterCreditCard);\nbot.payloadRules.set('CancelRegisterCreditCard', cancelRegisterCreditCard);\nbot.payloadRules.set('PayWithCreditCard', payWithCreditCard);\nbot.payloadRules.set('SetRating', setRating);\n//bot.payloadRules.set('WriteAddress', writeAddress);\n\nbot.defaultSearch = searchProducts;\n\nconst initialState = {\n    userData: {},\n\n\n    geocodedLocation: {lat: -1, lng: -1},\n    addresses: [],\n    mapBounds: {},\n    mapAddress: '',\n    useSubCategories: false,\n    products: [],\n    pointOfSales: [],\n    categories: [],\n    paymentMethods: [],\n    consumer: {},\n    customer: {},\n    orders: { ongoing: [], delivered: [] },\n    orderToRate: null,\n    currentOrder: {\n        consumerAddress:{},\n        items: []\n    },\n    locationZoom: 3,\n    profileIsOpen: false,\n    mapAddressIsOpen: false,\n    addressFormIsOpen: false,\n    addressListIsOpen: false,\n    savingAddress: false,\n    creatingOrder: false,\n    paymentMethodNotSelected: false,\n    cartTotalIsBelowMinimumPrice: false,\n    currentCategory: {},\n    consumerNotFound: false,\n    updatingConsumer: false,\n    currentUser: {},\n    pendingOrder: false\n};\n\nconst reducer = (state = initialState, action) => {\n    console.log('ACTION');\n    console.log(action);\n    var data = action.data;\n\n    if(data && data.hasOwnProperty('recipientId')){\n        if(typeof state.userData[data.recipientId] != 'object'){\n            state.userData[data.recipientId] = {};\n        }\n    }\n\n    switch (action.type) {\n        case types.APP_LOADED:\n            console.log('Application is running on port', bot.app.get('port'));\n            return {...state};\n\n        case types.CUSTOMER_LOADED:\n            let customer = extractParseAttributes(data.customer);\n\n            if(typeof state.userData[data.recipientId] != 'object'){\n                state.userData[data.recipientId] = {};\n            }\n            objectAssign(state.userData[data.recipientId], {customer});\n            return {...state};\n\n        case types.CONSUMER_LOADED:\n            //if (state.consumerNotFound) delete state.consumerNotFound;\n            let consumer = extractParseAttributes(data.consumer);\n            objectAssign(state.userData[data.recipientId], {consumer});\n            return {...state};\n\n        case types.CONSUMER_ADDRESSES_LOADED:\n            let addresses = data.addresses.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {addresses});\n            return {...state};\n\n        case types.SET_CURRENT_ADDRESS:\n            let address = extractParseAttributes(data.address);\n            objectAssign(state.userData[data.recipientId], {address});\n            return {...state};\n\n        case types.PAYMENT_METHODS_LOADED:\n            let paymentMethods = data.paymentMethods.map(p => extractParseAttributes(p))\n            objectAssign(state.userData[data.recipientId], {paymentMethods})\n            return {...state};\n        \n        case types.SET_PAYMENT_METHOD:\n            let paymentMethod = extractParseAttributes(data.paymentMethod);\n            objectAssign(state.userData[data.recipientId], {paymentMethod});\n            return {...state};\n            \n        case types.CONSUMER_UPDATED:\n            return {...state};\n\n        case types.CONSUMER_NOT_FOUND:\n            objectAssign(state, {\n                consumerNotFound: true,\n                currentUser: action.data.user\n            })\n            return {...state};\n\n        case types.CONSUMER_ORDERS_LOADED:\n            const orders = action.data\n            let ongoing = orders['ongoing'].map(o => extractParseAttributes(o))\n            let delivered = orders['delivered'].map(o => extractParseAttributes(o))\n            let orderToRate = delivered[0]\n            objectAssign(state, {\n                orders: {ongoing, delivered},\n                orderToRate\n            })\n            return {...state};\n\n\n        case types.RENDER_MENU:\n            /*\n            console.log('Store');\n            console.log('Consumer');\n            console.log(consumer);*/\n            renderMenu()\n\n            /*request({\n             uri: 'https://graph.facebook.com/v2.6/' + '1100195690052041',\n             qs: {access_token: PAGE_ACCESS_TOKEN, fields: 'first_name,last_name,locale,timezone,gender'},\n             method: 'GET'\n             }, renderMenuMessage);*/\n\n            return state;\n        case  types.RENDER_ADDRESS_MENU:\n\n            renderAddressMenu()\n\n            return state;\n\n\n        default:\n            return state;\n    }\n}\n\nconst store = createStore(reducer, applyMiddleware(thunk));\n\nstore.subscribe(() =>\n    console.log('\\n')\n);\n\n//global.FB = FB;\n\nfunction getData(recipientId, property){\n    if(recipientId !== undefined){\n        var data = store.getState().userData;\n        var userData = data[recipientId];\n\n        if(userData == undefined){\n            data[recipientId] = {};\n            userData = data[recipientId];\n        }\n\n        if(property == undefined)\n            return userData;\n        else{\n            if(userData.hasOwnProperty(property)){\n                return userData[property];\n            }\n            else\n                return undefined;\n        }\n    }\n}\n\nfunction authentication(recipientId, callback){\n    new Parse.Query(ParseModels.User).equalTo('facebookId', recipientId).first().then(user => {\n        if(user){\n            if(callback){\n                callback(user)\n            }\n        }else{\n            bot.getFacebookUser(recipientId, (userData) => {\n                signup(recipientId, userData, callback);\n            });\n        }\n    },\n    (object, error) => {\n        console.log(error);\n    })\n}\n\nfunction signup(facebookId, userData, callback){    //1100195690052041\n    if(userData){\n        var facebookUser = new ParseModels.User();\n        facebookUser.save(Object.assign(userData, {username: facebookId.toString(), password: facebookId.toString(), facebookId: facebookId}), {\n            success: function(user) {\n                var consumer = new ParseModels.Consumer();\n                consumer.set('name', user.get('first_name')+\" \"+user.get('last_name'));\n                consumer.set('user', {\n                    __type: \"Pointer\",\n                    className: \"_User\",\n                    objectId: user.id\n                });\n                consumer.save(undefined, {\n                    success: function(consumer) {\n                        sendRegisterFacebookUser(facebookId);\n                        callback(user);\n                    },\n                    error: function(user, error) {\n                        // Execute any logic that should take place if the save fails.\n                        // error is a Parse.Error with an error code and message.\n                        console.log('Failed to create new object, with error code: ' + error.message);\n                    }\n                });\n            },\n            error: function(user, error) {\n                // Execute any logic that should take place if the save fails.\n                // error is a Parse.Error with an error code and message.\n                console.log('Failed to create new object, with error code: ' + error.message);\n            }\n        });\n    }\n}\n\nfunction sendRegisterFacebookUser(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Registro exitoso.\",\n\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendMenu(recipientId) {\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, user => {\n        if(user){\n            store.dispatch(Actions.loadCustomer(recipientId, BUSINESS_ID)).then(\n                () => {\n                    store.dispatch(Actions.loadConsumer(recipientId, user)).then(\n                        () => {\n                            renderMenu(recipientId);\n                        }\n                    );\n                }\n            )\n        }\n        else{\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"Usuario no registrado en el sistema, informacion obtenida: first_name, last_name, locale, timezone, gender\"\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n\n        }\n    });\n}\n\nfunction renderMenu(recipientId) {\n    var customer = getData(recipientId, 'customer');\n    var consumer = getData(recipientId, 'consumer');\n\n    var image_url = customer.image.url;\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: \"template\",\n                payload: {\n                    template_type: \"generic\",\n                    //text: \"Buenos dias, para conocer nuestros menus del dia, por favor escoja una opción:\",\n                    elements: [{\n                        \"title\":     \"Hola \"+consumer.name+\", Bienvenido a OXXO. \",\n                        \"subtitle\":  \"Aquí puedes pedir un domicilio, escribe o selecciona alguna de las opciones:\",\n                        \"image_url\": image_url,\n                        \"buttons\":[\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir domicilio\",\n                                \"payload\": \"SendAddressMenu\"\n                            },\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir para recoger\",\n                                \"payload\": \"TakeOut\"\n                            },\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Servicio al cliente\",\n                                \"payload\": \"CustomerService\"\n                            }\n                        ]\n                    }]\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendAddressMenu(recipientId){\n    bot.sendTypingOn(recipientId);\n    var consumer = getData(recipientId, 'consumer');\n\n    if(!_.isEmpty(consumer)){\n        store.dispatch(Actions.loadConsumerAddresses(recipientId, consumer.rawParseObject)).then(\n            () => {\n                renderAddressMenu(recipientId);\n            }\n        );\n    }\n    else{\n        store.dispatch(Actions.loadCustomer(recipientId, BUSINESS_ID)).then(\n            () => {\n                authentication(recipientId, user => {\n                    if(user){\n                        store.dispatch(Actions.loadConsumer(recipientId, user)).then(\n                            () => {\n                                consumer = getData(recipientId, 'consumer');\n                                store.dispatch(Actions.loadConsumerAddresses(recipientId, consumer.rawParseObject)).then(\n                                    () => {\n                                        renderAddressMenu(recipientId);\n                                    }\n                                );\n                            }\n                        );\n                    }\n                });\n            }\n        )\n    }\n}\n\nfunction renderAddressMenu(recipientId){\n    var addresses = getData(recipientId, 'addresses');\n    var elements = [];\n\n    //\"title\": \"A cual dirección vas hacer tu pedido?\",\n    //\"subtitle\": \"Puedes escoger entre tus direcciones guardadas o agregar una nueva dirección\",\n\n    renderAddressMenuTitle(recipientId, () => {\n        elements.push({\n            \"title\": \"Nueva dirección\",\n            \"subtitle\": \"Puedes agregar una nueva dirección\",\n            \"buttons\": [\n                {\n                    \"type\": \"postback\",\n                    \"title\": \"Nueva dirección\",\n                    \"payload\": \"NewAddress\"\n                }\n            ]\n        });\n\n        for(var address of addresses) {\n            if (elements.length < bot.limit){\n                elements.push({\n                    \"title\": address.name.capitalizeFirstLetter(),\n                    \"subtitle\": address.address,\n                    \"image_url\": \"https://maps.googleapis.com/maps/api/staticmap?center=\"+address.location.lat+\",\"+address.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+address.location.lat+\",\"+address.location.lng+\"&key=\"+GOOGLE_MAPS_KEY,\n                    \"buttons\": [\n                        {\n                            \"type\": \"postback\",\n                            \"title\": address.name.capitalizeFirstLetter(),\n                            \"payload\": \"SetAddress-\"+address.objectId\n                        }\n                    ]\n                });\n            }\n        }\n\n        var messageData = {\n            recipient: {\n                id: recipientId\n            },\n            message: {\n                \"attachment\":{\n                    \"type\": \"template\",\n                    \"payload\":{\n                        \"template_type\": \"generic\",\n                        \"elements\": elements\n                    }\n                }\n            }\n        };\n\n        bot.callSendAPI(messageData);\n    });\n}\n\nfunction renderAddressMenuTitle(recipientId, callback){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A cual dirección vas hacer tu pedido?\\n\\nPuedes escoger entre tus direcciones guardadas o agregar una nueva dirección\"\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction setAddress(recipientId, id){\n    bot.sendTypingOn(recipientId);\n\n    store.dispatch(Actions.setAddress(recipientId, id)).then(\n        () => {\n            renderAddressConfirmation(recipientId)\n        }\n    );\n}\n\nfunction newAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Puedes escribir o compartir tu ubicación actual?\\n\\nEjemplo: Calle 67 #52-20, Medellín\",\n            \"quick_replies\":[\n                /*{\n                    \"content_type\": \"text\",\n                    \"title\": \"Escribir dirección\",\n                    \"payload\": \"WriteAddress\"\n                },*/\n                {\n                    \"content_type\": \"location\"\n                }\n            ]\n        }\n    };\n    /*\n    {\n        \"content_type\": \"text\",\n        \"title\": \"Compartir ubicación\",\n        \"payload\": \"SetLocation\"\n    },*/\n\n    bot.setListener(recipientId, 'address', 'text', writeAddressCheck);\n    bot.setListener(recipientId, 'location', 'attachment', setLocationCheck);\n    bot.callSendAPI(messageData);\n}\n\nfunction writeAddressComplement(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor escribe el complemento de tu dirección actual. \\n\\nEjemplo: Oficina 1068\"\n        }\n    };\n\n    bot.setListener(recipientId, 'complement', writeAddressComplete);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendMapMessage(recipientId, callback){\n    var userBuffer = bot.buffer[recipientId];\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"text\": \"Encontré esta dirección en Google Maps:\\n\\n\"+userBuffer.address+\"\"\n        }\n    };\n\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction sendMap(recipientId, callback){\n    var userBuffer = bot.buffer[recipientId];\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"attachment\": {\n                \"type\": \"image\",\n                \"payload\": {\n                    \"url\": \"https://maps.googleapis.com/maps/api/staticmap?center=\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&key=\"+GOOGLE_MAPS_KEY\n                }\n            }\n        }\n    };\n\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction writeAddressCheck(recipientId){\n    bot.sendTypingOff(recipientId);\n    let userBuffer = bot.buffer[recipientId];\n    \n    geocoder.geocode(userBuffer.address, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            let result = data.results[0];\n\n            userBuffer.address = result.formatted_address;\n            userBuffer.location = result.geometry.location;\n\n            for(var component of result.address_components){\n                if(component.types.includes('locality')){\n                    userBuffer.locality = component.short_name;\n                }\n                else if(component.types.includes('administrative_area_level_1')){\n                    userBuffer.state = component.short_name;\n                }\n                else if(component.types.includes('administrative_area_level_2')){\n                    userBuffer.administrative_area = component.short_name;\n                }\n                else if(component.types.includes('country')){\n                    userBuffer.country = component.short_name;\n                }\n                else if(component.types.includes('postal_code')){\n                    userBuffer.postal_code = component.short_name;\n                }\n            }\n\n            sendMapMessage(recipientId, () => {\n                sendMap(recipientId, () => {\n                    var messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"text\": \"Es correcta?\",\n                            \"quick_replies\":[\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"Si\",\n                                    \"payload\": \"ConfirmAddress\"\n                                },\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"No\",\n                                    \"payload\": \"NewAddress\"\n                                }\n                            ]\n                        }\n                    };\n                    bot.callSendAPI(messageData);\n                });\n            });\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n        }\n\n    });\n}\n\nfunction writeAddressComplete(recipientId){\n    let consumer = getData(recipientId, 'consumer');\n    let userBuffer = bot.buffer[recipientId];\n\n    var location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n    var consumerAddress = new ParseModels.ConsumerAddress();\n    consumerAddress.set('name', userBuffer['address-name']);\n    consumerAddress.set('address', userBuffer.address);\n    consumerAddress.set('consumer', {\n        __type: \"Pointer\",\n        className: \"Consumer\",\n        objectId: consumer.objectId\n    });\n    consumerAddress.set('location', location);\n    consumerAddress.set('city', userBuffer.locality);\n    consumerAddress.set('countryCode', userBuffer.country);\n    consumerAddress.set('postalCode', userBuffer.postal_code);\n    consumerAddress.set('state', userBuffer.state);\n\n    consumerAddress.save(undefined, {\n        success: function(result) {\n\n            delete userBuffer.address;\n            delete userBuffer.location;\n            delete userBuffer['address-name'];\n\n            console.log(userBuffer);\n\n            console.log('Consumer Address');\n\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"La dirección ha sido almacenada.\"\n        }\n    };\n\n    bot.callSendAPI(messageData, sendAddressMenu );\n}\n\nfunction confirmAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n\n    let userBuffer = bot.buffer[recipientId];\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor coloca un nombre a esta dirección. \\n\\nEjemplo: casa, apartamento o oficina\"\n        }\n    };\n    bot.setListener(recipientId, 'address-name', 'text', writeAddressComplete);\n    bot.callSendAPI(messageData);\n}\n\nfunction setLocation(recipientId){\n    bot.sendTypingOff(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor confirma el envio de tu dirección actual\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"location\"\n                }\n            ]\n        }\n    };\n    bot.setListener(recipientId, 'location', 'text', setLocationCheck);\n    bot.callSendAPI(messageData);\n}\n\nfunction setLocationCheck(recipientId){\n    bot.sendTypingOff(recipientId);\n    let userBuffer = bot.buffer[recipientId];\n\n    geocoder.reverseGeocode( userBuffer.location.lat, userBuffer.location.lng, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            let result = data.results[0];\n\n            userBuffer.address = result.formatted_address;\n            userBuffer.location = result.geometry.location;\n\n            for(var component of result.address_components){\n                console.log(component);\n                if(component.types.includes('locality')){\n                    userBuffer.locality = component.short_name;\n                }\n                else if(component.types.includes('administrative_area_level_1')){\n                    userBuffer.state = component.short_name;\n                }\n                else if(component.types.includes('administrative_area_level_2')){\n                    userBuffer.administrative_area = component.short_name;\n                }\n                else if(component.types.includes('country')){\n                    userBuffer.country = component.short_name;\n                }\n                else if(component.types.includes('postal_code')){\n                    userBuffer.postal_code = component.short_name;\n                }\n            }\n\n            sendMapMessage(recipientId, () => {\n                sendMap(recipientId, () => {\n                    var messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"text\": \"Es correcta?\",\n                            \"quick_replies\":[\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"Si\",\n                                    \"payload\": \"ConfirmAddress\"\n                                },\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"No\",\n                                    \"payload\": \"newAddress\"\n                                }\n                            ]\n                        }\n                    };\n                    bot.callSendAPI(messageData);\n                });\n            });\n        }\n        else{\n            console.log('Geocode not found');\n        }\n    })\n\n    /*\n    geocoder.geocode(userBuffer.address, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            let result = data.results[0];\n\n            userBuffer.address = result.formatted_address;\n            userBuffer.location = result.geometry.location;\n\n            console.log(userBuffer)\n\n            sendMapMessage(recipientId, () => {\n                sendMap(recipientId, () => {\n                    var messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"text\": \"Es correcta?\",\n                            \"quick_replies\":[\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"Si\",\n                                    \"payload\": \"ConfirmAddress\"\n                                },\n                                {\n                                    \"content_type\": \"text\",\n                                    \"title\": \"No\",\n                                    \"payload\": \"WriteAddress\"\n                                }\n                            ]\n                        }\n                    };\n                    bot.callSendAPI(messageData);\n                });\n            });\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n        }\n\n    });\n    */\n}\n\nfunction renderAddressConfirmation(recipientId){\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Perfecto, ya seleccioné tu dirección para este pedido\" //Perfecto, ya guardé tu dirección para próximos pedidos\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendCategories);\n}\n\nfunction renderCategoriesInitialMessage(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A continuación te presentamos las categorías de productos disponibles.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendCategories(recipientId, index){\n    bot.sendTypingOn(recipientId);\n\n    if(index == undefined)\n        index = 0;\n    else if( typeof index == 'string')\n        index = parseInt(index);\n\n    if(index == 0){\n        renderCategoriesInitialMessage(recipientId)\n        bot.sendTypingOn(recipientId);\n    }\n\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID }).then(\n        function(result){\n            var elements = splitCategories(result.categories, index);\n            var idx = Object.keys(result.categories).length;\n            var buttons = [];\n            var catIni = (index+1)*bot.limit;\n            var catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n            /*\n            console.log('length: '+idx);\n            console.log('catIni: '+catIni);\n            console.log('catFin: '+catFin);\n            console.log('limitsearchProducts: '+(index+1)*bot.limit);\n            */\n            if(idx > (index+1)*bot.limit){\n                buttons.push({\n                    type: \"postback\",\n                    title: \"Categorías \"+(catIni+1)+\"-\"+catFin,\n                    payload: \"SendCategories-\"+(index+1),\n                });\n\n                elements.push({\n                    title: \"Ver más categorias \",\n                    subtitle: \"Categorías disponibles\",\n                    buttons: buttons\n                });\n            }\n\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    attachment: {\n                        type: \"template\",\n                        payload: {\n                            template_type: \"generic\",\n                            elements: elements\n                        }\n                    }\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n\n        },\n        function(error) {\n\n        });\n}\n\nfunction splitCategories(categories, index){\n    var idx = 0;\n    var elements = [];\n\n    categories.forEach(function(item){\n        //console.log(item.get('name'));\n        if(item && item.get('name')){\n            //console.log(elements.length);\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                var image = item.get('image');\n                var image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name'),\n                    //subtitle: item.get('name'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: item.get('name'),\n                        payload: \"SendProducts-\"+item.id+\"-\"+index,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction renderProductsInitialMessage(recipientId, categoryId){\n    return new Parse.Query(ParseModels.Category).get(categoryId).then(\n        category => {\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    text: \"Tenemos los siguientes \"+category.get('name')+\":\"\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendProducts(recipientId, category, proIdx){\n    bot.sendTypingOn(recipientId);\n    proIdx = parseInt(proIdx);\n    if(proIdx == 0){\n        renderProductsInitialMessage(recipientId, category);\n        bot.sendTypingOn(recipientId);\n    }\n\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID, category: category }).then(function(result) {\n        var elements = splitProducts(result.products, proIdx);\n        var idx = Object.keys(result.products).length;\n        var buttons = [];\n        var catIni = (proIdx+1)*bot.limit;\n        var catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n        /*\n        console.log('length: '+idx);\n        console.log('catIni: '+catIni);\n        console.log('catFin: '+catFin);\n        console.log('limit: '+(proIdx+1)*bot.limit);\n        */\n        if( idx > (proIdx+1)*bot.limit ){\n            buttons.push({\n                type: \"postback\",\n                title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                payload: \"SendProducts-\"+category+\"-\"+(proIdx+1),\n            });\n\n            elements.push({\n                title: \"Ver más productos \",\n                subtitle: \"Productos disponibles\",\n                buttons: buttons\n            });\n        }\n\n        var messageData = {\n            recipient: {\n                id: recipientId\n            },\n            message: {\n                attachment: {\n                    type: \"template\",\n                    payload: {\n                        template_type: \"generic\",\n                        elements: elements\n                    }\n                }\n            }\n        };\n\n        bot.sendTypingOff(recipientId);\n        bot.callSendAPI(messageData);\n    },\n    function(error) {\n\n    })\n}\n\nfunction splitProducts(products, proIdx){\n    var idx = 0;\n    var elements = [];\n\n    products.forEach(function(item){\n        if(item && item.get('name')){\n            if(idx >= (proIdx)*bot.limit && idx < (proIdx+1)*bot.limit){\n                var image = item.get('image');\n                var image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name') +\": $\"+ item.get('priceDefault'),\n                    subtitle: item.get('description'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: \"Agregar\",\n                        payload: \"AddProduct-\"+item.id,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction createCart(recipientId){\n    var userData = getData(recipientId);\n    Object.assign(userData, {'cart': {items: new Map()}});\n    return userData.cart;\n\n}\n\nfunction createOrder(recipientId){\n    var userData = getData(recipientId);\n    Object.assign(userData, {'order': new Map()});\n    return getData(recipientId, 'order')\n}\n\nfunction addProduct(recipientId, productId){\n    //console.log(\"Add product: \"+productId);\n    //console.log(\"Order.count: \"+order.count());\n    var product = new ParseModels.Product();\n    var userData = getData(recipientId);\n    var cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    var items = cart.items;\n\n    new Parse.Query(product).get(productId).then(\n        product => {\n            if(!items.get(productId)){\n                items.set(productId, {quantity: 1, price: product.get('priceDefault')});\n            }\n            else{\n                items.get(productId).quantity += 1;\n            }\n\n            saveCart(recipientId);\n\n            renderAddProductConfirmation(recipientId, productId);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    );\n}\n\nfunction saveCart(recipientId){\n    var consumerCart = new ParseModels.Cart();\n    var consumer = getData(recipientId, 'consumer');\n    var address = getData(recipientId, 'address');\n    var cart = getData(recipientId, 'cart');\n    var paymentMethod = getData(recipientId, 'paymentMethod');\n    var item;\n\n    for(var [id, properties] of cart.items){\n        console.log('\\n'+id);\n        console.log(properties);\n\n        item = new ParseModels.OrderItem();\n\n        if(properties.hasOwnProperty('id')){\n            item.set('id', properties.id);\n        }\n\n        item.set('product', {\n            __type: \"Pointer\",\n            className: \"Product\",\n            objectId: id\n        });\n        item.set('price', properties.price);\n        item.set('amount', properties.quantity);\n        item.set('modifiersGroups', []);\n\n        item.save(undefined, {\n            success: function(result) {\n                //console.log('\\nItem save');\n                //console.log(result);\n                //console.log(result.get('product'));\n                var itemId = result.get('product').objectId;\n                //console.log(cart.items.get(itemId));\n                cart.items.get(itemId).id = result.id;\n                //console.log(cart.items.get(itemId));\n            },\n            error: function(user, error) {\n                // Execute any logic that should take place if the save fails.\n                // error is a Parse.Error with an error code and message.\n                console.log('Failed to create new object, with error code: ' + error.message);\n            }\n        });\n    }\n\n    //Parse.Object.saveAll\n\n    if(cart.hasOwnProperty('id')){\n        consumerCart.set('id', cart.id);\n    }\n\n    if(typeof paymentMethod != 'undefined'){\n        consumerCart.set('paymentMethod', paymentMethod.method)\n    }\n\n    consumerCart.set('consumerAddress', {\n        __type: \"Pointer\",\n        className: \"ConsumerAddress\",\n        objectId: address.objectId\n    });\n    consumerCart.set('consumer', {\n        __type: \"Pointer\",\n        className: \"Consumer\",\n        objectId: consumer.objectId\n    });\n    //consumerCart.set('items', cart);\n    //consumerCart.set('paymentMethod', );\n\n    consumerCart.save(undefined, {\n        success: function(result) {\n            /*delete userBuffer.address;\n             delete userBuffer.location;\n             delete userBuffer['address-name'];\n\n             console.log(userBuffer);\n             */\n\n            console.log('\\nConsumer kart');\n            console.log(result);\n\n            cart['id'] = result.id;\n            cart['rawParseObject'] = result;\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n}\n\nfunction updateCart(recipientId){\n    var consumerCart = new ParseModels.Cart();\n    var localCart = getData(recipientId, 'cart');\n\n\n    new Parse.Query(consumerCart).get(localCart.id).then(\n        cart => {\n            console.log('updateCart');\n            console.log(cart);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    );\n}\n\nfunction renderAddProductConfirmation(recipientId, productId){\n    return new Parse.Query(ParseModels.Product).get(productId).then(\n        product => {\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"El producto \"+product.get('name')+\" ha sido agregado.\\n\\nDeseas agregar otro producto o terminar tu pedido?\",\n                    \"quick_replies\":[\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Seguir pidiendo\",\n                            \"payload\":\"SendCategories-0\"\n                        },\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Ver carrito\",\n                            \"payload\":\"SendShoppingCart\"\n                        }\n                    ]\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendPurchaseOptions(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Deseas agregar otro producto o terminar tu pedido?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Seguir pidiendo\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver carrito\",\n                    \"payload\":\"SendShoppingCart\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendShoppingCart(recipientId){\n    // Generate a random receipt ID as the API requires a unique ID\n    var Product = Parse.Object.extend(\"Product\");\n    var userData = getData(recipientId);\n    var consumer = getData(recipientId, 'consumer');\n    var cart = getData(recipientId, 'cart');\n    var address = getData(recipientId, 'address');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    var items = cart.items;\n\n    bot.sendTypingOn(recipientId);\n\n    var elements = [];\n    var element = {};\n    var total = 0;\n    var orderLimit = items.size;\n    var ind = 0;\n    var image;\n    var image_url;\n\n    console.log('Shopping Cart');\n    console.log(orderLimit);\n\n    if(address == undefined){\n        sendAddressMenu(recipientId)\n    }\n    else if(orderLimit == 0){\n        renderShoppingCartEmpty(recipientId)\n    }\n    else{\n        items.forEach(function(value, key){\n            var product = new Parse.Query(Product);\n\n            product.get(key, {\n                success: function (item) {\n                    image = item.get('image');\n                    image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                    if(image){\n                        image_url = image.url();\n                    }\n\n                    element = {};\n                    element['title'] = item.get('name');\n                    element['subtitle'] = item.get('description');\n                    element['quantity'] = value.quantity;\n                    element['price'] = parseInt(item.get('priceDefault'));\n                    element['currency'] = \"COP\";\n                    element['image_url'] = image_url;\n\n                    elements.push(element);\n                    total += element['quantity']*element['price'];\n\n                    ind++;\n\n                    if(ind == orderLimit){\n                        renderShoppingCart(recipientId, elements, total)\n                    }\n                },\n                error: function (error) {\n                    alert(\"Error: \" + error.code + \" \" + error.message);\n                }\n            })\n        });\n    }\n\n}\n\nfunction renderShoppingCartEmpty(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu carrito de compras está vacío.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendPurchaseOptions);\n}\n\nfunction renderShoppingCart(recipientId, elements, total){\n    var receiptId = \"rder\" + Math.floor(Math.random()*1000);\n    var address = getData(recipientId, 'address');\n    var payment_method = getData(recipientId, 'payment_method')\n\n    if(payment_method == undefined){\n        payment_method = {name: 'Sin definir'}\n    }\n\n    authentication(recipientId, (user)=>{\n        if(user){\n            var messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message:{\n                    attachment: {\n                        type: \"template\",\n                        payload: {\n                            template_type: \"receipt\",\n                            recipient_name: user.get('first_name')+\" \"+user.get('last_name'),\n                            order_number: receiptId,\n                            currency: \"COP\",\n                            payment_method: payment_method.name,\n                            timestamp: Math.trunc(Date.now()/1000).toString(),\n                            elements: elements,\n                            address: {\n                                street_1: address.address,\n                                street_2: \"\",\n                                city: address.city,\n                                postal_code: address.postalCode,\n                                state: address.state,\n                                country: address.countryCode\n                            },\n                            summary: {\n                                subtotal: total,\n                                shipping_cost: 2000.00,\n                                total_tax: total*0.16,\n                                total_cost: total*1.16+2000.00\n                            }\n                            //adjustments: [{\n                            //  name: \"New Customer Discount\",\n                            //  amount: -1000\n                            //}, {\n                            //    name: \"$1000 Off Coupon\",\n                            //    amount: -1000\n                            //}]\n                        }\n                    }\n                }\n            };\n            //console.log(\"callSendAPI(messageData)\");\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData, renderShoppingCartConfirmation);\n        }\n    });\n}\n\nfunction renderShoppingCartConfirmation(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Es correcto, deseas finalizar tu pedido?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Si\",\n                    \"payload\":\"CheckPayment\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"No\",\n                    \"payload\":\"SendPurchaseOptions\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction checkPayment (recipientId){\n    bot.sendTypingOn(recipientId);\n    //ParseModels.PaymentMethod\n    store.dispatch(Actions.loadPaymentMethods(recipientId)).then(() => {\n\n        renderCheckPayment(recipientId)\n    });\n}\n\nfunction renderCheckPayment(recipientId){\n    var paymentMethods = getData(recipientId, 'paymentMethods');\n    var quick_replies = [];\n\n    //console.log(paymentMethods);\n\n    for(var i in paymentMethods){\n\n        quick_replies.push({\n            \"content_type\": \"text\",\n            \"title\": paymentMethods[i].name,\n            \"payload\": \"Checkout-\"+paymentMethods[i].objectId\n        });\n    }\n\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Como vas a pagar tu pedido? (Tu pedido se cobra cuando lo recibes)\",\n            \"quick_replies\": quick_replies\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction checkout(recipientId, id){\n    bot.sendTypingOn(recipientId);\n\n    store.dispatch(Actions.setPaymentMethod(recipientId, id)).then(\n        () => {\n\n            let paymentMethod = getData(recipientId, 'paymentMethod')\n            var paymentFunction = paymentTypes.get(paymentMethod.method.objectId);\n            paymentFunction(recipientId);\n            /*\n            var cart = new ParseModels.Order();\n            cart.set('name', userBuffer['address-name']);\n            cart.set('address', userBuffer.address);\n            cart.set('consumer', {\n                __type: \"Pointer\",\n                className: \"Consumer\",\n                objectId: consumer.objectId\n            });\n\n\n            cart.save(undefined, {\n                success: function(result) {\n\n                    delete userBuffer.address;\n                    delete userBuffer.location;\n                    delete userBuffer['address-name'];\n\n                    console.log(userBuffer);\n\n                    console.log('Consumer Address');\n\n                },\n                error: function(user, error) {\n                    // Execute any logic that should take place if the save fails.\n                    // error is a Parse.Error with an error code and message.\n                    console.log('Failed to create new object, with error code: ' + error.message);\n                }\n            });\n            */\n        }\n    );\n}\n\nfunction setPayment(recipientId, id){\n\n}\n\nfunction renderCash(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Se ha registrado el pago en efectivo\"\n        }\n    };\n\n    saveCart(recipientId);\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderConfirmation);\n}\n\nfunction renderCreditCard(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Aun no tienes tarjetas registradas, deseas registrar una tarjeta?\",\n            \"quick_replies\": [\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Si\",\n                    \"payload\":\"RegisterCreditCard\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"No\",\n                    \"payload\":\"CheckPayment\"\n                }\n            ]\n        }\n    };\n\n    saveCart(recipientId);\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction registerCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\":\"template\",\n                \"payload\":{\n                    \"template_type\": \"button\",\n                    \"text\": \"Por razones de seguidad te vamos a redireccionar a una página web segura para que agregues tu tarjeta y finalizaremos tu pedido.\\n\\nEstas de acuerdo?\",\n                    \"buttons\":[\n                        {\n                            \"type\":\"web_url\",\n                            \"url\":\"https://bot.inoutdelivery.com/creditcard\",\n                            \"title\":\"Si\",\n                            //\"payload\": 'confirmRegisterCreditCard'\n                        },\n                        {\n                            \"type\":\"postback\",\n                            \"title\":\"No\",\n                            \"payload\":\"CancelRegisterCreditCard\"\n                        }\n                    ]\n                }\n            }\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, confirmRegisterCreditCard);\n}\n\nfunction cancelRegisterCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Si no ingresas los datos de tu tarjeta en nuestro sitio seguro, no podras comprar con tarjeta online\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, checkout);\n}\n\nfunction confirmRegisterCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Con cual tarjeta quieres pagar?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"xxxx-xxxx-xxxx-9876\",\n                    \"payload\":\"PayWithCreditCard-9876\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Agregar tarjeta\",\n                    \"payload\":\"RegisterCreditCard\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction payWithCreditCard(recipientId, creditCardId){\n    bot.sendTypingOn(recipientId);\n    console.log(creditCardId);\n    orderConfirmation(recipientId)\n}\n\nfunction orderConfirmation(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu pedido ha sido registrado. \\n\\n En un momento te estaremos dando información en tiempo real sobre tu pedido\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderState);\n}\n\nfunction orderState(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu pedido ha sido Aceptado. \\n\\n Lo estan preparando en nuestra sede y te lo enviaremos en aproximadamente 10 minutos\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderSent);\n}\n\nfunction orderSent(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Buenas noticias, Tu pedido ha sido Enviado. \\n\\n Haz click en el mapa para vel tu pedido\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, serviceRating);\n}\n\nfunction serviceRating(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Califica tu experiencia para ayudarnos a mejorar. \\n\\n De 1 a 5 cuantas extrellas merece nuestro servicio?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"5 (Excelente)\",\n                    \"payload\":\"SetRating-5\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"4 (Bien)\",\n                    \"payload\":\"SetRating-4\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"3 (Regular)\",\n                    \"payload\":\"SetRating-3\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Mal)\",\n                    \"payload\":\"SetRating-2\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Muy mal)\",\n                    \"payload\":\"SetRating-1\"\n                },\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setRating(recipientId, rating){\n    bot.sendTypingOn(recipientId);\n\n    thank(recipientId)\n}\n\nfunction thank(recipientId){\n    bot.sendTypingOn(recipientId);\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Gracias, esperamos tener el gusto de atenderle nuevamente\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction searchProducts(recipientId, query, index){\n    bot.sendTypingOn(recipientId);\n\n    Parse.Cloud.run('search', { businessId: BUSINESS_ID, q: query }).then(\n        function(result){\n            if(result.length == 0){\n                renderSearchEmpty(recipientId);\n            }\n            else{\n                if(index == undefined)\n                    index = 0;\n                else if( typeof index == 'string')\n                    index = parseInt(index);\n\n                if(index == 0){\n                    renderSearchInitial(recipientId);\n                    bot.sendTypingOn(recipientId);\n                }\n\n                var elements = splitSearchResult(result, index);\n                var idx = Object.keys(result).length;\n                var buttons = [];\n                var catIni = (index+1)*bot.limit;\n                var catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n\n                if(idx > (index+1)*bot.limit){\n                    buttons.push({\n                        type: \"postback\",\n                        title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                        payload: \"Search-\"+(index+1),\n                    });\n\n                    elements.push({\n                        title: \"Ver más productos \",\n                        subtitle: \"Productos disponibles\",\n                        buttons: buttons\n                    });\n                }\n\n                var messageData = {\n                    recipient: {\n                        id: recipientId\n                    },\n                    message: {\n                        attachment: {\n                            type: \"template\",\n                            payload: {\n                                template_type: \"generic\",\n                                elements: elements\n                            }\n                        }\n                    }\n                };\n\n                bot.sendTypingOff(recipientId);\n                bot.callSendAPI(messageData);\n            }\n        },\n        function(error) {\n            console.log('error');\n            console.log(error);\n        }\n    );\n}\n\nfunction renderSearchInitial(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Se han encontrado los siguientes productos:\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction renderSearchEmpty(recipientId){\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"No se han encontrado productos que coincidan\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction splitSearchResult(products, index){\n    var idx = 0;\n    var elements = [];\n\n    /*\n    for(var key in products){\n        console.log(products[key])\n    }\n    */\n\n    products.forEach(function(item){\n        if(item && item.name && item.type == 'Product'){\n            //item.id get Product information\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                var image = item.image;\n                var image_url = \"http://pro.parse.inoutdelivery.com/parse/files/hSMaiK7EXqDqRVYyY2fjIp4lBweiZnjpEmhH4LpJ/2671158f9c1cb43cac1423101b6e451b_image.txt\"\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.name,\n                    //subtitle: item.get('name'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: 'Agregar',\n                        payload: \"AddProduct-\"+item.id,\n                    }]\n                });\n                idx = idx+1;\n            }\n        }\n    });\n    return elements;\n}\n\nvar paymentTypes = new Map();\n\npaymentTypes.set('Nn0joKC5VK', renderCash);\n\npaymentTypes.set('UdK0Ifc4IF', renderCreditCard);\n\nstore.dispatch({type: types.APP_LOADED})\n\n/*\nconsole.log('Exist FB.init: '+( typeof FB.init === 'function') );\nconsole.log(FB.getLoginUrl({ scope: 'user_about_me' }));\n\n Parse.FacebookUtils.init({ // this line replaces FB.init({\n appId      : FACEBOOK_APP_ID, // Facebook App ID\n cookie     : true,  // enable cookies to allow Parse to access the session\n xfbml      : true,  // initialize Facebook social plugins on the page\n version    : 'v2.4' // point to the latest Facebook Graph API version\n });\n */"]}