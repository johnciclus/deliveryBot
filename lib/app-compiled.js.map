{"version":3,"sources":["app.js"],"names":[],"mappings":"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","file":"app-compiled.js","sourcesContent":["import * as _ from 'underscore';\nimport * as bot from './bot';\nimport * as types from './constants/actionTypes';\nimport * as Actions from './actions/index';\nimport * as ParseModels from './models/ParseModels';\nimport { extractParseAttributes } from './ParseUtils';\nimport { createStore, applyMiddleware } from 'redux';\n\nimport utils from './utils';\nimport config from 'config';\nimport request from 'request';\nimport HashMap  from 'hashmap';\nimport objectAssign from 'object-assign';\nimport thunk from 'redux-thunk';\nimport FB from 'fb';\nimport geocoder from 'geocoder';\nimport path from 'path';\nimport DateTime from 'datetime-converter-nodejs';\nimport dateFormat from 'dateformat'\n\nconst APP_SECRET = (process.env.MESSENGER_APP_SECRET) ? process.env.MESSENGER_APP_SECRET : config.get('APP_SECRET');\n\nconst PAGE_ACCESS_TOKEN = (process.env.MESSENGER_PAGE_ACCESS_TOKEN) ? (process.env.MESSENGER_PAGE_ACCESS_TOKEN) : config.get('PAGE_ACCESS_TOKEN');\n\nconst SERVER_URL = (process.env.SERVER_URL) ? (process.env.SERVER_URL) : config.get('SERVER_URL');\n\nconst PARSE_APP_ID = (process.env.PARSE_APP_ID) ? (process.env.PARSE_APP_ID) : config.get('PARSE_APP_ID');\n\nconst PARSE_SERVER_URL = (process.env.PARSE_SERVER_URL) ? (process.env.PARSE_SERVER_URL) : config.get('PARSE_SERVER_URL');\n\nconst PARSE_CLIENT_KEY = (process.env.PARSE_CLIENT_KEY) ? (process.env.PARSE_CLIENT_KEY) : config.get('PARSE_CLIENT_KEY');\n\nconst FACEBOOK_APP_ID = (process.env.FACEBOOK_APP_ID) ? (process.env.FACEBOOK_APP_ID) : config.get('FACEBOOK_APP_ID');\n\nconst REDIRECT_URI = (process.env.REDIRECT_URI) ? (process.env.REDIRECT_URI) : config.get('REDIRECT_URI');\n\nconst BUSINESS_ID = (process.env.BUSINESS_ID) ? (process.env.BUSINESS_ID) : config.get('BUSINESS_ID');\n\nconst GOOGLE_MAPS_URL = (process.env.GOOGLE_MAPS_URL) ? (process.env.GOOGLE_MAPS_URL) : config.get('GOOGLE_MAPS_URL');\n\nconst GOOGLE_MAPS_KEY = (process.env.GOOGLE_MAPS_KEY) ? (process.env.GOOGLE_MAPS_KEY) : config.get('GOOGLE_MAPS_KEY');\n\nFB.options({\n    appId:          FACEBOOK_APP_ID,\n    appSecret:      APP_SECRET,\n    redirectUri:    REDIRECT_URI\n});\n\nbot.rules.set('hola', sendMenu);\nbot.rules.set('iniciar', sendMenu);\nbot.rules.set('empezar', sendMenu);\nbot.rules.set('comenzar', sendMenu);\nbot.rules.set('buenos dias', sendMenu);\nbot.rules.set('buenas tardes', sendMenu);\nbot.rules.set('pedir domicilio', sendAddressesWithTitle);\nbot.rules.set('carrito', sendCart);\nbot.rules.set('cuenta', sendCart);\nbot.rules.set('mi orden', sendOrders);\nbot.rules.set('mis ordenes', sendOrders);\nbot.rules.set('ayuda', sendHelp);\nbot.rules.set('help', sendHelp);\n\nbot.payloadRules.set('Greeting', sendMenu);\n\nbot.payloadRules.set('SendAddressesWithTitle', sendAddressesWithTitle);\nbot.payloadRules.set('SendAddresses', sendAddresses);\nbot.payloadRules.set('NewAddress', newAddress);\nbot.payloadRules.set('SetAddressComplement', setAddressComplement);\nbot.payloadRules.set('ConfirmAddress', confirmAddress);\nbot.payloadRules.set('SetAddress', setAddress);\nbot.payloadRules.set('EditAddress', editAddress);\nbot.payloadRules.set('RemoveAddress', removeAddress);\n\nbot.payloadRules.set('SendCategories', sendCategories);\nbot.payloadRules.set('SendProducts', sendProducts);\nbot.payloadRules.set('AddProduct', addProduct);\nbot.payloadRules.set('RemoveProduct', removeProduct);\nbot.payloadRules.set('IncreaseOneProduct', increaseOneProduct);\nbot.payloadRules.set('DecreaseOneProduct', decreaseOneProduct);\n\nbot.payloadRules.set('Search', searchProducts);\nbot.payloadRules.set('SendCart', sendCart);\nbot.payloadRules.set('SendCartDetails', sendCartDetails);\nbot.payloadRules.set('EditCart', editCart);\nbot.payloadRules.set('ClearCart', clearCart);\nbot.payloadRules.set('SendPurchaseOptions', sendPurchaseOptions);\n\nbot.payloadRules.set('Checkout', checkout);\nbot.payloadRules.set('CheckPayment', checkPayment);\nbot.payloadRules.set('CheckAddress', checkAddress);\nbot.payloadRules.set('CheckOrder', checkOrder);\nbot.payloadRules.set('RegisterCreditCard', registerCreditCard);\nbot.payloadRules.set('SendRegisteredCreditCards', sendRegisteredCreditCards);\nbot.payloadRules.set('CancelRegisterCreditCard', cancelRegisterCreditCard);\nbot.payloadRules.set('PayWithCreditCard', payWithCreditCard);\nbot.payloadRules.set('SendOrders', sendOrders);\nbot.payloadRules.set('SendOrder', sendOrder);\nbot.payloadRules.set('NewOrder', newOrder);\nbot.payloadRules.set('CancelOrder', cancelOrder);\nbot.payloadRules.set('SendCreditCards', sendCreditCards);\nbot.payloadRules.set('RemoveCreditCard', removeCreditCard);\nbot.payloadRules.set('SetScore', setScore);\nbot.payloadRules.set('SendAccount', sendAccount);\nbot.payloadRules.set('SendHelp', sendHelp);\nbot.payloadRules.set('CustomerService', sendHelp);\n\nbot.defaultSearch = searchProducts;\n\nconst initialState = {\n    userData: {},\n\n\n    geocodedLocation: {lat: -1, lng: -1},\n    addresses: [],\n    mapBounds: {},\n    mapAddress: '',\n    useSubCategories: false,\n    products: [],\n    pointOfSales: [],\n    categories: [],\n    paymentMethods: [],\n    consumer: {},\n    customer: {},\n    orders: { ongoing: [], delivered: [] },\n    orderToRate: null,\n    currentOrder: {\n        consumerAddress:{},\n        items: []\n    },\n    locationZoom: 3,\n    profileIsOpen: false,\n    mapAddressIsOpen: false,\n    addressFormIsOpen: false,\n    addressListIsOpen: false,\n    savingAddress: false,\n    creatingOrder: false,\n    paymentMethodNotSelected: false,\n    cartTotalIsBelowMinimumPrice: false,\n    currentCategory: {},\n    consumerNotFound: false,\n    updatingConsumer: false,\n    currentUser: {},\n    pendingOrder: false\n};\n\nconst reducer = (state = initialState, action) => {\n    console.log('ACTION');\n    console.log(action);\n    let data = action.data;\n\n    if(data && data.hasOwnProperty('recipientId')){\n        if(typeof state.userData[data.recipientId] != 'object'){\n            state.userData[data.recipientId] = {};\n        }\n    }\n\n    switch (action.type) {\n        case types.APP_LOADED: {\n            console.log('Application is running on port', bot.app.get('port'));\n            return {...state};\n        }\n        case types.CUSTOMER_LOADED: {\n            let customer = extractParseAttributes(data.customer);\n\n            if(typeof state.userData[data.recipientId] != 'object'){\n                state.userData[data.recipientId] = {};\n            }\n            objectAssign(state.userData[data.recipientId], {customer});\n            return {...state};\n        }\n        case types.CONSUMER_LOADED: {\n            //if (state.consumerNotFound) delete state.consumerNotFound;\n            let consumer = extractParseAttributes(data.consumer);\n            objectAssign(state.userData[data.recipientId], {consumer});\n            return {...state};\n        }\n        case types.USER_LOADED: {\n            let user = extractParseAttributes(data.user);\n            objectAssign(state.userData[data.recipientId], {user});\n            return {...state};\n        }\n        case types.CONSUMER_ADDRESSES_LOADED: {\n            let addresses = data.addresses.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {addresses});\n            return {...state};\n        }\n        case types.SET_CURRENT_ADDRESS: {\n            let address = extractParseAttributes(data.address);\n            objectAssign(state.userData[data.recipientId], {address});\n            return {...state};\n        }\n        case types.PAYMENT_METHODS_LOADED: {\n            let paymentMethods = data.paymentMethods.map(p => extractParseAttributes(p))\n            objectAssign(state.userData[data.recipientId], {paymentMethods})\n            return {...state};\n        }\n        case types.SET_PAYMENT_METHOD: {\n            let paymentMethod = extractParseAttributes(data.paymentMethod);\n            objectAssign(state.userData[data.recipientId], {paymentMethod});\n            return {...state};\n        }\n        case types.SET_ORDERS: {\n            let ongoing = data.orders.ongoing.map(a => extractParseAttributes(a));\n            let delivered = data.orders.delivered.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {orders: {ongoing: ongoing, delivered: delivered}});\n            return {...state};\n        }\n        case types.CONSUMER_UPDATED: {\n            return {...state};\n        }\n        case types.CONSUMER_NOT_FOUND: {\n            /*objectAssign(state, {\n                consumerNotFound: true,\n                currentUser: action.data.user\n            })*/\n            return {...state};\n        }\n        case types.CONSUMER_ORDERS_LOADED: {\n            let orders = data.orders.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {orders});\n            return {...state};\n            /*let ongoing = orders['ongoing'].map(o => extractParseAttributes(o))\n            let delivered = orders['delivered'].map(o => extractParseAttributes(o))\n            let orderToRate = delivered[0]\n            objectAssign(state, {\n                orders: {ongoing, delivered},\n                orderToRate\n            })*/\n            return {...state};\n        }\n        case types.USER_CREDITCARDS_LOADED: {\n            let creditCards = data.creditCards.map(a => extractParseAttributes(a));\n            objectAssign(state.userData[data.recipientId], {creditCards});\n            return {...state};\n        }\n        case types.SET_CUSTOMER_POINT_SALE: {\n            let pointSale = extractParseAttributes(data.pointSale);\n            objectAssign(state.userData[data.recipientId], {pointSale});\n            return {...state};\n        }\n        case types.SET_ORDER: {\n            let order = extractParseAttributes(data.order);\n            objectAssign(state.userData[data.recipientId], {order});\n            return {...state};\n        }\n        case types.SET_USER: {\n            let user = extractParseAttributes(data.user);\n            objectAssign(state.userData[data.recipientId], {user});\n            return {...state};\n        }\n        case types.SET_CONSUMER: {\n            let consumer = extractParseAttributes(data.consumer);\n            objectAssign(state.userData[data.recipientId], {consumer});\n            return {...state};\n        }\n        case types.SET_CUSTOMER:{\n            let customer = extractParseAttributes(data.customer);\n            objectAssign(state.userData[data.recipientId], {customer});\n            return {...state};\n        }\n        case types.SET_ORDER_STATE: {\n            let orderState = extractParseAttributes(data.orderState);\n            objectAssign(state.userData[data.recipientId], {orderState});\n            return {...state};\n        }\n        case types.RENDER_MENU: {\n            /*\n            console.log('Store');\n            console.log('Consumer');\n            console.log(consumer);*/\n            renderMenu()\n\n            /*request({\n             uri: 'https://graph.facebook.com/v2.6/' + '1100195690052041',\n             qs: {access_token: PAGE_ACCESS_TOKEN, fields: 'first_name,last_name,locale,timezone,gender'},\n             method: 'GET'\n             }, renderMenuMessage);*/\n            return state;\n        }\n        case types.RENDER_ADDRESS_MENU: {\n            renderAddress();\n            return state;\n        }\n        default:\n            return state;\n    }\n}\n\nconst store = createStore(reducer, applyMiddleware(thunk));\n\nstore.subscribe(() =>\n    console.log('\\n')\n);\n\n//global.FB = FB;\n\nfunction getData(recipientId, property){\n    if(recipientId !== undefined){\n        let data = store.getState().userData;\n        let userData = data[recipientId];\n\n        if(userData == undefined){\n            data[recipientId] = {};\n            userData = data[recipientId];\n        }\n\n        if(property == undefined)\n            return userData;\n        else{\n            if(userData.hasOwnProperty(property)){\n                return userData[property];\n            }\n            else\n                return undefined;\n        }\n    }\n}\n\nfunction login(username, password){\n    return Parse.User.logIn(username, password, {\n        success : user => {\n            /*console.log(Parse.User.current());\n             console.log(user);\n             console.log(user.authenticated());\n             console.log(user.getSessionToken());*/\n            let val = JSON.stringify({sessionToken: user.getSessionToken()});\n            //console.log(val);\n\n            /*Parse.User.become(_user.getSessionToken()).then(__user => {\n             console.log(Parse.User.current());\n             console.log(__user);\n             console.log(__user.authenticated());\n             console.log(__user.getSessionToken());\n             });\n\n             _;*/\n        },\n        error: function(user, error) {\n            // An error occurred.\n        }});\n}\n\nfunction authentication(recipientId, callback){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let username = recipientId.toString();\n\n    if(typeof user == 'undefined'){\n        user = new ParseModels.User({recipientId});\n    }\n    else{\n        user = user.rawParseObject\n    }\n\n    getCustomer(recipientId).then(customer => {\n        user.registered().then(_user => {\n            if (typeof _user == 'undefined') {\n                bot.getFacebookUser(recipientId).then(data => {\n                    user.signUpWithFacebook(data).then(() => {\n                        username = user.get('username');\n                        login(username, username).then(()=> {\n                            user.saveInStore(store, recipientId).then(() => {\n                                getConsumer(recipientId, user).then(_consumer => {\n                                    if(typeof _consumer == 'undefined'){\n                                        createConsumer(user).then(_consumer => {\n                                            _consumer.saveInStore(store, recipientId).then(()=> {\n                                                if(callback){\n                                                    callback(_user)\n                                                }\n                                            });\n                                        });\n                                    }\n                                    else{\n                                        _consumer.rawParseObject.saveInStore(store, recipientId).then(()=> {\n                                            if(callback){\n                                                callback(_user)\n                                            }\n                                        });\n                                    }\n                                });\n                            });\n                        });\n                    });\n                });\n            }\n            else {\n                username = _user.get('username');\n                login(username, username).then(()=> {\n                    _user.saveInStore(store, recipientId).then(() => {\n                        getConsumer(recipientId, _user).then(_consumer => {\n                            if(typeof _consumer == 'undefined'){\n                                createConsumer(user).then(_consumer => {\n                                    _consumer.saveInStore(store, recipientId).then(()=> {\n                                        if(callback){\n                                            callback(_user)\n                                        }\n                                    });\n                                });\n                            }\n                            else{\n                                _consumer.rawParseObject.saveInStore(store, recipientId).then(()=> {\n                                    if(callback){\n                                        callback(_user)\n                                    }\n                                });\n                            }\n                        });\n                    });\n                });\n            }\n        });\n    });\n}\n\nfunction createConsumer(user){\n    let consumer = new ParseModels.Consumer();\n    consumer.setUser(user);\n    return consumer.save().fail(error => {\n        console.log('Error code: ' + error.message);\n    });\n}\n\nfunction getCustomer(recipientId){\n    let customer = getData(recipientId, 'customer');\n\n    if(typeof customer == 'undefined'){\n        return loadCustomer(recipientId).then(()=>{\n            return getData(recipientId, 'customer');\n        });\n    }\n    else{\n        return Parse.Promise.as().then(() => {\n            return customer;\n        })\n    }\n}\n\nfunction getConsumer(recipientId, user){\n    let consumer = getData(recipientId, 'consumer');\n\n    if(typeof consumer == 'undefined'){\n        return loadConsumer(recipientId, user).then(()=>{\n            return getData(recipientId, 'consumer');\n        });\n    }\n    else{\n        return Parse.Promise.as().then(() => {\n            return consumer;\n        })\n    }\n}\n\nfunction loadCustomer(recipientId){\n    return store.dispatch(Actions.loadCustomer(recipientId, BUSINESS_ID))\n}\n\nfunction loadConsumer(recipientId, user){\n    return store.dispatch(Actions.loadConsumer(recipientId, user))\n}\nfunction loadConsumerAddresses(recipientId, consumer){\n    return store.dispatch(Actions.loadConsumerAddresses(recipientId, consumer.rawParseObject))\n}\n\nfunction loadUserCreditCards(recipientId, user){\n    return store.dispatch(Actions.loadUserCreditCards(recipientId, user.rawParseObject))\n}\n\nfunction sendMenu(recipientId) {\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, () =>{\n        let user = getData(recipientId, 'user');\n\n        renderMenu(recipientId);\n    });\n}\n\nfunction renderMenu(recipientId) {\n    let customer = getData(recipientId, 'customer');\n    let consumer = getData(recipientId, 'consumer');\n\n    let image_url = customer.image.url;\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: \"template\",\n                payload: {\n                    template_type: \"generic\",\n                    //text: \"Buenos dias, para conocer nuestros menus del dia, por favor escoja una opcin:\",\n                    elements: [{\n                        \"title\":     \"Hola \"+consumer.name+\", Bienvenido a \"+customer.name,\n                        \"subtitle\":  \"Aqu puedes pedir un domicilio, escribe o selecciona alguna de las opciones:\",\n                        \"image_url\": image_url,\n                        \"buttons\":[\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir domicilio\",\n                                \"payload\": \"SendAddressesWithTitle\"\n                            },\n                            /*{\n                                \"type\":\"postback\",\n                                \"title\":\"Pedir para recoger\",\n                                \"payload\": \"TakeOut\"\n                            },*/\n                            {\n                                \"type\":\"postback\",\n                                \"title\":\"Servicio al cliente\",\n                                \"payload\": \"CustomerService\"\n                            }\n                        ]\n                    }]\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendAddressesWithTitle(recipientId){\n    renderAddressTitle(recipientId, () => {\n        sendAddresses(recipientId);\n    });\n}\n\nfunction sendAddresses(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, () =>{\n        let user = getData(recipientId, 'user');\n        let consumer = getData(recipientId, 'consumer');\n\n        loadConsumerAddresses(recipientId, consumer).then(() => {\n            renderAddress(recipientId);\n        });\n    });\n}\n\nfunction renderAddress(recipientId){\n\n    let addresses = getData(recipientId, 'addresses');\n    let elements = [];\n\n    //\"title\": \"A cual direccin vas hacer tu pedido?\",\n    //\"subtitle\": \"Puedes escoger entre tus direcciones guardadas o agregar una nueva direccin\",\n\n    elements.push({\n        \"title\": \"Nueva direccin\",\n        \"subtitle\": \"Puedes agregar una nueva direccin\",\n        \"image_url\": SERVER_URL+\"assets/new_address_blue.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": \"Nueva direccin\",\n                \"payload\": \"NewAddress\"\n            }\n        ]\n    });\n\n    for(let address of addresses) {\n        if (elements.length < bot.limit){\n            elements.push({\n                \"title\": address.name.capitalizeFirstLetter(),\n                \"subtitle\": address.address +\", \"+address.description+\", \"+address.city+\", \"+address.state,\n                \"image_url\": GOOGLE_MAPS_URL+ \"?center=\"+address.location.lat+\",\"+address.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+address.location.lat+\",\"+address.location.lng+\"&key=\"+GOOGLE_MAPS_KEY,\n                \"buttons\": [\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Seleccionar\",\n                        \"payload\": \"SetAddress-\"+address.objectId\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Modificar\",\n                        \"payload\": \"EditAddress-\"+address.objectId\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Quitar\",\n                        \"payload\": \"RemoveAddress-\"+address.objectId\n                    }\n                ]\n            });\n        }\n    }\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\": \"template\",\n                \"payload\":{\n                    \"template_type\": \"generic\",\n                    \"elements\": elements\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n\n}\n\nfunction sendCreditCards(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, () =>{\n        let user = getData(recipientId, 'user');\n\n        loadUserCreditCards(recipientId, user).then(() => {\n            renderCreditCards(recipientId);\n\n        });\n\n    });\n}\n\nfunction renderCreditCards(recipientId){\n    let creditCards = getData(recipientId, 'creditCards');\n    let elements = [];\n\n    //\"title\": \"A cual direccin vas hacer tu pedido?\",\n    //\"subtitle\": \"Puedes escoger entre tus direcciones guardadas o agregar una nueva direccin\",\n\n    elements.push({\n        \"title\": \"Registro de tarjeta\",\n        \"subtitle\": \"Puedes agregar una tarjeta\",\n        \"image_url\": SERVER_URL+\"assets/money.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": \"Nueva tarjeta\",\n                \"payload\": \"RegisterCreditCard\"\n            }\n        ]\n    });\n\n    for(let creditCard of creditCards) {\n        if (elements.length < bot.limit){\n            elements.push({\n                \"title\": creditCard.type+' '+creditCard.lastFour,\n                \"subtitle\": creditCard.cardHolderName,\n                \"image_url\": SERVER_URL+'assets/credit_card.jpg',\n                \"buttons\": [\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Seleccionar\",\n                        \"payload\": \"PayWithCreditCard-\" + creditCard.objectId\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Quitar\",\n                        \"payload\": \"RemoveCreditCard-\"+creditCard.objectId\n                    }\n                ]\n            });\n        }\n    }\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\": \"template\",\n                \"payload\":{\n                    \"template_type\": \"generic\",\n                    \"elements\": elements\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n\n}\n\n\n\n\n\n\n\n\nfunction renderAddressTitle(recipientId, callback){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A cual direccin vas hacer tu pedido?\\n\\nPuedes escoger entre agregar una nueva direccin o seleccionar una de tus direcciones guardadas\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction newAddress(recipientId){\n    bot.sendTypingOff(recipientId);\n    bot.setDataBuffer(recipientId, 'addressPayload', 'NewAddress');\n    writeAddress(recipientId);\n}\n\nfunction writeAddress(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Puedes escribir o compartir tu ubicacin actual?\\n\\nEjemplo: Calle 67 #52-20, Medelln\",\n            \"quick_replies\":[\n                {\n                    \"content_type\": \"location\"\n                }\n            ]\n        }\n    };\n\n    bot.setListener(recipientId, 'address', 'text', addressCheck);\n    bot.setListener(recipientId, 'location', 'attachment', setLocationCheck);\n\n    bot.callSendAPI(messageData);\n}\n\n\nfunction renderMapMessage(recipientId, callback){\n    let userBuffer = bot.buffer[recipientId];\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"text\": \"Encontr esta direccin en Google Maps:\\n\\n\"+userBuffer.address+\"\"\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction renderNullMapMessage(recipientId, callback){\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"text\": \"La direccin no ha sido encontrada en Google Maps, por favor intenta de nuevo\"\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction renderMap(recipientId, callback){\n    bot.sendTypingOff(recipientId);\n    let userBuffer = bot.buffer[recipientId];\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        \"message\": {\n            \"attachment\": {\n                \"type\": \"image\",\n                \"payload\": {\n                    \"url\": GOOGLE_MAPS_URL+\"?center=\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&zoom=16&size=400x400&markers=color:red%7C\"+userBuffer.location.lat+\",\"+userBuffer.location.lng+\"&key=\"+GOOGLE_MAPS_KEY\n                }\n            }\n        }\n    };\n\n    bot.callSendAPI(messageData, callback);\n}\n\nfunction addressCheck(recipientId){\n    let userBuffer = bot.buffer[recipientId];\n\n    geocoder.geocode(userBuffer.address, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            setAddressComponetsInBuffer(recipientId, data.results[0]);\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n            renderNullMapMessage(recipientId, ()=>{\n                newAddress(recipientId)\n            });\n        }\n    });\n}\n\nfunction setAddressComponetsInBuffer(recipientId, data){\n    let userBuffer = bot.buffer[recipientId];\n    userBuffer.address = data.formatted_address;\n    userBuffer.location = data.geometry.location;\n\n    for(let component of data.address_components){\n        if(component.types.includes('route')){\n            userBuffer.route = component.long_name;\n        }\n        else if(component.types.includes('street_number')){\n            userBuffer.street_number = component.short_name;\n        }\n        else if(component.types.includes('locality')){\n            userBuffer.locality = component.short_name;\n        }\n        else if(component.types.includes('administrative_area_level_1')){\n            userBuffer.state = component.short_name;\n        }\n        else if(component.types.includes('administrative_area_level_2')){\n            userBuffer.administrative_area = component.short_name;\n        }\n        else if(component.types.includes('country')){\n            userBuffer.country = component.long_name;\n            userBuffer.country_code = component.short_name\n        }\n        else if(component.types.includes('postal_code')){\n            userBuffer.postal_code = component.short_name;\n        }\n    }\n\n    renderMapMessage(recipientId, () => {\n        renderMap(recipientId, () => {\n            let messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"Es correcta?\",\n                    \"quick_replies\":[\n                        {\n                            \"content_type\": \"text\",\n                            \"title\": \"Si\",\n                            \"payload\": \"SetAddressComplement\"\n                        },\n                        {\n                            \"content_type\": \"text\",\n                            \"title\": \"No\",\n                            \"payload\": \"NewAddress\"\n                        }\n                    ]\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        });\n    });\n}\n\nfunction setAddressComplement(recipientId){\n    bot.sendTypingOff(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor escribe el complemento de tu direccin actual. \\n\\nEjemplo: Oficina 1068\"\n        }\n    };\n    bot.setListener(recipientId, 'complement', 'text', confirmAddress);\n    bot.callSendAPI(messageData);\n}\n\n\nfunction confirmAddress(recipientId){\n    let userBuffer = bot.buffer[recipientId];\n    let addressPayload = userBuffer['addressPayload'];\n\n    if(addressPayload == 'NewAddress'){\n        let messageData = {\n            recipient: {\n                id: recipientId\n            },\n            message: {\n                \"text\": \"Por favor coloca un nombre a esta direccin para guardarla. \\n\\nEjemplo: casa, apartamento o oficina\"\n            }\n        };\n        bot.setListener(recipientId, 'address_name', 'text', saveAddress);\n        bot.sendTypingOff(recipientId);\n        bot.callSendAPI(messageData);\n    }\n    else if(addressPayload.startsWith('EditAddress')){\n        let data = addressPayload.split('-');\n        let location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n        new Parse.Query(ParseModels.ConsumerAddress).get(data[1]).then((consumerAddress) => {\n\n            consumerAddress.set('address', userBuffer.route+\" # \"+userBuffer.street_number);\n            consumerAddress.set('location', location);\n            consumerAddress.set('country', userBuffer.country);\n            consumerAddress.set('countryCode', userBuffer.country_code);\n            consumerAddress.set('postalCode', userBuffer.postal_code);\n            consumerAddress.set('state', userBuffer.state);\n            consumerAddress.set('description', userBuffer.complement);\n\n            consumerAddress.save(undefined, {\n                success: function(address) {\n                    delete userBuffer.address;\n                    delete userBuffer.location;\n                    delete userBuffer.complement;\n\n                    let messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"text\": \"La direccin ha sido actualizada.\"\n                        }\n                    };\n\n                    bot.sendTypingOff(recipientId);\n                    bot.callSendAPI(messageData, () => {\n                        setAddress(recipientId, address.id)\n                    });\n                },\n                error: function(user, error) {\n                    // Execute any logic that should take place if the save fails.\n                    // error is a Parse.Error with an error code and message.\n                    console.log('Failed to create new object, with error code: ' + error.message);\n                }\n            });\n        });\n    }\n}\n\nfunction saveAddress(recipientId){\n    let consumer = getData(recipientId, 'consumer');\n    let userBuffer = bot.buffer[recipientId];\n    let location = new Parse.GeoPoint({latitude: parseFloat(userBuffer.location.lat), longitude: parseFloat(userBuffer.location.lng)});\n\n    let consumerAddress = new ParseModels.ConsumerAddress();\n    consumerAddress.set('name', userBuffer.address_name);\n    consumerAddress.set('address', userBuffer.route+\" # \"+userBuffer.street_number);\n    consumerAddress.set('consumer', {\n        __type: \"Pointer\",\n        className: \"Consumer\",\n        objectId: consumer.objectId\n    });\n    consumerAddress.set('location', location);\n    consumerAddress.set('city', userBuffer.locality);\n    consumerAddress.set('country', userBuffer.country);\n    consumerAddress.set('countryCode', userBuffer.country_code);\n    consumerAddress.set('postalCode', userBuffer.postal_code);\n    consumerAddress.set('state', userBuffer.state);\n    consumerAddress.set('description', userBuffer.complement);\n\n    consumerAddress.save(undefined, {\n        success: function(result) {\n\n            delete userBuffer.address;\n            delete userBuffer.location;\n            delete userBuffer.complement;\n            delete userBuffer['address_name'];\n\n            let messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"La direccin ha sido almacenada.\"\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData, () => {\n                setAddress(recipientId, result.id)\n            });\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n}\n\nfunction setEmail(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor escribe tu email:\"\n        }\n    };\n    bot.setListener(recipientId, 'email', 'text', setEmailCheck);\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setEmailCheck(recipientId, value){\n    let consumer = getData(recipientId, 'consumer').rawParseObject;\n    consumer.setEmail(value);\n    return consumer.saveInStore(store, recipientId);\n}\n\nfunction setTelephone(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Por favor escribe tu nmero telefnico:\"\n        }\n    };\n    bot.setListener(recipientId, 'telephone', 'text', setTelephoneCheck);\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setTelephoneCheck(recipientId, value){\n    let consumer = getData(recipientId, 'consumer').rawParseObject;\n    consumer.setPhone(value);\n    return consumer.saveInStore(store, recipientId);\n}\n\nfunction setLocationCheck(recipientId){\n    let userBuffer = bot.buffer[recipientId];\n\n    geocoder.reverseGeocode( userBuffer.location.lat, userBuffer.location.lng, (error, data) =>{\n        if(!error && data.status == 'OK'){\n            setAddressComponetsInBuffer(recipientId, data.results[0])\n        }\n        else{\n            console.log('Geocode not found');\n            console.log(error);\n            renderNullMapMessage(recipientId, ()=>{\n                newAddress(recipientId)\n            });\n        }\n    });\n}\n\nfunction setAddress(recipientId, id){\n    bot.sendTypingOn(recipientId);\n\n    store.dispatch(Actions.setAddress(recipientId, id)).then(() => {\n            let address = getData(recipientId, 'address');\n\n            Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID, lat: address.location.lat, lng: address.location.lng}).then(\n                function(result){\n                    let pointSale = result.pointSale;\n\n                    store.dispatch(Actions.setCustomerPointSale(recipientId, pointSale.id)).then(\n                        () => {\n                            renderAddressConfirmation(recipientId)\n                        });\n                },\n                function(error) {\n                    if(error.code == '141'){\n                        renderAddressOutOfCoverage(recipientId);\n                    }\n                    else{\n                        console.log('error');\n                        console.log(error);\n                    }\n                });\n            /*\n            Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID }).then(\n                function(result){\n                    let pointSale = result.pointSale\n                    console.log('\\nPoint Sale');\n                    console.log(pointSale);\n\n                    Parse.Cloud.run('isInsideCoverage', {lat: address.location.lat, lng: address.location.lng, pointSale: pointSale.id } ).then(\n                        function(result){\n                            console.log(result);\n                        },\n                        function(error) {\n                            console.log('error');\n                            console.log(error);\n                        });\n                },\n                function(error) {\n                    console.log('error');\n                    console.log(error);\n                });\n                */\n        }\n    );\n}\n\nfunction editAddress(recipientId, id){\n    bot.sendTypingOff(recipientId);\n    bot.setDataBuffer(recipientId, 'addressPayload', 'EditAddress-'+id);\n\n    writeAddress(recipientId);\n\n}\n\nfunction removeAddress(recipientId, id){\n    new Parse.Query(ParseModels.ConsumerAddress).get(id).then((consumerAddress) => {\n        consumerAddress.destroy().then(()=>{\n            sendAddresses(recipientId);\n        });\n    });\n}\n\nfunction removeCreditCard(recipientId, id){\n    new Parse.Query(ParseModels.CreditCard).get(id).then((creditCard) => {\n        creditCard.destroy().then(()=>{\n            sendCreditCards(recipientId);\n        });\n    });\n}\n\nfunction renderAddressOutOfCoverage(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"La direccin seleccionada no est dentro de la cobertura de nuestras sedes, por favor intenta con otra direccin\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendAddressesWithTitle);\n}\n\nfunction renderAddressConfirmation(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Perfecto, ya seleccion tu direccin para este pedido\" //Perfecto, ya guard tu direccin para prximos pedidos\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendCategories);\n}\n\nfunction renderCategoriesInitialMessage(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"A continuacin te presentamos las categoras de productos disponibles.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendCategories(recipientId, index){\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, ()=>{\n        if(index == undefined)\n            index = 0;\n        else if( typeof index == 'string')\n            index = parseInt(index);\n\n        if(index == 0){\n            renderCategoriesInitialMessage(recipientId)\n            bot.sendTypingOn(recipientId);\n        }\n\n        Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID }).then(function(result){\n\n            let elements = splitCategories(recipientId, result.categories, index);\n            let idx = Object.keys(result.categories).length;\n            let buttons = [];\n            let catIni = (index+1)*bot.limit;\n            let catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n            /*\n            console.log('length: '+idx);\n            console.log('catIni: '+catIni);\n            console.log('catFin: '+catFin);\n            console.log('limitsearchProducts: '+(index+1)*bot.limit);\n            */\n            if(idx > (index+1)*bot.limit){\n                buttons.push({\n                    type: \"postback\",\n                    title: \"Categoras \"+(catIni+1)+\"-\"+catFin,\n                    payload: \"SendCategories-\"+(index+1),\n                });\n\n                elements.push({\n                    title: \"Ver ms categorias \",\n                    subtitle: \"Categoras disponibles\",\n                    buttons: buttons\n                });\n            }\n\n            let messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    attachment: {\n                        type: \"template\",\n                        payload: {\n                            template_type: \"generic\",\n                            elements: elements\n                        }\n                    }\n                }\n            };\n\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        function(error) {\n            console.log('error');\n            console.log(error);\n        });\n    });\n}\n\nfunction splitCategories(recipientId, categories, index){\n    let customer = getData(recipientId, 'customer');\n    let image_url = customer.image.url;\n\n    let idx = 0;\n    let elements = [];\n\n    categories.forEach(function(item){\n        if(item && item.get('name')){\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                let image = item.get('image');\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name'),\n                    //subtitle: item.get('name'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: item.get('name'),\n                        payload: \"SendProducts-\"+item.id+\"-\"+index,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction renderProductsInitialMessage(recipientId, categoryId){\n    return new Parse.Query(ParseModels.Category).get(categoryId).then(\n        category => {\n            let messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    text: category.get('name')+\":\"\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendProducts(recipientId, category, proIdx){\n    bot.sendTypingOn(recipientId);\n    proIdx = parseInt(proIdx);\n    if(proIdx == 0){\n        renderProductsInitialMessage(recipientId, category);\n        bot.sendTypingOn(recipientId);\n    }\n\n    Parse.Cloud.run('getProducts', { businessId: BUSINESS_ID, category: category }).then(result => {\n        let elements = splitProducts(recipientId, result.products, proIdx);\n        let idx = Object.keys(result.products).length;\n        let buttons = [];\n        let catIni = (proIdx+1)*bot.limit;\n        let catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n        /*\n        console.log('length: '+idx);\n        console.log('catIni: '+catIni);\n        console.log('catFin: '+catFin);\n        console.log('limit: '+(proIdx+1)*bot.limit);\n        */\n        if( idx > (proIdx+1)*bot.limit ){\n            buttons.push({\n                type: \"postback\",\n                title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                payload: \"SendProducts-\"+category+\"-\"+(proIdx+1),\n            });\n\n            elements.push({\n                title: \"Ver ms productos \",\n                subtitle: \"Productos disponibles\",\n                buttons: buttons\n            });\n        }\n\n        let messageData = {\n            recipient: {\n                id: recipientId\n            },\n            message: {\n                attachment: {\n                    type: \"template\",\n                    payload: {\n                        template_type: \"generic\",\n                        elements: elements\n                    }\n                }\n            }\n        };\n\n        bot.sendTypingOff(recipientId);\n        bot.callSendAPI(messageData);\n    },\n    function(error) {\n        console.log('error');\n        console.log(error);\n    })\n}\n\nfunction splitProducts(recipientId, products, proIdx){\n    let customer = getData(recipientId, 'customer');\n    let image_url = customer.image.url;\n\n    if(typeof customer != 'undefined'){\n        image_url = customer.image.url;\n    }\n\n    let idx = 0;\n    let elements = [];\n\n    products.forEach(function(item){\n        if(item && item.get('name')){\n            if(idx >= (proIdx)*bot.limit && idx < (proIdx+1)*bot.limit){\n                let image = item.get('image');\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.get('name') +\": $\"+ item.get('priceDefault'),\n                    subtitle: item.get('description'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: \"Agregar\",\n                        payload: \"AddProduct-\"+item.id,\n                    }]\n                })\n            }\n            idx = idx+1;\n        }\n    });\n    return elements;\n}\n\nfunction createCart(recipientId){\n    let userData = getData(recipientId);\n    Object.assign(userData, {'cart': {items: new Map()}});\n    return userData.cart;\n}\n\nfunction createOrder(recipientId){\n    let userData = getData(recipientId);\n    Object.assign(userData, {'order': new Map()});\n    return getData(recipientId, 'order')\n}\n\nfunction addProduct(recipientId, productId){\n    //console.log(\"Add product: \"+productId);\n    //console.log(\"Order.count: \"+order.count());\n    let product = new ParseModels.Product();\n    let cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n\n    new Parse.Query(product).get(productId).then(\n        product => {\n            if(!items.get(productId)){\n                items.set(productId, {quantity: 1, price: product.get('priceDefault')});\n            }\n            else{\n                items.get(productId).quantity += 1;\n            }\n\n            saveCart(recipientId);\n\n            renderAddProductConfirmation(recipientId, productId);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    );\n}\n\nfunction removeProduct(recipientId, productId){\n    let cart = getData(recipientId, 'cart');\n    console.log('Remove product '+productId);\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    new Parse.Query(ParseModels.OrderItem).get(item.id, {\n        success: (orderItem) => {\n            orderItem.destroy({});\n            items.delete(productId);\n            let itemsPointers = [];\n\n            for(let [key, value] of items) {\n                itemsPointers.push({\"__type\": \"Pointer\", \"className\": \"OrderItem\", \"objectId\": value.id})\n            }\n\n            cart.itemsPointers = itemsPointers;\n            if(items.size == 0){\n                sendCart(recipientId);\n            }\n            else{\n                sendCartDetails(recipientId)\n            }\n        },\n        error: (orderItem, error) => {\n            console.log('error');\n            console.log(error);\n        }\n    });\n}\n\nfunction increaseOneProduct(recipientId, productId){\n    let cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    item.quantity++;\n\n    new Parse.Query(ParseModels.OrderItem).get(item.id, {\n        success: (orderItem) => {\n            orderItem.set('amount', item.quantity);\n            orderItem.save();\n            sendCartDetails(recipientId)\n        },\n        error: (orderItem, error) => {\n            console.log('error');\n            console.log(error);\n        }\n    });\n}\n\nfunction decreaseOneProduct(recipientId, productId){\n    let cart = getData(recipientId, 'cart');\n\n    if(cart == undefined){\n        cart = createCart(recipientId);\n    }\n\n    let items = cart.items;\n    let item = items.get(productId);\n\n    item.quantity--;\n    console.log('Order Item');\n    console.log(item);\n\n    if(item.quantity > 0){\n        new Parse.Query(ParseModels.OrderItem).get(item.id, {\n            success: (orderItem) => {\n                orderItem.set('amount', item.quantity);\n                orderItem.save();\n                sendCartDetails(recipientId)\n            },\n            error: (orderItem, error) => {\n                console.log('error');\n                console.log(error);\n            }\n        });\n    }\n    else{\n        console.log('remove');\n        console.log(item);\n        removeProduct(recipientId, productId)\n    }\n}\n\nfunction saveCart(recipientId){\n    let consumerCart = new ParseModels.Cart();\n    let consumer = getData(recipientId, 'consumer');\n    let address = getData(recipientId, 'address');\n    let cart = getData(recipientId, 'cart');\n    let paymentMethod = getData(recipientId, 'paymentMethod');\n    let items = [];\n    let item;\n\n    for(let [id, properties] of cart.items){\n        //console.log('\\n'+id);\n        //console.log(properties);\n\n        item = new ParseModels.OrderItem();\n\n        if(properties.hasOwnProperty('id')){\n            item.set('id', properties.id);\n        }\n\n        item.set('product', {\n            __type: \"Pointer\",\n            className: \"Product\",\n            objectId: id\n        });\n        item.set('price', properties.price);\n        item.set('amount', properties.quantity);\n        item.set('modifiersGroups', []);\n        items.push(item);\n\n        /*\n        item.save(undefined, {\n            success: function(result) {\n                //console.log('\\nItem save');\n                //console.log(result);\n                //console.log(result.get('product'));\n                let itemId = result.get('product').objectId;\n                //console.log(cart.items.get(itemId));\n                cart.items.get(itemId).id = result.id;\n                //console.log(cart.items.get(itemId));\n            },\n            error: function(user, error) {\n                // Execute any logic that should take place if the save fails.\n                // error is a Parse.Error with an error code and message.\n                console.log('Failed to create new object, with error code: ' + error.message);\n            }\n        });\n        */\n    }\n\n    Parse.Object.saveAll(items, {\n        success: function(result) {\n            let itemsPointers = [];\n            for(let item of result){\n                let itemId = item.get('product').objectId;\n                cart.items.get(itemId).id = item.id;\n\n                itemsPointers.push({\"__type\":\"Pointer\", \"className\": \"OrderItem\", \"objectId\": item.id})\n            }\n\n            //console.log(cart.items);\n            //console.log(itemsPointers);\n\n            if(cart.hasOwnProperty('id')){\n                consumerCart.set('id', cart.id);\n            }\n\n            if(typeof paymentMethod != 'undefined'){\n                consumerCart.set('paymentMethod', paymentMethod.method)\n            }\n\n            consumerCart.set('consumerAddress', {\n                __type: \"Pointer\",\n                className: \"ConsumerAddress\",\n                objectId: address.objectId\n            });\n            consumerCart.set('consumer', {\n                __type: \"Pointer\",\n                className: \"Consumer\",\n                objectId: consumer.objectId\n            });\n            consumerCart.set('items', itemsPointers);\n\n            consumerCart.save(undefined, {\n                success: function(result) {\n                    /*delete userBuffer.address;\n                     delete userBuffer.location;\n                     delete userBuffer['address_name'];\n\n                     console.log(userBuffer);\n                     console.log('\\nConsumer kart');\n                     console.log(result);\n                    */\n                    cart['id'] = result.id;\n                    cart['rawParseObject'] = result;\n                    cart['itemsPointers'] = itemsPointers;\n                },\n                error: function(user, error) {\n                    // Execute any logic that should take place if the save fails.\n                    // error is a Parse.Error with an error code and message.\n                    console.log('Failed to create new object, with error code: ' + error.message);\n                }\n            });\n\n\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n        }\n    });\n}\n\nfunction saveOrder(recipientId){\n    let order = new ParseModels.Order();\n    let consumer = getData(recipientId, 'consumer');\n    let customer = getData(recipientId, 'customer');\n    let cart = getData(recipientId, 'cart');\n    let address = getData(recipientId, 'address');\n    let paymentMethod = getData(recipientId, 'paymentMethod');\n    let pointSale = getData(recipientId, 'pointSale');\n    let state0 = orderStates.get(0);\n    let total = 0 ;\n\n    /*console.log(consumer);\n    console.log(consumer.name);\n    console.log(customer);\n    console.log(paymentMethod.method);\n    console.log(address);\n    console.log(state0);\n    console.log(cart);\n    console.log(pointSale);*/\n\n    console.log(cart.items);\n    console.log(cart.itemsPointers);\n\n    cart.items.forEach(function(value, key){\n        //console.log(value);\n        total += value.quantity * value.price;\n    });\n\n    order.set('consumer', { __type: 'Pointer', className: 'Consumer', objectId: consumer.objectId });\n    order.set('consumerAddress', { __type: 'Pointer', className: 'ConsumerAddress', objectId: address.objectId });\n    order.set('pointSale', { __type: 'Pointer', className: 'CustomerPointSale', objectId: pointSale.objectId });\n    order.set('state', { __type: 'Pointer', className: 'OrderState', objectId: state0.objectId });\n    //order.set('dateSchedule')\n    order.set('items', cart.itemsPointers);\n    order.set('deliveryCost', pointSale.deliveryCost);\n    order.set('total', total);\n    order.set('paymentMethod', paymentMethod.method);\n    order.set('name', consumer.name);\n    order.set('email', consumer.email);\n    order.set('phone', consumer.phone);\n    //order.set('comment', \"Orden\");\n\n    console.log('Setting Order');\n\n    order.save(undefined, {\n        success: function(order) {\n\n            store.dispatch(Actions.setOrder(recipientId, order)).then(() => {\n                console.log('Save Order');\n                console.log(order);\n                clearCart(recipientId);\n            });\n\n            /*console.log('Save Order');\n            console.log(order);*/\n        },\n        error: function(user, error) {\n            // Execute any logic that should take place if the save fails.\n            // error is a Parse.Error with an error code and message.\n            console.log('Failed to create new object, with error code: ' + error.message);\n            console.log(error);\n        }\n    });\n}\n\nfunction renderAddProductConfirmation(recipientId, productId){\n    return new Parse.Query(ParseModels.Product).get(productId).then(\n        product => {\n            let messageData = {\n                recipient: {\n                    id: recipientId\n                },\n                message: {\n                    \"text\": \"El producto \"+product.get('name')+\" ha sido agregado.\\n\\nDeseas agregar otro producto o terminar tu pedido?\",\n                    \"quick_replies\":[\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Seguir pidiendo\",\n                            \"payload\":\"SendCategories-0\"\n                        },\n                        {\n                            \"content_type\":\"text\",\n                            \"title\":\"Ver carrito\",\n                            \"payload\":\"SendCart\"\n                        }\n                    ]\n                }\n            };\n            bot.sendTypingOff(recipientId);\n            bot.callSendAPI(messageData);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    )\n}\n\nfunction sendPurchaseOptions(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tenemos las siguientes opciones disponibles:\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver categorias\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver carrito\",\n                    \"payload\":\"SendCart\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendCart(recipientId){\n    authentication(recipientId, () =>{\n        // Generate a random receipt ID as the API requires a unique ID\n\n        let user = getData(recipientId, 'user');\n        let customer = getData(recipientId, 'customer');\n        let consumer = getData(recipientId, 'consumer');\n        let cart = getData(recipientId, 'cart');\n        let address = getData(recipientId, 'address');\n        let customer_image_url;\n        /*\n        console.log('sendCart');\n        console.log(user);\n        console.log('customer');\n        console.log(customer);\n        console.log('consumer');\n        console.log(consumer);\n        console.log('cart');\n        console.log(cart);\n        console.log('address');\n        console.log(address);\n        */\n\n        if(typeof customer != 'undefined'){\n            customer_image_url = customer.image.url;\n        }\n\n        if(cart == undefined){\n            cart = createCart(recipientId);\n        }\n\n        let items = cart.items;\n\n        bot.sendTypingOn(recipientId);\n\n        let elements = [];\n        let element = {};\n        let total = 0;\n        let orderLimit = items.size;\n        let ind = 0;\n        let image;\n        let image_url;\n\n        //console.log('Shopping Cart');\n        //console.log(orderLimit);\n        if(orderLimit == 0){\n            renderCartEmpty(recipientId)\n        }\n        else{\n            items.forEach(function(value, key){\n                let product = new Parse.Query(ParseModels.Product);\n\n                product.get(key, {\n                    success: function (item) {\n                        image = item.get('image');\n                        image_url = customer_image_url\n                        if(image){\n                            image_url = image.url();\n                        }\n\n                        element = {};\n                        element['title'] = item.get('name');\n                        element['subtitle'] = item.get('description');\n                        element['quantity'] = value.quantity;\n                        element['price'] = parseInt(item.get('priceDefault'));\n                        element['currency'] = \"COP\";\n                        element['image_url'] = image_url;\n\n                        elements.push(element);\n                        total += element['quantity']*element['price'];\n\n                        ind++;\n\n                        if(ind == orderLimit){\n                            renderCart(recipientId, cart.id, elements, total)\n                        }\n                    },\n                    error: function (error) {\n                        alert(\"Error: \" + error.code + \" \" + error.message);\n                    }\n                })\n            });\n        }\n    });\n}\n\nfunction renderCart(recipientId, cartId, elements, total){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let address = getData(recipientId, 'address');\n    let pointSale = getData(recipientId, 'pointSale');\n    let payment_method = getData(recipientId, 'payment_method');\n    let addressData = undefined;\n\n    if(typeof payment_method == 'undefined'){\n        payment_method = {name: 'Sin definir'}\n    }\n\n    if(typeof address != 'undefined'){\n        addressData = {\n            street_1: address.address,\n            street_2: \"\",\n            city: address.city,\n            postal_code: address.postalCode,\n            state: address.state,\n            country: address.countryCode\n        }\n    }\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message:{\n            attachment: {\n                type: \"template\",\n                payload: {\n                    template_type: \"receipt\",\n                    recipient_name: user.first_name+\" \"+user.last_name,\n                    order_number: cartId,\n                    currency: \"COP\",\n                    payment_method: payment_method.name,\n                    //order_url: \"http://petersapparel.parseapp.com/order?order_id=123456\",\n                    timestamp: Math.trunc(Date.now()/1000).toString(),\n                    elements: elements,\n                    address: addressData,\n                    summary: {\n                        subtotal: total,\n                        shipping_cost: pointSale.deliveryCost,\n                        //total_tax: 0,\n                        total_cost: total+pointSale.deliveryCost\n                    }\n                    //adjustments: [{\n                    //  name: \"New Customer Discount\",\n                    //  amount: -1000\n                    //}, {\n                    //    name: \"$1000 Off Coupon\",\n                    //    amount: -1000\n                    //}]\n                }\n            },\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Finalizar pedido\",\n                    \"payload\":\"CheckOrder\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Seguir Pidiendo\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Modificar carrito\",\n                    \"payload\":\"SendCartDetails\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Borrar carrito\",\n                    \"payload\": \"ClearCart\"\n                }\n            ]\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n\n}\n\nfunction sendCartDetails(recipientId){\n    bot.sendTypingOn(recipientId);\n    renderCartDetails(recipientId)\n}\n\nfunction renderCartDetails(recipientId){\n    let cart = getData(recipientId, 'cart');\n    let customer = getData(recipientId, 'customer');\n    let consumer = getData(recipientId, 'consumer');\n    let image_url = customer.image.url;\n    let items = cart.items;\n    let elements = [];\n\n    items.forEach(function(value, key) {\n        if (elements.length <= bot.limit) {\n            new Parse.Query(ParseModels.Product).get(key).then(\n            product => {\n                let image = product.get('image');\n                if(image){\n                    image_url = image.url();\n                }\n\n                elements.push({\n                    \"title\": product.get('name')+\": $\"+value.price,\n                    \"subtitle\": \"Cantidad solicitada: \"+value.quantity,\n                    \"image_url\": image_url,\n                    \"buttons\": [\n                        {\n                            \"type\": \"postback\",\n                            \"title\": \"Quitar\",\n                            \"payload\": \"RemoveProduct-\" + key\n                        },\n                        {\n                            \"type\": \"postback\",\n                            \"title\": \"Aumentar 1\",\n                            \"payload\": \"IncreaseOneProduct-\" + key\n                        },\n                        {\n                            \"type\": \"postback\",\n                            \"title\": \"Disminuir 1\",\n                            \"payload\": \"DecreaseOneProduct-\" + key\n                        }\n                    ]\n                });\n\n                if(elements.length == bot.limit || elements.length == items.size){\n                    let messageData = {\n                        recipient: {\n                            id: recipientId\n                        },\n                        message: {\n                            \"attachment\":{\n                                \"type\": \"template\",\n                                \"payload\":{\n                                    \"template_type\": \"generic\",\n                                    \"elements\": elements\n                                }\n                            }\n                        }\n                    };\n                    bot.sendTypingOff(recipientId);\n                    bot.callSendAPI(messageData, renderEditCartOptions);\n                }\n            })\n        }\n    });\n}\n\nfunction renderEditCartOptions(recipientId){\n\n    let messageData = {\n        \"recipient\": {\n            \"id\": recipientId\n        },\n        \"message\": {\n            \"text\": \"Opciones del carrito:\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Finalizar pedido\",\n                    \"payload\":\"CheckOrder\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Seguir Pidiendo\",\n                    \"payload\":\"SendCategories-0\"\n                }\n            ]\n        }\n    };\n\n    bot.callSendAPI(messageData);\n}\n\n\n\nfunction renderCartEmpty(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu carrito de compras est vaco.\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendPurchaseOptions);\n}\n\nfunction editCart(recipientId){\n    let cart = getData(recipientId, 'cart');\n\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\": {\n                \"type\": \"template\",\n                \"payload\": {\n                    \"template_type\": \"generic\",\n                    \"elements\": [\n                        {\n                            \"title\": \"Opciones\",\n                            //\"item_url\": \"https://petersfancyapparel.com/classic_white_tshirt\",\n                            \"image_url\": SERVER_URL+\"assets/thinking.jpg\",\n                            //\"subtitle\": \"Soft white cotton t-shirt is back in style\",\n                            \"buttons\": [\n                                {\n                                    \"type\": \"web_url\",\n                                    \"url\": SERVER_URL+\"cart?\"+cart.id,\n                                    \"title\": \"Remover producto\",\n                                    \"webview_height_ratio\": \"full\"\n                                }\n                            ]\n                        }\n                    ]\n                }\n            }\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n\n}\n\nfunction clearCart(recipientId, callback){\n    let cart = getData(recipientId, 'cart');\n\n    if(typeof cart != 'undefined'){\n        let items = cart.items;\n        cart.itemsPointers = [];\n\n        items.forEach(function(value, key){\n            items.delete(key);\n            if(items.size == 0){\n                if(callback){\n                    callback(user)\n                }\n            }\n\n\n            /*new Parse.Query(ParseModels.OrderItem).get(value.id, {\n                success: (orderItem) => {\n                    //orderItem.destroy({});\n                    items.delete(key);\n                    if(items.size == 0){\n                        if(callback){\n                            callback(user)\n                        }\n                    }\n                },\n                error: (orderItem, error) => {\n                    console.log('error');\n                    console.log(error);\n                }\n            });*/\n        });\n    }\n}\n\nfunction checkOrder(recipientId){\n    checkPayment(recipientId);\n}\n\nfunction checkPayment(recipientId){\n    bot.sendTypingOn(recipientId);\n    store.dispatch(Actions.loadPaymentMethods(recipientId)).then(() => {\n        renderCheckPayment(recipientId)\n    });\n}\n\nfunction checkAddress(recipientId){\n\n}\n\nfunction renderCheckPayment(recipientId){\n    let paymentMethods = getData(recipientId, 'paymentMethods');\n    let quick_replies = [];\n\n    for(let i in paymentMethods){\n\n        quick_replies.push({\n            \"content_type\": \"text\",\n            \"title\": paymentMethods[i].name.substring(0,20),\n            \"payload\": \"Checkout-\"+paymentMethods[i].objectId\n        });\n    }\n    //console.log(quick_replies);\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Como vas a pagar tu pedido? (Tu pedido se cobra cuando lo recibes)\",\n            \"quick_replies\": quick_replies\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction checkout(recipientId, id){\n    bot.sendTypingOn(recipientId);\n\n    store.dispatch(Actions.setPaymentMethod(recipientId, id)).then(\n        () => {\n\n            let paymentMethod = getData(recipientId, 'paymentMethod');\n            console.log(paymentMethod);\n            let paymentFunction = paymentTypes.get(paymentMethod.method.objectId);\n            console.log(paymentFunction);\n\n            paymentFunction(recipientId);\n            /*\n            let cart = new ParseModels.Order();\n            cart.set('name', userBuffer['address_name']);\n            cart.set('address', userBuffer.address);\n            cart.set('consumer', {\n                __type: \"Pointer\",\n                className: \"Consumer\",\n                objectId: consumer.objectId\n            });\n\n\n            cart.save(undefined, {\n                success: function(result) {\n\n                    delete userBuffer.address;\n                    delete userBuffer.location;\n                    delete userBuffer['address_name'];\n\n                    console.log(userBuffer);\n\n                    console.log('Consumer Address');\n\n                },\n                error: function(user, error) {\n                    // Execute any logic that should take place if the save fails.\n                    // error is a Parse.Error with an error code and message.\n                    console.log('Failed to create new object, with error code: ' + error.message);\n                }\n            });\n            */\n        }\n    );\n}\n\nfunction setPayment(recipientId, id){\n\n}\n\nfunction renderCash(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Se ha registrado el pago en efectivo\"\n        }\n    };\n\n    saveCart(recipientId);\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderConfirmation);\n}\n\nfunction renderCreditCard(recipientId){\n    let creditCards = getData(recipientId, 'creditCards');\n    let consumer = getData(recipientId, 'consumer');\n\n    if(!_.isEmpty(consumer.user)) {\n        store.dispatch(Actions.loadUserCreditCards(recipientId, consumer.user)).then(\n            () => {\n                sendRegisteredCreditCards(recipientId);\n            }\n        );\n    }\n}\n\nfunction registerCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    let consumer = getData(recipientId, 'consumer');\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\":\"template\",\n                \"payload\": {\n                    \"template_type\": \"generic\",\n                    \"elements\": [{\n                        \"title\": \"Registro de tarjeta de credito y finalizacin de tu pedido.\\n\\nEstas de acuerdo?\",\n                        \"image_url\": SERVER_URL + \"assets/money.jpg\",\n                        \"subtitle\": \"Por razones de seguridad te redireccionaremos a una pgina web segura.\",\n                        \"buttons\": [\n                            {\n                                \"type\": \"web_url\",\n                                \"title\": \"Si\",\n                                \"url\": SERVER_URL + \"creditcard?id=\" + consumer.objectId,\n                                \"webview_height_ratio\": \"full\"\n                            },\n                            {\n                                \"type\": \"postback\",\n                                \"title\": \"No\",\n                                \"payload\": \"CancelRegisterCreditCard\"\n                        }]\n                    }]\n                }\n            }\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction cancelRegisterCreditCard(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Si no ingresas los datos de tu tarjeta en nuestro sitio seguro, no podras comprar con tarjeta online\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, checkPayment);\n}\n\nfunction sendRegisteredCreditCards(recipientId){\n    bot.sendTypingOn(recipientId);\n    let consumer = getData(recipientId, 'consumer');\n\n    store.dispatch(Actions.loadUserCreditCards(recipientId, consumer.user)).then(\n    () => {\n        let creditCards = getData(recipientId, 'creditCards');\n        if (creditCards.length == 0) {\n            //saveCart(recipientId);\n            renderNoRegisteredCreditCards(recipientId);\n        }\n        else {\n            renderRegisteredCreditCards(recipientId);\n        }\n    });\n}\n\nfunction renderNoRegisteredCreditCards(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Aun no tienes tarjetas registradas, deseas registrar una tarjeta?\",\n            \"quick_replies\": [\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Si\",\n                    \"payload\":\"RegisterCreditCard\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"No\",\n                    \"payload\":\"CheckPayment\"\n                }\n            ]\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction renderRegisteredCreditCards(recipientId){\n    let creditCards = getData(recipientId, 'creditCards');\n    let quick_replies = [];\n\n    quick_replies.push({\n        \"content_type\": \"text\",\n        \"title\": \"Agregar tarjeta\",\n        \"payload\": \"RegisterCreditCard\"\n    });\n\n    for(let card of creditCards){\n        if (quick_replies.length < bot.limit) {\n            quick_replies.push({\n                \"content_type\": \"text\",\n                \"title\": card.type+\" \"+card.lastFour,\n                \"payload\": \"PayWithCreditCard-\" + card.lastFour\n            });\n        }\n    }\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Con cual tarjeta quieres pagar?\",\n            \"quick_replies\": quick_replies\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction payWithCreditCard(recipientId, creditCardId){\n    bot.sendTypingOn(recipientId);\n\n    orderConfirmation(recipientId)\n}\n\nfunction orderConfirmation(recipientId){\n    bot.sendTypingOn(recipientId);\n    let state0 = orderStates.get(0);\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": state0.messagePush+\"\\n\\nEn un momento te estaremos dando informacin en tiempo real sobre tu pedido\"\n        }\n    };\n\n    saveOrder(recipientId);\n\n    bot.callSendAPI(messageData, bot.sendTypingOff);\n}\n\nfunction orderState(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Tu pedido ha sido Aceptado. \\n\\nLo estan preparando en nuestra sede y te lo enviaremos en aproximadamente 10 minutos\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, orderSent);\n}\n\nfunction orderSent(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Buenas noticias, Tu pedido ha sido Enviado. \\n\\nHaz click en el mapa para vel tu pedido\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, serviceRating);\n}\n\nfunction renderOrderState(recipientId){\n    bot.sendTypingOn(recipientId);\n    let orderState = getData(recipientId, 'orderState');\n\n\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": orderState.messagePush\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    if(orderState.order == 5){\n        bot.callSendAPI(messageData, serviceRating);\n    }\n    else if(orderState.order == 6){\n\n    }\n    else{\n        bot.callSendAPI(messageData)\n    }\n}\n\nfunction serviceRating(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Califica tu experiencia para ayudarnos a mejorar. \\n\\nDe 1 a 5 cuantas extrellas merece nuestro servicio?\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"5 (Excelente)\",\n                    \"payload\":\"SetScore-5\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"4 (Bien)\",\n                    \"payload\":\"SetScore-4\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"3 (Regular)\",\n                    \"payload\":\"SetScore-3\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Mal)\",\n                    \"payload\":\"SetScore-2\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"2 (Muy mal)\",\n                    \"payload\":\"SetScore-1\"\n                },\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction setScore(recipientId, score){\n    let order = getData(recipientId, 'order');\n\n    bot.sendTypingOn(recipientId);\n\n    Parse.Cloud.run('rateOrder', { orderId: order.objectId, score: Number(score), comment: ''}).then(\n        function(result){\n            thank(recipientId)\n        },\n        function(error) {\n            console.log('error');\n            console.log(error);\n        });\n}\n\nfunction thank(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Gracias, esperamos tener el gusto de atenderle nuevamente\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction searchProducts(recipientId, query, index){\n    bot.sendTypingOn(recipientId);\n\n    Parse.Cloud.run('search', { businessId: BUSINESS_ID, q: query }).then(\n        function(result){\n            if(result.length == 0){\n                renderSearchEmpty(recipientId);\n            }\n            else if(result.length == 1 && result[0].type == 'Category'){\n                sendProducts(recipientId, result[0].id, 0)\n            }\n            else{\n                if(index == undefined)\n                    index = 0;\n                else if( typeof index == 'string')\n                    index = parseInt(index);\n\n                if(index == 0){\n                    renderSearchInitial(recipientId);\n                    bot.sendTypingOn(recipientId);\n                }\n\n                let elements = splitSearchResult(recipientId, result, index);\n                let idx = Object.keys(result).length;\n                let buttons = [];\n                let catIni = (index+1)*bot.limit;\n                let catFin =  (idx > catIni+bot.limit) ? catIni+bot.limit : idx;\n\n                if(idx > (index+1)*bot.limit){\n                    buttons.push({\n                        type: \"postback\",\n                        title: \"Productos \"+(catIni+1)+\"-\"+catFin,\n                        payload: \"Search-\"+(index+1),\n                    });\n\n                    elements.push({\n                        title: \"Ver ms productos \",\n                        subtitle: \"Productos disponibles\",\n                        buttons: buttons\n                    });\n                }\n\n                let messageData = {\n                    recipient: {\n                        id: recipientId\n                    },\n                    message: {\n                        attachment: {\n                            type: \"template\",\n                            payload: {\n                                template_type: \"generic\",\n                                elements: elements\n                            }\n                        }\n                    }\n                };\n\n                bot.sendTypingOff(recipientId);\n                bot.callSendAPI(messageData);\n            }\n        },\n        function(error) {\n            console.log('error');\n            console.log(error);\n        }\n    );\n}\n\nfunction renderSearchInitial(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Se han encontrado los siguientes productos:\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction renderSearchEmpty(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"No se han encontrado productos que coincidan\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction splitSearchResult(recipientId, products, index){\n    let customer = getData(recipientId, 'customer');\n    let image_url = customer.image.url;\n    let idx = 0;\n    let elements = [];\n\n    products.forEach(function(item){\n        if(item && item.name && item.type == 'Product'){\n            //item.id get Product information\n            if(idx >= (index)*bot.limit && idx < (index+1)*bot.limit){\n                let image = item.image;\n                if(image){\n                    image_url = image.url();\n                }\n                elements.push({\n                    title: item.name,\n                    //subtitle: item.get('name'),\n                    //item_url: \"http://www.mycolombianrecipes.com/fruit-cocktail-salpicon-de-frutas\",\n                    image_url: image_url,\n                    buttons: [{\n                        type: \"postback\",\n                        title: 'Agregar',\n                        payload: \"AddProduct-\"+item.id,\n                    }]\n                });\n                idx = idx+1;\n            }\n        }\n    });\n    return elements;\n}\n\nfunction sendHelp(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"InOut Bot.\\n\\nTe permite visualizar las opciones de productos, agregarlos al carrito y realizar tu compra por medio del chat de facebook.\\n\\nFuncionalidades disponibles: \\n\\n'Hola', para iniciar la conversacin\\n'Pedir Domicilio', si quieres realizar un domicilio\\n'Carrito', para ver el estado actual de tu carrito\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData, sendContactUs);\n}\n\nfunction sendContactUs(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \" Para mayor informacin puedes contactarnos en:\\n\\n Web: http://www.inoutdelivery.com/\\n\\n Email: john.garavito@inoutdelivery.com\"\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendRegisterFacebookUser(recipientId){\n    bot.sendTypingOn(recipientId);\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Registro exitoso.\",\n\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendOrders(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, user =>{\n        let consumer = getData(recipientId, 'consumer');\n\n        Parse.Cloud.run('ordersBot', { businessId: BUSINESS_ID, consumerId: consumer.objectId}).then( orders => {\n            store.dispatch(Actions.setOrders(recipientId, orders)).then(() => {\n                renderOrders(recipientId);\n            });\n        }).fail(error => {\n            console.log('error');\n            console.log(error);\n        });\n    });\n}\n\nfunction renderOrders(recipientId){\n    let customer = getData(recipientId, 'customer');\n    let orders = getData(recipientId, 'orders');\n    let elements = [];\n\n    elements.push({\n        \"title\": \"Nueva orden\",\n        \"subtitle\": \"Puedes realizar una orden\",\n        \"image_url\": SERVER_URL+\"assets/conversation.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": \"Nueva orden\",\n                \"payload\": \"NewOrder\"\n            }\n        ]\n    });\n\n    for(let order of orders.ongoing) {\n        if (elements.length < bot.limit){\n            let datetime = DateTime.dateString(order.createdAt);\n            let image_url = customer.image.url;\n            /*let image = order.image;\n\n            if(image){\n                image_url = image.url();\n            }*/\n\n            elements.push({\n                \"title\": 'Orden: '+dateFormat(datetime, \"h:MM:ss TT dd/mm/yyyy\"),\n                \"subtitle\": 'Estado: '+order.state.name+', Valor: $'+order.total,\n                \"image_url\": image_url,\n                \"buttons\": [\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Ver orden\",\n                        \"payload\": \"SendOrder-\"+order.objectId\n                    },\n                    {\n                        \"type\": \"postback\",\n                        \"title\": \"Cancelar orden\",\n                        \"payload\": \"CancelOrder-\"+order.objectId\n                    }\n                ]\n            });\n        }\n    }\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\": \"template\",\n                \"payload\":{\n                    \"template_type\": \"generic\",\n                    \"elements\": elements\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction sendOrder(recipientId, id){\n    bot.sendTypingOn(recipientId);\n    authentication(recipientId, () =>{\n        let orders = getData(recipientId, 'orders');\n        let currentOrder;\n        let elements = [];\n\n        for(let order of orders.ongoing){\n            if(order.objectId == id){\n                currentOrder = order;\n            }\n        }\n\n        let element = {};\n        element['title'] = 'title';\n        element['subtitle'] = 'subtitle';\n        element['quantity'] = 1;\n        element['price'] = 1000;\n        element['currency'] = \"COP\";\n        //element['image_url'] = ;\n\n        elements.push(element);\n\n        renderOrder(recipientId, currentOrder, elements)\n    });\n}\n\nfunction renderOrder(recipientId, order, elements){\n    console.log(order);\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let address = order.consumerAddress;\n    let pointSale = order.pointSale;\n    let payment_method = order.paymentMethod;\n    let addressData = undefined;\n\n    if(typeof payment_method == 'undefined'){\n        payment_method = {name: 'Sin definir'}\n    }\n\n    if(typeof address != 'undefined'){\n        addressData = {\n            street_1: address.address,\n            street_2: \"\",\n            city: address.city,\n            postal_code: address.postalCode,\n            state: address.state,\n            country: address.countryCode\n        }\n    }\n\n    console.log(user)\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message:{\n            attachment: {\n                type: \"template\",\n                payload: {\n                    template_type: \"receipt\",\n                    recipient_name: user.first_name+\" \"+user.last_name,\n                    order_number: order.objectId,\n                    currency: \"COP\",\n                    payment_method: payment_method.name,\n                    //order_url: \"http://petersapparel.parseapp.com/order?order_id=123456\",\n                    timestamp: Math.trunc(Date.now()/1000).toString(),\n                    elements: elements,\n                    address: addressData,\n                    summary: {\n                        subtotal: order.total,\n                        shipping_cost: pointSale.deliveryCost,\n                        //total_tax: 0,\n                        total_cost: order.total+pointSale.deliveryCost\n                    }\n                    //adjustments: [{\n                    //  name: \"New Customer Discount\",\n                    //  amount: -1000\n                    //}, {\n                    //    name: \"$1000 Off Coupon\",\n                    //    amount: -1000\n                    //}]\n                }\n            },\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Nueva orden\",\n                    \"payload\":\"NewOrder\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Ver ordenes\",\n                    \"payload\":\"SendOrders\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Cancelar orden\",\n                    \"payload\":\"CancelOrder-\"+order.objectId\n                }\n            ]\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n\n}\n\nfunction newOrder(recipientId){\n    clearCart(recipientId, sendCart);\n    sendAddressesWithTitle(recipientId);\n}\n\nfunction cancelOrder(recipientId, id){\n    Parse.Cloud.run('changeStatusOrder', { status: \"canceledByUser\", orderId: id}).then( () => {\n        sendOrders(recipientId)\n    }).fail(error => {\n        console.log('error');\n        console.log(error);\n    });\n\n\n}\n\nfunction sendAccount(recipientId){\n    bot.sendTypingOn(recipientId);\n\n    authentication(recipientId, ()=> {\n        renderAccount(recipientId)\n    });\n}\n\nfunction renderAccount(recipientId){\n    let user = getData(recipientId, 'user');\n    let consumer = getData(recipientId, 'consumer');\n    let elements = [{\n        \"title\": 'Ver direcciones',\n        \"subtitle\": 'Editar y eliminar direcciones',\n        \"image_url\": SERVER_URL+\"assets/thinking.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": 'Ver direcciones',\n                \"payload\": \"SendAddresses\"\n            }\n        ]\n    },{\n        \"title\": 'Ver tarjetas de credito',\n        \"subtitle\": 'Editar y eliminar tarjetas de credito',\n        \"image_url\": SERVER_URL+\"assets/money.jpg\",\n        \"buttons\": [\n            {\n                \"type\": \"postback\",\n                \"title\": 'Ver tarjetas',\n                \"payload\": \"SendCreditCards\"\n            }\n        ]\n    }];\n\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"attachment\":{\n                \"type\": \"template\",\n                \"payload\":{\n                    \"template_type\": \"generic\",\n                    \"elements\": elements\n                }\n            }\n        }\n    };\n\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction renderShoppingCartOptions(recipientId){\n    let messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            \"text\": \"Opciones del carrito\",\n            \"quick_replies\":[\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Finalizar pedido\",\n                    \"payload\":\"CheckOrder\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Seguir Pidiendo\",\n                    \"payload\":\"SendCategories-0\"\n                },\n                {\n                    \"content_type\":\"text\",\n                    \"title\":\"Borrar carrito\",\n                    \"payload\": \"ClearCart\"\n                }\n            ]\n        }\n    };\n    bot.sendTypingOff(recipientId);\n    bot.callSendAPI(messageData);\n}\n\nfunction updateCart(recipientId){\n    let consumerCart = new ParseModels.Cart();\n    let localCart = getData(recipientId, 'cart');\n\n    new Parse.Query(consumerCart).get(localCart.id).then(\n        cart => {\n            //console.log('updateCart');\n            console.log(cart);\n        },\n        (object, error) => {\n            console.log(error);\n            // error is an instance of Parse.Error.\n        }\n    );\n}\n\nbot.app.post('/CreditCardRegistered', function (req, res) {\n    let data = req.body;\n    sendRegisteredCreditCards(data.recipientId);\n});\n\nbot.app.get('/creditcard', function(req, res) {\n    res.sendFile(path.join(__dirname+'/views/cardForm.html'));\n});\n\nbot.app.post('/registerCreditCard', function (req, res) {\n    let data = req.body;\n    let consumerID = data['consumerID'];\n\n    console.log('registerCreditCard');\n\n    new Parse.Query(ParseModels.Consumer).get(consumerID).then(consumer => {\n            if(consumer){\n                new Parse.Query(ParseModels.User).get(consumer.get('user').id).then(user => {\n                    let username = user.get('username');\n                    let recipientId = user.get('facebookId');\n                    Parse.User.logIn(username, username, {\n                        success: function(userData) {\n                            let expiry = data['expiry'].replace(/\\s+/g,\"\").split('/');\n\n                            request.post({\n                                url: PARSE_SERVER_URL+'/functions/addCreditCard',\n                                headers: {\n                                    'Content-Type': 'text/plain;charset=UTF-8',\n                                    'X-Parse-Application-Id': PARSE_APP_ID,\n                                    'X-Parse-Session-Token': userData.getSessionToken()\n                                },\n                                json: { \"number\": data['number'].replace(/\\s+/g,\"\"),\n                                    \"verificationNumber\": data['CCV'],\n                                    \"expirationMonth\": expiry[0],\n                                    \"expirationYear\": expiry[1],\n                                    \"holderName\": data['first-name']+' '+data['last-name']\n                                }\n                            }, function callback(error, response, body) {\n                                if (!error && response.statusCode == 200) {\n                                    setEmailCheck(recipientId, data['email']).then( ()=>{\n                                        setTelephoneCheck(recipientId, data['telephone']).then(()=>{\n                                            request.post({\n                                                url: SERVER_URL+'CreditCardRegistered',\n                                                json: { \"recipientId\": recipientId}\n                                            })\n                                        })\n                                    })\n                                }\n                                else{\n                                    console.log(response.statusCode);\n                                    console.log('error');\n                                    console.log(error);\n                                }\n                            });\n                        },\n                        error: function(user, error) {\n                            console.log('error');\n                            console.log(error);\n                        }\n                    });\n                });\n\n                res.sendFile(path.join(__dirname+'/views/cardRegistered.html'));\n            }\n        },\n        (object, error) => {\n            console.log(error);\n        });\n});\n\nbot.app.post('/changeOrderState', function (req, res) {\n\n    let data = req.body;\n\n    new Parse.Query(ParseModels.Consumer).get(data['consumerID']).then(consumer => {\n            if(consumer){\n                new Parse.Query(ParseModels.User).get(consumer.get('user').id).then(user => {\n                    let username = user.get('username');\n                    let recipientId = user.get('facebookId');\n\n                    new Parse.Query(ParseModels.OrderState).get(data['stateID']).then(orderState => {\n                        store.dispatch(Actions.setOrderState(recipientId, orderState)).then(() => {\n                            renderOrderState(recipientId);\n                        })\n                    })\n                    .fail(error => {\n                        console.log('Error code: ' + error.message);\n                    });\n                });\n            }\n        },\n        (object, error) => {\n            console.log(error);\n        });\n\n    /*\n\n     Parse.Cloud.run('orders').then(\n     function(result){\n     console.log(result);\n     },\n     function(error) {\n     console.log('error');\n     console.log(error);\n     });\n\n\n\n\n    request.get({\n        url: PARSE_SERVER_URL+'/classes/Order?where:{\"objectId\":\"'+data['orderID']+'\"}',\n        headers: {\n            'Content-Type': 'text/plain;charset=UTF-8',\n            'X-Parse-Application-Id': PARSE_APP_ID,\n        }\n    }, function callback(error, response, body) {\n        console.log('get order')\n        console.log(body)\n    });\n    */\n    res.json({result: 'OK'});\n});\n\nlet paymentTypes = new Map();\n\nnew Parse.Query(ParseModels.PaymentMethod).find().then(\n    methods => {\n        for(let method of methods){\n            let tmpMethod = extractParseAttributes(method);\n            if(tmpMethod.objectId == 'Nn0joKC5VK'){\n                paymentTypes.set('Nn0joKC5VK', renderCash);\n            }\n            else if(tmpMethod.objectId == 'UdK0Ifc4IF'){\n                paymentTypes.set('UdK0Ifc4IF', renderCreditCard);\n            }\n            //orderStates.set(state.get('order'), extractParseAttributes(state));\n        }\n    },\n    (object, error) => {\n        console.log(error);\n    });\n\nlet orderStates = new Map();\n\nnew Parse.Query(ParseModels.OrderState).find().then(\n    states => {\n        for(let state of states){\n            orderStates.set(state.get('order'), extractParseAttributes(state));\n        }\n    },\n    (object, error) => {\n        console.log(error);\n    });\n\n//orderStates.set('HUIPd800xH', { __type: 'Pointer', className: 'OrderState', objectId: 'HUIPd800xH' });\n\nstore.dispatch({type: types.APP_LOADED})\n\n/*\nconsole.log('Exist FB.init: '+( typeof FB.init === 'function') );\nconsole.log(FB.getLoginUrl({ scope: 'user_about_me' }));\n\n Parse.FacebookUtils.init({ // this line replaces FB.init({\n appId      : FACEBOOK_APP_ID, // Facebook App ID\n cookie     : true,  // enable cookies to allow Parse to access the session\n xfbml      : true,  // initialize Facebook social plugins on the page\n version    : 'v2.4' // point to the latest Facebook Graph API version\n });\n */"]}